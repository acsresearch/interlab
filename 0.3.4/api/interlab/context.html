<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.3.0"/>
    <title>interlab.context API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../interlab.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;interlab</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>


            <h2>Submodules</h2>
            <ul>
            </ul>

            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Context">Context</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Context.__init__">Context</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.deserialize">deserialize</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.to_dict">to_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.add_tag">add_tag</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.add_input">add_input</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.add_inputs">add_inputs</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.set_result">set_result</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.set_error">set_error</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.has_tag_name">has_tag_name</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.find_contexts">find_contexts</a>
                        </li>
                        <li>
                                <a class="function" href="#Context.display">display</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Tag">Tag</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Tag.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tag.color">color</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#current_context">current_context</a>
            </li>
            <li>
                    <a class="function" href="#with_context">with_context</a>
            </li>
            <li>
                    <a class="class" href="#FileStorage">FileStorage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FileStorage.write_context">write_context</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.read_root">read_root</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.list">list</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.remove_context">remove_context</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#StorageBase">StorageBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StorageBase.register_context">register_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.get_ephemeral_context">get_ephemeral_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.write_context">write_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_root">read_root</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.remove_context">remove_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.list">list</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_roots">read_roots</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_context">read_context</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_all_contexts">read_all_contexts</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.live_display">live_display</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../interlab.html">interlab</a><wbr>.context    </h1>

                        <div class="docstring"><p>This module provides the Context class, context log storage, logged data and parameter
serialization specialized for several data types (dataclasses, pydantic, etc),
and several special types that allow custom display of parts of any
serialized value (including deep in nested structures).</p>

<p>The objects with custom visualization in <code>data</code> submodule include images, custom HTML,
and tracking f-string-like substitution in string templates (with <code>FormatStr</code>).</p>
</div>

                        <input id="mod-context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-context-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">This module provides the Context class, context log storage, logged data and parameter</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">serialization specialized for several data types (dataclasses, pydantic, etc),</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="sd">and several special types that allow custom display of parts of any</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="sd">serialized value (including deep in nested structures).</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="sd">The objects with custom visualization in `data` submodule include images, custom HTML,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="sd">and tracking f-string-like substitution in string templates (with `FormatStr`).</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">context</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">storage</span>  <span class="c1"># noqa: F401</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">.context</span> <span class="kn">import</span> <span class="n">Context</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">current_context</span><span class="p">,</span> <span class="n">with_context</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="kn">from</span> <span class="nn">.storage</span> <span class="kn">import</span> <span class="n">FileStorage</span><span class="p">,</span> <span class="n">StorageBase</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;data&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;Context&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;Tag&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;current_context&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;with_context&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;FileStorage&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;StorageBase&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="Context">
                            <input id="Context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Context</span>:

                <label class="view-source-button" for="Context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context-58"><a href="#Context-58"><span class="linenos"> 58</span></a><span class="k">class</span> <span class="nc">Context</span><span class="p">:</span>
</span><span id="Context-59"><a href="#Context-59"><span class="linenos"> 59</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-60"><a href="#Context-60"><span class="linenos"> 60</span></a><span class="sd">    A context object that represents a single request or (sub)task in a nested hierarchy.</span>
</span><span id="Context-61"><a href="#Context-61"><span class="linenos"> 61</span></a>
</span><span id="Context-62"><a href="#Context-62"><span class="linenos"> 62</span></a><span class="sd">    The class has several attributes that are intended as read-only; use setters to modify them.</span>
</span><span id="Context-63"><a href="#Context-63"><span class="linenos"> 63</span></a>
</span><span id="Context-64"><a href="#Context-64"><span class="linenos"> 64</span></a><span class="sd">    The `Context` can be used as context manager, e.g.:</span>
</span><span id="Context-65"><a href="#Context-65"><span class="linenos"> 65</span></a>
</span><span id="Context-66"><a href="#Context-66"><span class="linenos"> 66</span></a><span class="sd">    ```python</span>
</span><span id="Context-67"><a href="#Context-67"><span class="linenos"> 67</span></a><span class="sd">    with Context(&quot;my context&quot;, inputs={&quot;z&quot;: 42}) as c:</span>
</span><span id="Context-68"><a href="#Context-68"><span class="linenos"> 68</span></a><span class="sd">        c.add_input(&quot;x&quot;, 1)</span>
</span><span id="Context-69"><a href="#Context-69"><span class="linenos"> 69</span></a><span class="sd">        y = do_some_computation(x=1)</span>
</span><span id="Context-70"><a href="#Context-70"><span class="linenos"> 70</span></a><span class="sd">        # The context would also note any exceptions raised here</span>
</span><span id="Context-71"><a href="#Context-71"><span class="linenos"> 71</span></a><span class="sd">        # (letting it propagate upwards), but a result needs to be set manually:</span>
</span><span id="Context-72"><a href="#Context-72"><span class="linenos"> 72</span></a><span class="sd">        c.set_result(y)</span>
</span><span id="Context-73"><a href="#Context-73"><span class="linenos"> 73</span></a><span class="sd">    # &lt;- Here the context is already closed.</span>
</span><span id="Context-74"><a href="#Context-74"><span class="linenos"> 74</span></a><span class="sd">    ```</span>
</span><span id="Context-75"><a href="#Context-75"><span class="linenos"> 75</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Context-76"><a href="#Context-76"><span class="linenos"> 76</span></a>
</span><span id="Context-77"><a href="#Context-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Context-78"><a href="#Context-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Context-79"><a href="#Context-79"><span class="linenos"> 79</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Context-80"><a href="#Context-80"><span class="linenos"> 80</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-81"><a href="#Context-81"><span class="linenos"> 81</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-82"><a href="#Context-82"><span class="linenos"> 82</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-83"><a href="#Context-83"><span class="linenos"> 83</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-84"><a href="#Context-84"><span class="linenos"> 84</span></a>        <span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StorageBase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-85"><a href="#Context-85"><span class="linenos"> 85</span></a>        <span class="n">directory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Context-86"><a href="#Context-86"><span class="linenos"> 86</span></a>        <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Context-87"><a href="#Context-87"><span class="linenos"> 87</span></a>    <span class="p">):</span>
</span><span id="Context-88"><a href="#Context-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-89"><a href="#Context-89"><span class="linenos"> 89</span></a><span class="sd">        - `name` - A description or name for the context.</span>
</span><span id="Context-90"><a href="#Context-90"><span class="linenos"> 90</span></a><span class="sd">        - `kind` - Indicates category of the context, may e.g. influence display of the context.</span>
</span><span id="Context-91"><a href="#Context-91"><span class="linenos"> 91</span></a><span class="sd">        - `inputs` - A dictionary of inputs for the context.</span>
</span><span id="Context-92"><a href="#Context-92"><span class="linenos"> 92</span></a><span class="sd">        - `meta` - A dictionary of any metadata for the context, e.g. UI style data.</span>
</span><span id="Context-93"><a href="#Context-93"><span class="linenos"> 93</span></a><span class="sd">        - `tags` - A list of tags for the context</span>
</span><span id="Context-94"><a href="#Context-94"><span class="linenos"> 94</span></a><span class="sd">        - `storage` - A storage object for the context. Set on the root context to log all contexts below it.</span>
</span><span id="Context-95"><a href="#Context-95"><span class="linenos"> 95</span></a><span class="sd">        - `directory` - Whether to create a sub-directory for the context while storing.</span>
</span><span id="Context-96"><a href="#Context-96"><span class="linenos"> 96</span></a><span class="sd">          This allows you to split the stored data across multiple files.</span>
</span><span id="Context-97"><a href="#Context-97"><span class="linenos"> 97</span></a><span class="sd">        - `result` - The result value of the context, if it has already been computed.</span>
</span><span id="Context-98"><a href="#Context-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-99"><a href="#Context-99"><span class="linenos"> 99</span></a>
</span><span id="Context-100"><a href="#Context-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="n">storage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_context</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-101"><a href="#Context-101"><span class="linenos">101</span></a>            <span class="n">storage</span> <span class="o">=</span> <span class="n">current_storage</span><span class="p">()</span>
</span><span id="Context-102"><a href="#Context-102"><span class="linenos">102</span></a>
</span><span id="Context-103"><a href="#Context-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="Context-104"><a href="#Context-104"><span class="linenos">104</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="Context-105"><a href="#Context-105"><span class="linenos">105</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
</span><span id="Context-106"><a href="#Context-106"><span class="linenos">106</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="Context-107"><a href="#Context-107"><span class="linenos">107</span></a>
</span><span id="Context-108"><a href="#Context-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
</span><span id="Context-109"><a href="#Context-109"><span class="linenos">109</span></a>            <span class="n">meta</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</span><span id="Context-110"><a href="#Context-110"><span class="linenos">110</span></a>
</span><span id="Context-111"><a href="#Context-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Context-112"><a href="#Context-112"><span class="linenos">112</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="Context-113"><a href="#Context-113"><span class="linenos">113</span></a>
</span><span id="Context-114"><a href="#Context-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-115"><a href="#Context-115"><span class="linenos">115</span></a>            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
</span><span id="Context-116"><a href="#Context-116"><span class="linenos">116</span></a>
</span><span id="Context-117"><a href="#Context-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Context-118"><a href="#Context-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
</span><span id="Context-119"><a href="#Context-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
</span><span id="Context-120"><a href="#Context-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="Context-121"><a href="#Context-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-122"><a href="#Context-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">ContextState</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Context-123"><a href="#Context-123"><span class="linenos">123</span></a>            <span class="n">ContextState</span><span class="o">.</span><span class="n">NEW</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="Context-124"><a href="#Context-124"><span class="linenos">124</span></a>        <span class="p">)</span>
</span><span id="Context-125"><a href="#Context-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">generate_uid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Context-126"><a href="#Context-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Context</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Context-127"><a href="#Context-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
</span><span id="Context-128"><a href="#Context-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-129"><a href="#Context-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Context-130"><a href="#Context-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
</span><span id="Context-131"><a href="#Context-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
</span><span id="Context-132"><a href="#Context-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Context-133"><a href="#Context-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-134"><a href="#Context-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Context-135"><a href="#Context-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="Context-136"><a href="#Context-136"><span class="linenos">136</span></a>
</span><span id="Context-137"><a href="#Context-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="n">storage</span><span class="p">:</span>
</span><span id="Context-138"><a href="#Context-138"><span class="linenos">138</span></a>            <span class="n">storage</span><span class="o">.</span><span class="n">register_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-139"><a href="#Context-139"><span class="linenos">139</span></a>
</span><span id="Context-140"><a href="#Context-140"><span class="linenos">140</span></a>    <span class="nd">@classmethod</span>
</span><span id="Context-141"><a href="#Context-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Context-142"><a href="#Context-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-143"><a href="#Context-143"><span class="linenos">143</span></a><span class="sd">        Deserialize a `Context` object from given JSON data.</span>
</span><span id="Context-144"><a href="#Context-144"><span class="linenos">144</span></a>
</span><span id="Context-145"><a href="#Context-145"><span class="linenos">145</span></a><span class="sd">        - `data` - A dictionary containing the serialized context data.</span>
</span><span id="Context-146"><a href="#Context-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-147"><a href="#Context-147"><span class="linenos">147</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="Context-148"><a href="#Context-148"><span class="linenos">148</span></a>        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Context&quot;</span>
</span><span id="Context-149"><a href="#Context-149"><span class="linenos">149</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Context-150"><a href="#Context-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
</span><span id="Context-151"><a href="#Context-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="Context-152"><a href="#Context-152"><span class="linenos">152</span></a>
</span><span id="Context-153"><a href="#Context-153"><span class="linenos">153</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
</span><span id="Context-154"><a href="#Context-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
</span><span id="Context-155"><a href="#Context-155"><span class="linenos">155</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="Context-156"><a href="#Context-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context-157"><a href="#Context-157"><span class="linenos">157</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="Context-158"><a href="#Context-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
</span><span id="Context-159"><a href="#Context-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]:</span>
</span><span id="Context-160"><a href="#Context-160"><span class="linenos">160</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span id="Context-161"><a href="#Context-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">)</span>
</span><span id="Context-162"><a href="#Context-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span>
</span><span id="Context-163"><a href="#Context-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
</span><span id="Context-164"><a href="#Context-164"><span class="linenos">164</span></a>
</span><span id="Context-165"><a href="#Context-165"><span class="linenos">165</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span>
</span><span id="Context-166"><a href="#Context-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-167"><a href="#Context-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-168"><a href="#Context-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context-169"><a href="#Context-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="Context-170"><a href="#Context-170"><span class="linenos">170</span></a>
</span><span id="Context-171"><a href="#Context-171"><span class="linenos">171</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
</span><span id="Context-172"><a href="#Context-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-173"><a href="#Context-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-174"><a href="#Context-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context-175"><a href="#Context-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
</span><span id="Context-176"><a href="#Context-176"><span class="linenos">176</span></a>
</span><span id="Context-177"><a href="#Context-177"><span class="linenos">177</span></a>        <span class="n">children</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)</span>
</span><span id="Context-178"><a href="#Context-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-179"><a href="#Context-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-180"><a href="#Context-180"><span class="linenos">180</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context-181"><a href="#Context-181"><span class="linenos">181</span></a>            <span class="n">new_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Context-182"><a href="#Context-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Context-183"><a href="#Context-183"><span class="linenos">183</span></a>                <span class="n">Context</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">new_depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span>
</span><span id="Context-184"><a href="#Context-184"><span class="linenos">184</span></a>            <span class="p">]</span>
</span><span id="Context-185"><a href="#Context-185"><span class="linenos">185</span></a>
</span><span id="Context-186"><a href="#Context-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-187"><a href="#Context-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="Context-188"><a href="#Context-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="Context-189"><a href="#Context-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Context-190"><a href="#Context-190"><span class="linenos">190</span></a>
</span><span id="Context-191"><a href="#Context-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Context-192"><a href="#Context-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-193"><a href="#Context-193"><span class="linenos">193</span></a><span class="sd">        Serialize `Context` object into JSON structure.</span>
</span><span id="Context-194"><a href="#Context-194"><span class="linenos">194</span></a>
</span><span id="Context-195"><a href="#Context-195"><span class="linenos">195</span></a><span class="sd">        - `with_children` - If True then children are recursively serialized.</span>
</span><span id="Context-196"><a href="#Context-196"><span class="linenos">196</span></a><span class="sd">                            If False then serialization of children is skipped and only</span>
</span><span id="Context-197"><a href="#Context-197"><span class="linenos">197</span></a><span class="sd">                            children UIDs are put into key `children_uids`</span>
</span><span id="Context-198"><a href="#Context-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-199"><a href="#Context-199"><span class="linenos">199</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-200"><a href="#Context-200"><span class="linenos">200</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Context&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">}</span>
</span><span id="Context-201"><a href="#Context-201"><span class="linenos">201</span></a>            <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
</span><span id="Context-202"><a href="#Context-202"><span class="linenos">202</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONTEXT_FORMAT_VERSION</span>
</span><span id="Context-203"><a href="#Context-203"><span class="linenos">203</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;interlab&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VERSION</span>
</span><span id="Context-204"><a href="#Context-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">:</span>
</span><span id="Context-205"><a href="#Context-205"><span class="linenos">205</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span>
</span><span id="Context-206"><a href="#Context-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
</span><span id="Context-207"><a href="#Context-207"><span class="linenos">207</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Context-208"><a href="#Context-208"><span class="linenos">208</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-209"><a href="#Context-209"><span class="linenos">209</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Context-210"><a href="#Context-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context-211"><a href="#Context-211"><span class="linenos">211</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="Context-212"><a href="#Context-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context-213"><a href="#Context-213"><span class="linenos">213</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="Context-214"><a href="#Context-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context-215"><a href="#Context-215"><span class="linenos">215</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children_uids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="Context-216"><a href="#Context-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
</span><span id="Context-217"><a href="#Context-217"><span class="linenos">217</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="Context-218"><a href="#Context-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span id="Context-219"><a href="#Context-219"><span class="linenos">219</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="Context-220"><a href="#Context-220"><span class="linenos">220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
</span><span id="Context-221"><a href="#Context-221"><span class="linenos">221</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
</span><span id="Context-222"><a href="#Context-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context-223"><a href="#Context-223"><span class="linenos">223</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="Context-224"><a href="#Context-224"><span class="linenos">224</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="Context-225"><a href="#Context-225"><span class="linenos">225</span></a>
</span><span id="Context-226"><a href="#Context-226"><span class="linenos">226</span></a>    <span class="nd">@property</span>
</span><span id="Context-227"><a href="#Context-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Context-228"><a href="#Context-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span>
</span><span id="Context-229"><a href="#Context-229"><span class="linenos">229</span></a>
</span><span id="Context-230"><a href="#Context-230"><span class="linenos">230</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Context-231"><a href="#Context-231"><span class="linenos">231</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
</span><span id="Context-232"><a href="#Context-232"><span class="linenos">232</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-233"><a href="#Context-233"><span class="linenos">233</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>
</span><span id="Context-234"><a href="#Context-234"><span class="linenos">234</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">NEW</span>
</span><span id="Context-235"><a href="#Context-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Context-236"><a href="#Context-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="Context-237"><a href="#Context-237"><span class="linenos">237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">_CONTEXT_STACK</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">parents</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
</span><span id="Context-238"><a href="#Context-238"><span class="linenos">238</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="Context-239"><a href="#Context-239"><span class="linenos">239</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="Context-240"><a href="#Context-240"><span class="linenos">240</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">Context </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> inputs=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Context-241"><a href="#Context-241"><span class="linenos">241</span></a>                <span class="p">)</span>
</span><span id="Context-242"><a href="#Context-242"><span class="linenos">242</span></a>
</span><span id="Context-243"><a href="#Context-243"><span class="linenos">243</span></a>        <span class="c1"># First we need to get Lock from parent to not get in collision</span>
</span><span id="Context-244"><a href="#Context-244"><span class="linenos">244</span></a>        <span class="c1"># with to_dict() that goes down the tree</span>
</span><span id="Context-245"><a href="#Context-245"><span class="linenos">245</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="n">_CONTEXT_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="Context-246"><a href="#Context-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="Context-247"><a href="#Context-247"><span class="linenos">247</span></a>            <span class="n">parent</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Context-248"><a href="#Context-248"><span class="linenos">248</span></a>            <span class="k">with</span> <span class="n">parent</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>  <span class="c1"># noqa</span>
</span><span id="Context-249"><a href="#Context-249"><span class="linenos">249</span></a>                <span class="n">_helper</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">))</span>
</span><span id="Context-250"><a href="#Context-250"><span class="linenos">250</span></a>                <span class="n">parent</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-251"><a href="#Context-251"><span class="linenos">251</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context-252"><a href="#Context-252"><span class="linenos">252</span></a>            <span class="n">_helper</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Context-253"><a href="#Context-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="Context-254"><a href="#Context-254"><span class="linenos">254</span></a>
</span><span id="Context-255"><a href="#Context-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">_exc_tb</span><span class="p">):</span>
</span><span id="Context-256"><a href="#Context-256"><span class="linenos">256</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-257"><a href="#Context-257"><span class="linenos">257</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>
</span><span id="Context-258"><a href="#Context-258"><span class="linenos">258</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="Context-259"><a href="#Context-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="n">exc_val</span><span class="p">:</span>
</span><span id="Context-260"><a href="#Context-260"><span class="linenos">260</span></a>                <span class="c1"># Do not call set_error here as it takes a lock</span>
</span><span id="Context-261"><a href="#Context-261"><span class="linenos">261</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="Context-262"><a href="#Context-262"><span class="linenos">262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc_val</span><span class="p">)</span>
</span><span id="Context-263"><a href="#Context-263"><span class="linenos">263</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="Context-264"><a href="#Context-264"><span class="linenos">264</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">-&gt; ERR  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> error=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="n">exc_val</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Context-265"><a href="#Context-265"><span class="linenos">265</span></a>                <span class="p">)</span>
</span><span id="Context-266"><a href="#Context-266"><span class="linenos">266</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Context-267"><a href="#Context-267"><span class="linenos">267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="Context-268"><a href="#Context-268"><span class="linenos">268</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="Context-269"><a href="#Context-269"><span class="linenos">269</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">-&gt; OK   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> result=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">),</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="Context-270"><a href="#Context-270"><span class="linenos">270</span></a>                <span class="p">)</span>
</span><span id="Context-271"><a href="#Context-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Context-272"><a href="#Context-272"><span class="linenos">272</span></a>            <span class="n">_CONTEXT_STACK</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">)</span>
</span><span id="Context-273"><a href="#Context-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context-274"><a href="#Context-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">:</span>
</span><span id="Context-275"><a href="#Context-275"><span class="linenos">275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">write_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-276"><a href="#Context-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Propagate any exception</span>
</span><span id="Context-277"><a href="#Context-277"><span class="linenos">277</span></a>
</span><span id="Context-278"><a href="#Context-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="Context-279"><a href="#Context-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-280"><a href="#Context-280"><span class="linenos">280</span></a><span class="sd">        Add a tag to the context.</span>
</span><span id="Context-281"><a href="#Context-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-282"><a href="#Context-282"><span class="linenos">282</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-283"><a href="#Context-283"><span class="linenos">283</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-284"><a href="#Context-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
</span><span id="Context-285"><a href="#Context-285"><span class="linenos">285</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Context-286"><a href="#Context-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="Context-287"><a href="#Context-287"><span class="linenos">287</span></a>
</span><span id="Context-288"><a href="#Context-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">add_event</span><span class="p">(</span>
</span><span id="Context-289"><a href="#Context-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Context-290"><a href="#Context-290"><span class="linenos">290</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Context-291"><a href="#Context-291"><span class="linenos">291</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-292"><a href="#Context-292"><span class="linenos">292</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-293"><a href="#Context-293"><span class="linenos">293</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-294"><a href="#Context-294"><span class="linenos">294</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context-295"><a href="#Context-295"><span class="linenos">295</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Context&quot;</span><span class="p">:</span>
</span><span id="Context-296"><a href="#Context-296"><span class="linenos">296</span></a>        <span class="n">event</span> <span class="o">=</span> <span class="n">Context</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
</span><span id="Context-297"><a href="#Context-297"><span class="linenos">297</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-298"><a href="#Context-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="Context-299"><a href="#Context-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="n">event</span>
</span><span id="Context-300"><a href="#Context-300"><span class="linenos">300</span></a>
</span><span id="Context-301"><a href="#Context-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="Context-302"><a href="#Context-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-303"><a href="#Context-303"><span class="linenos">303</span></a><span class="sd">        Add a named input value to the context.</span>
</span><span id="Context-304"><a href="#Context-304"><span class="linenos">304</span></a>
</span><span id="Context-305"><a href="#Context-305"><span class="linenos">305</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="Context-306"><a href="#Context-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-307"><a href="#Context-307"><span class="linenos">307</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-308"><a href="#Context-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-309"><a href="#Context-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Context-310"><a href="#Context-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context-311"><a href="#Context-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="Context-312"><a href="#Context-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Context-313"><a href="#Context-313"><span class="linenos">313</span></a>
</span><span id="Context-314"><a href="#Context-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>
</span><span id="Context-315"><a href="#Context-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-316"><a href="#Context-316"><span class="linenos">316</span></a><span class="sd">        Add a new input values to the context.</span>
</span><span id="Context-317"><a href="#Context-317"><span class="linenos">317</span></a>
</span><span id="Context-318"><a href="#Context-318"><span class="linenos">318</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="Context-319"><a href="#Context-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-320"><a href="#Context-320"><span class="linenos">320</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-321"><a href="#Context-321"><span class="linenos">321</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context-322"><a href="#Context-322"><span class="linenos">322</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Context-323"><a href="#Context-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="Context-324"><a href="#Context-324"><span class="linenos">324</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context-325"><a href="#Context-325"><span class="linenos">325</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="Context-326"><a href="#Context-326"><span class="linenos">326</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Context-327"><a href="#Context-327"><span class="linenos">327</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Context-328"><a href="#Context-328"><span class="linenos">328</span></a>
</span><span id="Context-329"><a href="#Context-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="Context-330"><a href="#Context-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-331"><a href="#Context-331"><span class="linenos">331</span></a><span class="sd">        Set the result value of the context.</span>
</span><span id="Context-332"><a href="#Context-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-333"><a href="#Context-333"><span class="linenos">333</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-334"><a href="#Context-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="Context-335"><a href="#Context-335"><span class="linenos">335</span></a>
</span><span id="Context-336"><a href="#Context-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">set_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="Context-337"><a href="#Context-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-338"><a href="#Context-338"><span class="linenos">338</span></a><span class="sd">        Set the error value of the context (usually an `Exception` instance).</span>
</span><span id="Context-339"><a href="#Context-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-340"><a href="#Context-340"><span class="linenos">340</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-341"><a href="#Context-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="Context-342"><a href="#Context-342"><span class="linenos">342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="Context-343"><a href="#Context-343"><span class="linenos">343</span></a>
</span><span id="Context-344"><a href="#Context-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">has_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Context-345"><a href="#Context-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-346"><a href="#Context-346"><span class="linenos">346</span></a><span class="sd">        Returns `True` if the context has a tag with the given name.</span>
</span><span id="Context-347"><a href="#Context-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-348"><a href="#Context-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context-349"><a href="#Context-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Context-350"><a href="#Context-350"><span class="linenos">350</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context-351"><a href="#Context-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">tag_name</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tag_name</span><span class="p">):</span>
</span><span id="Context-352"><a href="#Context-352"><span class="linenos">352</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Context-353"><a href="#Context-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="Context-354"><a href="#Context-354"><span class="linenos">354</span></a>
</span><span id="Context-355"><a href="#Context-355"><span class="linenos">355</span></a>    <span class="k">def</span> <span class="nf">find_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Context&quot;</span><span class="p">]:</span>
</span><span id="Context-356"><a href="#Context-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context-357"><a href="#Context-357"><span class="linenos">357</span></a><span class="sd">        Find all contexts matching the given callable `predicate`.</span>
</span><span id="Context-358"><a href="#Context-358"><span class="linenos">358</span></a>
</span><span id="Context-359"><a href="#Context-359"><span class="linenos">359</span></a><span class="sd">        The predicate is called with a single argument, the `Context` to check, and should return `bool`.</span>
</span><span id="Context-360"><a href="#Context-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context-361"><a href="#Context-361"><span class="linenos">361</span></a>
</span><span id="Context-362"><a href="#Context-362"><span class="linenos">362</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="Context-363"><a href="#Context-363"><span class="linenos">363</span></a>            <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context-364"><a href="#Context-364"><span class="linenos">364</span></a>                <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
</span><span id="Context-365"><a href="#Context-365"><span class="linenos">365</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="Context-366"><a href="#Context-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context-367"><a href="#Context-367"><span class="linenos">367</span></a>                    <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context-368"><a href="#Context-368"><span class="linenos">368</span></a>                        <span class="n">_helper</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</span><span id="Context-369"><a href="#Context-369"><span class="linenos">369</span></a>
</span><span id="Context-370"><a href="#Context-370"><span class="linenos">370</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Context-371"><a href="#Context-371"><span class="linenos">371</span></a>        <span class="n">_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-372"><a href="#Context-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="Context-373"><a href="#Context-373"><span class="linenos">373</span></a>
</span><span id="Context-374"><a href="#Context-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">write_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Context-375"><a href="#Context-375"><span class="linenos">375</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_context_static_page</span>
</span><span id="Context-376"><a href="#Context-376"><span class="linenos">376</span></a>
</span><span id="Context-377"><a href="#Context-377"><span class="linenos">377</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_context_static_page</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-378"><a href="#Context-378"><span class="linenos">378</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="Context-379"><a href="#Context-379"><span class="linenos">379</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="Context-380"><a href="#Context-380"><span class="linenos">380</span></a>
</span><span id="Context-381"><a href="#Context-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Context-382"><a href="#Context-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show context in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="Context-383"><a href="#Context-383"><span class="linenos">383</span></a>        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</span><span id="Context-384"><a href="#Context-384"><span class="linenos">384</span></a>        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span><span id="Context-385"><a href="#Context-385"><span class="linenos">385</span></a>
</span><span id="Context-386"><a href="#Context-386"><span class="linenos">386</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_context_static_html</span>
</span><span id="Context-387"><a href="#Context-387"><span class="linenos">387</span></a>
</span><span id="Context-388"><a href="#Context-388"><span class="linenos">388</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_context_static_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context-389"><a href="#Context-389"><span class="linenos">389</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A context object that represents a single request or (sub)task in a nested hierarchy.</p>

<p>The class has several attributes that are intended as read-only; use setters to modify them.</p>

<p>The <code><a href="#Context">Context</a></code> can be used as context manager, e.g.:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">with</span> <span class="n">Context</span><span class="p">(</span><span class="s2">&quot;my context&quot;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">do_some_computation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># The context would also note any exceptions raised here</span>
    <span class="c1"># (letting it propagate upwards), but a result needs to be set manually:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># &lt;- Here the context is already closed.</span>
</code></pre>
</div>
</div>


                            <div id="Context.__init__" class="classattr">
                                        <input id="Context.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">Context</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#StorageBase">StorageBase</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">directory</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">result</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="Context.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.__init__-77"><a href="#Context.__init__-77"><span class="linenos"> 77</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="Context.__init__-78"><a href="#Context.__init__-78"><span class="linenos"> 78</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="Context.__init__-79"><a href="#Context.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="Context.__init__-80"><a href="#Context.__init__-80"><span class="linenos"> 80</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-81"><a href="#Context.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-82"><a href="#Context.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-83"><a href="#Context.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-84"><a href="#Context.__init__-84"><span class="linenos"> 84</span></a>        <span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StorageBase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-85"><a href="#Context.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">directory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="Context.__init__-86"><a href="#Context.__init__-86"><span class="linenos"> 86</span></a>        <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="Context.__init__-87"><a href="#Context.__init__-87"><span class="linenos"> 87</span></a>    <span class="p">):</span>
</span><span id="Context.__init__-88"><a href="#Context.__init__-88"><span class="linenos"> 88</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.__init__-89"><a href="#Context.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        - `name` - A description or name for the context.</span>
</span><span id="Context.__init__-90"><a href="#Context.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        - `kind` - Indicates category of the context, may e.g. influence display of the context.</span>
</span><span id="Context.__init__-91"><a href="#Context.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        - `inputs` - A dictionary of inputs for the context.</span>
</span><span id="Context.__init__-92"><a href="#Context.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        - `meta` - A dictionary of any metadata for the context, e.g. UI style data.</span>
</span><span id="Context.__init__-93"><a href="#Context.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        - `tags` - A list of tags for the context</span>
</span><span id="Context.__init__-94"><a href="#Context.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        - `storage` - A storage object for the context. Set on the root context to log all contexts below it.</span>
</span><span id="Context.__init__-95"><a href="#Context.__init__-95"><span class="linenos"> 95</span></a><span class="sd">        - `directory` - Whether to create a sub-directory for the context while storing.</span>
</span><span id="Context.__init__-96"><a href="#Context.__init__-96"><span class="linenos"> 96</span></a><span class="sd">          This allows you to split the stored data across multiple files.</span>
</span><span id="Context.__init__-97"><a href="#Context.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        - `result` - The result value of the context, if it has already been computed.</span>
</span><span id="Context.__init__-98"><a href="#Context.__init__-98"><span class="linenos"> 98</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.__init__-99"><a href="#Context.__init__-99"><span class="linenos"> 99</span></a>
</span><span id="Context.__init__-100"><a href="#Context.__init__-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="n">storage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_context</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.__init__-101"><a href="#Context.__init__-101"><span class="linenos">101</span></a>            <span class="n">storage</span> <span class="o">=</span> <span class="n">current_storage</span><span class="p">()</span>
</span><span id="Context.__init__-102"><a href="#Context.__init__-102"><span class="linenos">102</span></a>
</span><span id="Context.__init__-103"><a href="#Context.__init__-103"><span class="linenos">103</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="Context.__init__-104"><a href="#Context.__init__-104"><span class="linenos">104</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="Context.__init__-105"><a href="#Context.__init__-105"><span class="linenos">105</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
</span><span id="Context.__init__-106"><a href="#Context.__init__-106"><span class="linenos">106</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="Context.__init__-107"><a href="#Context.__init__-107"><span class="linenos">107</span></a>
</span><span id="Context.__init__-108"><a href="#Context.__init__-108"><span class="linenos">108</span></a>        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
</span><span id="Context.__init__-109"><a href="#Context.__init__-109"><span class="linenos">109</span></a>            <span class="n">meta</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</span><span id="Context.__init__-110"><a href="#Context.__init__-110"><span class="linenos">110</span></a>
</span><span id="Context.__init__-111"><a href="#Context.__init__-111"><span class="linenos">111</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="Context.__init__-112"><a href="#Context.__init__-112"><span class="linenos">112</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="Context.__init__-113"><a href="#Context.__init__-113"><span class="linenos">113</span></a>
</span><span id="Context.__init__-114"><a href="#Context.__init__-114"><span class="linenos">114</span></a>        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.__init__-115"><a href="#Context.__init__-115"><span class="linenos">115</span></a>            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
</span><span id="Context.__init__-116"><a href="#Context.__init__-116"><span class="linenos">116</span></a>
</span><span id="Context.__init__-117"><a href="#Context.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="Context.__init__-118"><a href="#Context.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
</span><span id="Context.__init__-119"><a href="#Context.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
</span><span id="Context.__init__-120"><a href="#Context.__init__-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="Context.__init__-121"><a href="#Context.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.__init__-122"><a href="#Context.__init__-122"><span class="linenos">122</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">ContextState</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="Context.__init__-123"><a href="#Context.__init__-123"><span class="linenos">123</span></a>            <span class="n">ContextState</span><span class="o">.</span><span class="n">NEW</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="Context.__init__-124"><a href="#Context.__init__-124"><span class="linenos">124</span></a>        <span class="p">)</span>
</span><span id="Context.__init__-125"><a href="#Context.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">generate_uid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="Context.__init__-126"><a href="#Context.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Context</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Context.__init__-127"><a href="#Context.__init__-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
</span><span id="Context.__init__-128"><a href="#Context.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.__init__-129"><a href="#Context.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="Context.__init__-130"><a href="#Context.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
</span><span id="Context.__init__-131"><a href="#Context.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
</span><span id="Context.__init__-132"><a href="#Context.__init__-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="Context.__init__-133"><a href="#Context.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.__init__-134"><a href="#Context.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Context.__init__-135"><a href="#Context.__init__-135"><span class="linenos">135</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="Context.__init__-136"><a href="#Context.__init__-136"><span class="linenos">136</span></a>
</span><span id="Context.__init__-137"><a href="#Context.__init__-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="n">storage</span><span class="p">:</span>
</span><span id="Context.__init__-138"><a href="#Context.__init__-138"><span class="linenos">138</span></a>            <span class="n">storage</span><span class="o">.</span><span class="n">register_context</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><ul>
<li><code>name</code> - A description or name for the context.</li>
<li><code>kind</code> - Indicates category of the context, may e.g. influence display of the context.</li>
<li><code>inputs</code> - A dictionary of inputs for the context.</li>
<li><code>meta</code> - A dictionary of any metadata for the context, e.g. UI style data.</li>
<li><code>tags</code> - A list of tags for the context</li>
<li><code>storage</code> - A storage object for the context. Set on the root context to log all contexts below it.</li>
<li><code>directory</code> - Whether to create a sub-directory for the context while storing.
This allows you to split the stored data across multiple files.</li>
<li><code>result</code> - The result value of the context, if it has already been computed.</li>
</ul>
</div>


                            </div>
                            <div id="Context.deserialize" class="classattr">
                                        <input id="Context.deserialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">deserialize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">depth</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.deserialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.deserialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.deserialize-140"><a href="#Context.deserialize-140"><span class="linenos">140</span></a>    <span class="nd">@classmethod</span>
</span><span id="Context.deserialize-141"><a href="#Context.deserialize-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="Context.deserialize-142"><a href="#Context.deserialize-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.deserialize-143"><a href="#Context.deserialize-143"><span class="linenos">143</span></a><span class="sd">        Deserialize a `Context` object from given JSON data.</span>
</span><span id="Context.deserialize-144"><a href="#Context.deserialize-144"><span class="linenos">144</span></a>
</span><span id="Context.deserialize-145"><a href="#Context.deserialize-145"><span class="linenos">145</span></a><span class="sd">        - `data` - A dictionary containing the serialized context data.</span>
</span><span id="Context.deserialize-146"><a href="#Context.deserialize-146"><span class="linenos">146</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.deserialize-147"><a href="#Context.deserialize-147"><span class="linenos">147</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="Context.deserialize-148"><a href="#Context.deserialize-148"><span class="linenos">148</span></a>        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Context&quot;</span>
</span><span id="Context.deserialize-149"><a href="#Context.deserialize-149"><span class="linenos">149</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="Context.deserialize-150"><a href="#Context.deserialize-150"><span class="linenos">150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
</span><span id="Context.deserialize-151"><a href="#Context.deserialize-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="Context.deserialize-152"><a href="#Context.deserialize-152"><span class="linenos">152</span></a>
</span><span id="Context.deserialize-153"><a href="#Context.deserialize-153"><span class="linenos">153</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-154"><a href="#Context.deserialize-154"><span class="linenos">154</span></a>        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
</span><span id="Context.deserialize-155"><a href="#Context.deserialize-155"><span class="linenos">155</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="Context.deserialize-156"><a href="#Context.deserialize-156"><span class="linenos">156</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context.deserialize-157"><a href="#Context.deserialize-157"><span class="linenos">157</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="Context.deserialize-158"><a href="#Context.deserialize-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
</span><span id="Context.deserialize-159"><a href="#Context.deserialize-159"><span class="linenos">159</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]:</span>
</span><span id="Context.deserialize-160"><a href="#Context.deserialize-160"><span class="linenos">160</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span id="Context.deserialize-161"><a href="#Context.deserialize-161"><span class="linenos">161</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-162"><a href="#Context.deserialize-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-163"><a href="#Context.deserialize-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-164"><a href="#Context.deserialize-164"><span class="linenos">164</span></a>
</span><span id="Context.deserialize-165"><a href="#Context.deserialize-165"><span class="linenos">165</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-166"><a href="#Context.deserialize-166"><span class="linenos">166</span></a>        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.deserialize-167"><a href="#Context.deserialize-167"><span class="linenos">167</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.deserialize-168"><a href="#Context.deserialize-168"><span class="linenos">168</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context.deserialize-169"><a href="#Context.deserialize-169"><span class="linenos">169</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="Context.deserialize-170"><a href="#Context.deserialize-170"><span class="linenos">170</span></a>
</span><span id="Context.deserialize-171"><a href="#Context.deserialize-171"><span class="linenos">171</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-172"><a href="#Context.deserialize-172"><span class="linenos">172</span></a>        <span class="k">if</span> <span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.deserialize-173"><a href="#Context.deserialize-173"><span class="linenos">173</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.deserialize-174"><a href="#Context.deserialize-174"><span class="linenos">174</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context.deserialize-175"><a href="#Context.deserialize-175"><span class="linenos">175</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
</span><span id="Context.deserialize-176"><a href="#Context.deserialize-176"><span class="linenos">176</span></a>
</span><span id="Context.deserialize-177"><a href="#Context.deserialize-177"><span class="linenos">177</span></a>        <span class="n">children</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)</span>
</span><span id="Context.deserialize-178"><a href="#Context.deserialize-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.deserialize-179"><a href="#Context.deserialize-179"><span class="linenos">179</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.deserialize-180"><a href="#Context.deserialize-180"><span class="linenos">180</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="Context.deserialize-181"><a href="#Context.deserialize-181"><span class="linenos">181</span></a>            <span class="n">new_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Context.deserialize-182"><a href="#Context.deserialize-182"><span class="linenos">182</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="Context.deserialize-183"><a href="#Context.deserialize-183"><span class="linenos">183</span></a>                <span class="n">Context</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">new_depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span>
</span><span id="Context.deserialize-184"><a href="#Context.deserialize-184"><span class="linenos">184</span></a>            <span class="p">]</span>
</span><span id="Context.deserialize-185"><a href="#Context.deserialize-185"><span class="linenos">185</span></a>
</span><span id="Context.deserialize-186"><a href="#Context.deserialize-186"><span class="linenos">186</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Context.deserialize-187"><a href="#Context.deserialize-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="Context.deserialize-188"><a href="#Context.deserialize-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="Context.deserialize-189"><a href="#Context.deserialize-189"><span class="linenos">189</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Deserialize a <code><a href="#Context">Context</a></code> object from given JSON data.</p>

<ul>
<li><code>data</code> - A dictionary containing the serialized context data.</li>
</ul>
</div>


                            </div>
                            <div id="Context.to_dict" class="classattr">
                                        <input id="Context.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">with_children</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">root</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.to_dict-191"><a href="#Context.to_dict-191"><span class="linenos">191</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="Context.to_dict-192"><a href="#Context.to_dict-192"><span class="linenos">192</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.to_dict-193"><a href="#Context.to_dict-193"><span class="linenos">193</span></a><span class="sd">        Serialize `Context` object into JSON structure.</span>
</span><span id="Context.to_dict-194"><a href="#Context.to_dict-194"><span class="linenos">194</span></a>
</span><span id="Context.to_dict-195"><a href="#Context.to_dict-195"><span class="linenos">195</span></a><span class="sd">        - `with_children` - If True then children are recursively serialized.</span>
</span><span id="Context.to_dict-196"><a href="#Context.to_dict-196"><span class="linenos">196</span></a><span class="sd">                            If False then serialization of children is skipped and only</span>
</span><span id="Context.to_dict-197"><a href="#Context.to_dict-197"><span class="linenos">197</span></a><span class="sd">                            children UIDs are put into key `children_uids`</span>
</span><span id="Context.to_dict-198"><a href="#Context.to_dict-198"><span class="linenos">198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.to_dict-199"><a href="#Context.to_dict-199"><span class="linenos">199</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.to_dict-200"><a href="#Context.to_dict-200"><span class="linenos">200</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;Context&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">}</span>
</span><span id="Context.to_dict-201"><a href="#Context.to_dict-201"><span class="linenos">201</span></a>            <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
</span><span id="Context.to_dict-202"><a href="#Context.to_dict-202"><span class="linenos">202</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CONTEXT_FORMAT_VERSION</span>
</span><span id="Context.to_dict-203"><a href="#Context.to_dict-203"><span class="linenos">203</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;interlab&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VERSION</span>
</span><span id="Context.to_dict-204"><a href="#Context.to_dict-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">:</span>
</span><span id="Context.to_dict-205"><a href="#Context.to_dict-205"><span class="linenos">205</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span>
</span><span id="Context.to_dict-206"><a href="#Context.to_dict-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
</span><span id="Context.to_dict-207"><a href="#Context.to_dict-207"><span class="linenos">207</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="Context.to_dict-208"><a href="#Context.to_dict-208"><span class="linenos">208</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.to_dict-209"><a href="#Context.to_dict-209"><span class="linenos">209</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="Context.to_dict-210"><a href="#Context.to_dict-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context.to_dict-211"><a href="#Context.to_dict-211"><span class="linenos">211</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="Context.to_dict-212"><a href="#Context.to_dict-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context.to_dict-213"><a href="#Context.to_dict-213"><span class="linenos">213</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="Context.to_dict-214"><a href="#Context.to_dict-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context.to_dict-215"><a href="#Context.to_dict-215"><span class="linenos">215</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children_uids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="Context.to_dict-216"><a href="#Context.to_dict-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
</span><span id="Context.to_dict-217"><a href="#Context.to_dict-217"><span class="linenos">217</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="Context.to_dict-218"><a href="#Context.to_dict-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span id="Context.to_dict-219"><a href="#Context.to_dict-219"><span class="linenos">219</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="Context.to_dict-220"><a href="#Context.to_dict-220"><span class="linenos">220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
</span><span id="Context.to_dict-221"><a href="#Context.to_dict-221"><span class="linenos">221</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
</span><span id="Context.to_dict-222"><a href="#Context.to_dict-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context.to_dict-223"><a href="#Context.to_dict-223"><span class="linenos">223</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="Context.to_dict-224"><a href="#Context.to_dict-224"><span class="linenos">224</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Serialize <code><a href="#Context">Context</a></code> object into JSON structure.</p>

<ul>
<li><code>with_children</code> - If True then children are recursively serialized.
If False then serialization of children is skipped and only
children UIDs are put into key <code>children_uids</code></li>
</ul>
</div>


                            </div>
                            <div id="Context.add_tag" class="classattr">
                                        <input id="Context.add_tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_tag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.add_tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.add_tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.add_tag-278"><a href="#Context.add_tag-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="Context.add_tag-279"><a href="#Context.add_tag-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.add_tag-280"><a href="#Context.add_tag-280"><span class="linenos">280</span></a><span class="sd">        Add a tag to the context.</span>
</span><span id="Context.add_tag-281"><a href="#Context.add_tag-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.add_tag-282"><a href="#Context.add_tag-282"><span class="linenos">282</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.add_tag-283"><a href="#Context.add_tag-283"><span class="linenos">283</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.add_tag-284"><a href="#Context.add_tag-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
</span><span id="Context.add_tag-285"><a href="#Context.add_tag-285"><span class="linenos">285</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="Context.add_tag-286"><a href="#Context.add_tag-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Add a tag to the context.</p>
</div>


                            </div>
                            <div id="Context.add_input" class="classattr">
                                        <input id="Context.add_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_input</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">object</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.add_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.add_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.add_input-301"><a href="#Context.add_input-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="Context.add_input-302"><a href="#Context.add_input-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.add_input-303"><a href="#Context.add_input-303"><span class="linenos">303</span></a><span class="sd">        Add a named input value to the context.</span>
</span><span id="Context.add_input-304"><a href="#Context.add_input-304"><span class="linenos">304</span></a>
</span><span id="Context.add_input-305"><a href="#Context.add_input-305"><span class="linenos">305</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="Context.add_input-306"><a href="#Context.add_input-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.add_input-307"><a href="#Context.add_input-307"><span class="linenos">307</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.add_input-308"><a href="#Context.add_input-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.add_input-309"><a href="#Context.add_input-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Context.add_input-310"><a href="#Context.add_input-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context.add_input-311"><a href="#Context.add_input-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="Context.add_input-312"><a href="#Context.add_input-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a named input value to the context.</p>

<p>If an input of the same name already exists, an exception is raised.</p>
</div>


                            </div>
                            <div id="Context.add_inputs" class="classattr">
                                        <input id="Context.add_inputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_inputs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.add_inputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.add_inputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.add_inputs-314"><a href="#Context.add_inputs-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>
</span><span id="Context.add_inputs-315"><a href="#Context.add_inputs-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.add_inputs-316"><a href="#Context.add_inputs-316"><span class="linenos">316</span></a><span class="sd">        Add a new input values to the context.</span>
</span><span id="Context.add_inputs-317"><a href="#Context.add_inputs-317"><span class="linenos">317</span></a>
</span><span id="Context.add_inputs-318"><a href="#Context.add_inputs-318"><span class="linenos">318</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="Context.add_inputs-319"><a href="#Context.add_inputs-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.add_inputs-320"><a href="#Context.add_inputs-320"><span class="linenos">320</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.add_inputs-321"><a href="#Context.add_inputs-321"><span class="linenos">321</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Context.add_inputs-322"><a href="#Context.add_inputs-322"><span class="linenos">322</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="Context.add_inputs-323"><a href="#Context.add_inputs-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="Context.add_inputs-324"><a href="#Context.add_inputs-324"><span class="linenos">324</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="Context.add_inputs-325"><a href="#Context.add_inputs-325"><span class="linenos">325</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="Context.add_inputs-326"><a href="#Context.add_inputs-326"><span class="linenos">326</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="Context.add_inputs-327"><a href="#Context.add_inputs-327"><span class="linenos">327</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a new input values to the context.</p>

<p>If an input of the same name already exists, an exception is raised.</p>
</div>


                            </div>
                            <div id="Context.set_result" class="classattr">
                                        <input id="Context.set_result-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_result</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.set_result-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.set_result"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.set_result-329"><a href="#Context.set_result-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="Context.set_result-330"><a href="#Context.set_result-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.set_result-331"><a href="#Context.set_result-331"><span class="linenos">331</span></a><span class="sd">        Set the result value of the context.</span>
</span><span id="Context.set_result-332"><a href="#Context.set_result-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.set_result-333"><a href="#Context.set_result-333"><span class="linenos">333</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.set_result-334"><a href="#Context.set_result-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the result value of the context.</p>
</div>


                            </div>
                            <div id="Context.set_error" class="classattr">
                                        <input id="Context.set_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_error</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exc</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.set_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.set_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.set_error-336"><a href="#Context.set_error-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">set_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="Context.set_error-337"><a href="#Context.set_error-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.set_error-338"><a href="#Context.set_error-338"><span class="linenos">338</span></a><span class="sd">        Set the error value of the context (usually an `Exception` instance).</span>
</span><span id="Context.set_error-339"><a href="#Context.set_error-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.set_error-340"><a href="#Context.set_error-340"><span class="linenos">340</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.set_error-341"><a href="#Context.set_error-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ContextState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="Context.set_error-342"><a href="#Context.set_error-342"><span class="linenos">342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the error value of the context (usually an <code>Exception</code> instance).</p>
</div>


                            </div>
                            <div id="Context.has_tag_name" class="classattr">
                                        <input id="Context.has_tag_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_tag_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.has_tag_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.has_tag_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.has_tag_name-344"><a href="#Context.has_tag_name-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">has_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Context.has_tag_name-345"><a href="#Context.has_tag_name-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.has_tag_name-346"><a href="#Context.has_tag_name-346"><span class="linenos">346</span></a><span class="sd">        Returns `True` if the context has a tag with the given name.</span>
</span><span id="Context.has_tag_name-347"><a href="#Context.has_tag_name-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.has_tag_name-348"><a href="#Context.has_tag_name-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context.has_tag_name-349"><a href="#Context.has_tag_name-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="Context.has_tag_name-350"><a href="#Context.has_tag_name-350"><span class="linenos">350</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="Context.has_tag_name-351"><a href="#Context.has_tag_name-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">tag_name</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tag_name</span><span class="p">):</span>
</span><span id="Context.has_tag_name-352"><a href="#Context.has_tag_name-352"><span class="linenos">352</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="Context.has_tag_name-353"><a href="#Context.has_tag_name-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Returns <code>True</code> if the context has a tag with the given name.</p>
</div>


                            </div>
                            <div id="Context.find_contexts" class="classattr">
                                        <input id="Context.find_contexts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_contexts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#Context">Context</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Context.find_contexts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.find_contexts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.find_contexts-355"><a href="#Context.find_contexts-355"><span class="linenos">355</span></a>    <span class="k">def</span> <span class="nf">find_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;Context&quot;</span><span class="p">]:</span>
</span><span id="Context.find_contexts-356"><a href="#Context.find_contexts-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Context.find_contexts-357"><a href="#Context.find_contexts-357"><span class="linenos">357</span></a><span class="sd">        Find all contexts matching the given callable `predicate`.</span>
</span><span id="Context.find_contexts-358"><a href="#Context.find_contexts-358"><span class="linenos">358</span></a>
</span><span id="Context.find_contexts-359"><a href="#Context.find_contexts-359"><span class="linenos">359</span></a><span class="sd">        The predicate is called with a single argument, the `Context` to check, and should return `bool`.</span>
</span><span id="Context.find_contexts-360"><a href="#Context.find_contexts-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="Context.find_contexts-361"><a href="#Context.find_contexts-361"><span class="linenos">361</span></a>
</span><span id="Context.find_contexts-362"><a href="#Context.find_contexts-362"><span class="linenos">362</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="Context.find_contexts-363"><a href="#Context.find_contexts-363"><span class="linenos">363</span></a>            <span class="k">with</span> <span class="n">context</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="Context.find_contexts-364"><a href="#Context.find_contexts-364"><span class="linenos">364</span></a>                <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">context</span><span class="p">):</span>
</span><span id="Context.find_contexts-365"><a href="#Context.find_contexts-365"><span class="linenos">365</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>
</span><span id="Context.find_contexts-366"><a href="#Context.find_contexts-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context.find_contexts-367"><a href="#Context.find_contexts-367"><span class="linenos">367</span></a>                    <span class="k">for</span> <span class="n">ctx</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="Context.find_contexts-368"><a href="#Context.find_contexts-368"><span class="linenos">368</span></a>                        <span class="n">_helper</span><span class="p">(</span><span class="n">ctx</span><span class="p">)</span>
</span><span id="Context.find_contexts-369"><a href="#Context.find_contexts-369"><span class="linenos">369</span></a>
</span><span id="Context.find_contexts-370"><a href="#Context.find_contexts-370"><span class="linenos">370</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="Context.find_contexts-371"><a href="#Context.find_contexts-371"><span class="linenos">371</span></a>        <span class="n">_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context.find_contexts-372"><a href="#Context.find_contexts-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Find all contexts matching the given callable <code>predicate</code>.</p>

<p>The predicate is called with a single argument, the <code><a href="#Context">Context</a></code> to check, and should return <code>bool</code>.</p>
</div>


                            </div>
                            <div id="Context.display" class="classattr">
                                        <input id="Context.display-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">display</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Context.display-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Context.display"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Context.display-381"><a href="#Context.display-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Context.display-382"><a href="#Context.display-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show context in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="Context.display-383"><a href="#Context.display-383"><span class="linenos">383</span></a>        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</span><span id="Context.display-384"><a href="#Context.display-384"><span class="linenos">384</span></a>        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span><span id="Context.display-385"><a href="#Context.display-385"><span class="linenos">385</span></a>
</span><span id="Context.display-386"><a href="#Context.display-386"><span class="linenos">386</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_context_static_html</span>
</span><span id="Context.display-387"><a href="#Context.display-387"><span class="linenos">387</span></a>
</span><span id="Context.display-388"><a href="#Context.display-388"><span class="linenos">388</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_context_static_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="Context.display-389"><a href="#Context.display-389"><span class="linenos">389</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Show context in Jupyter notebook</p>
</div>


                            </div>
                </section>
                <section id="Tag">
                            <input id="Tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Tag</span>:

                <label class="view-source-button" for="Tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tag-38"><a href="#Tag-38"><span class="linenos">38</span></a><span class="nd">@dataclass</span>
</span><span id="Tag-39"><a href="#Tag-39"><span class="linenos">39</span></a><span class="k">class</span> <span class="nc">Tag</span><span class="p">:</span>
</span><span id="Tag-40"><a href="#Tag-40"><span class="linenos">40</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tag-41"><a href="#Tag-41"><span class="linenos">41</span></a><span class="sd">    A simple class representing a tag that can be applied to a context. Optionally with style information.</span>
</span><span id="Tag-42"><a href="#Tag-42"><span class="linenos">42</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Tag-43"><a href="#Tag-43"><span class="linenos">43</span></a>
</span><span id="Tag-44"><a href="#Tag-44"><span class="linenos">44</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Tag-45"><a href="#Tag-45"><span class="linenos">45</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The name of the tag; any short string.&quot;&quot;&quot;</span>
</span><span id="Tag-46"><a href="#Tag-46"><span class="linenos">46</span></a>    <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Tag-47"><a href="#Tag-47"><span class="linenos">47</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML hex color code, e.g. `#ff0000`.&quot;&quot;&quot;</span>
</span><span id="Tag-48"><a href="#Tag-48"><span class="linenos">48</span></a>
</span><span id="Tag-49"><a href="#Tag-49"><span class="linenos">49</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Tag-50"><a href="#Tag-50"><span class="linenos">50</span></a>    <span class="k">def</span> <span class="nf">into_tag</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tag&quot;</span><span class="p">:</span>
</span><span id="Tag-51"><a href="#Tag-51"><span class="linenos">51</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="Tag-52"><a href="#Tag-52"><span class="linenos">52</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span><span id="Tag-53"><a href="#Tag-53"><span class="linenos">53</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Tag-54"><a href="#Tag-54"><span class="linenos">54</span></a>            <span class="k">return</span> <span class="n">Tag</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Tag-55"><a href="#Tag-55"><span class="linenos">55</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">!r}</span><span class="s2"> cannot be converted into Tag&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A simple class representing a tag that can be applied to a context. Optionally with style information.</p>
</div>


                            <div id="Tag.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Tag.name"></a>
    
            <div class="docstring"><p>The name of the tag; any short string.</p>
</div>


                            </div>
                            <div id="Tag.color" class="classattr">
                                <div class="attr variable">
            <span class="name">color</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Tag.color"></a>
    
            <div class="docstring"><p>HTML hex color code, e.g. <code>#ff0000</code>.</p>
</div>


                            </div>
                </section>
                <section id="current_context">
                            <input id="current_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Context">Context</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="current_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#current_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="current_context-451"><a href="#current_context-451"><span class="linenos">451</span></a><span class="k">def</span> <span class="nf">current_context</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="current_context-452"><a href="#current_context-452"><span class="linenos">452</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="current_context-453"><a href="#current_context-453"><span class="linenos">453</span></a><span class="sd">    Returns the inner-most open context, if any.</span>
</span><span id="current_context-454"><a href="#current_context-454"><span class="linenos">454</span></a>
</span><span id="current_context-455"><a href="#current_context-455"><span class="linenos">455</span></a><span class="sd">    Throws an error if `check` is `True` and there is no current context. If `check` is `False` and there is</span>
</span><span id="current_context-456"><a href="#current_context-456"><span class="linenos">456</span></a><span class="sd">    no current context, it returns `None`.</span>
</span><span id="current_context-457"><a href="#current_context-457"><span class="linenos">457</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="current_context-458"><a href="#current_context-458"><span class="linenos">458</span></a>    <span class="n">stack</span> <span class="o">=</span> <span class="n">_CONTEXT_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="current_context-459"><a href="#current_context-459"><span class="linenos">459</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="current_context-460"><a href="#current_context-460"><span class="linenos">460</span></a>        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
</span><span id="current_context-461"><a href="#current_context-461"><span class="linenos">461</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No current context&quot;</span><span class="p">)</span>
</span><span id="current_context-462"><a href="#current_context-462"><span class="linenos">462</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="current_context-463"><a href="#current_context-463"><span class="linenos">463</span></a>    <span class="k">return</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the inner-most open context, if any.</p>

<p>Throws an error if <code>check</code> is <code>True</code> and there is no current context. If <code>check</code> is <code>False</code> and there is
no current context, it returns <code>None</code>.</p>
</div>


                </section>
                <section id="with_context">
                            <input id="with_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">with_context</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">kind</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="with_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#with_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="with_context-392"><a href="#with_context-392"><span class="linenos">392</span></a><span class="k">def</span> <span class="nf">with_context</span><span class="p">(</span>
</span><span id="with_context-393"><a href="#with_context-393"><span class="linenos">393</span></a>    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="with_context-394"><a href="#with_context-394"><span class="linenos">394</span></a><span class="p">):</span>
</span><span id="with_context-395"><a href="#with_context-395"><span class="linenos">395</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="with_context-396"><a href="#with_context-396"><span class="linenos">396</span></a><span class="sd">    A decorator wrapping every execution of the function in a new `Context`.</span>
</span><span id="with_context-397"><a href="#with_context-397"><span class="linenos">397</span></a>
</span><span id="with_context-398"><a href="#with_context-398"><span class="linenos">398</span></a><span class="sd">    The `inputs`, `result`, and `error` (if any) are set automatically.</span>
</span><span id="with_context-399"><a href="#with_context-399"><span class="linenos">399</span></a><span class="sd">    Note that you can access the created context in your function using `current_context`.</span>
</span><span id="with_context-400"><a href="#with_context-400"><span class="linenos">400</span></a>
</span><span id="with_context-401"><a href="#with_context-401"><span class="linenos">401</span></a><span class="sd">    *Usage:*</span>
</span><span id="with_context-402"><a href="#with_context-402"><span class="linenos">402</span></a>
</span><span id="with_context-403"><a href="#with_context-403"><span class="linenos">403</span></a><span class="sd">    ```python</span>
</span><span id="with_context-404"><a href="#with_context-404"><span class="linenos">404</span></a><span class="sd">    @with_context</span>
</span><span id="with_context-405"><a href="#with_context-405"><span class="linenos">405</span></a><span class="sd">    def func():</span>
</span><span id="with_context-406"><a href="#with_context-406"><span class="linenos">406</span></a><span class="sd">        pass</span>
</span><span id="with_context-407"><a href="#with_context-407"><span class="linenos">407</span></a>
</span><span id="with_context-408"><a href="#with_context-408"><span class="linenos">408</span></a><span class="sd">    @with_context(name=&quot;custom_name&quot;, kind=&quot;custom_kind&quot;, tags=[&#39;tag1&#39;, &#39;tag2&#39;])</span>
</span><span id="with_context-409"><a href="#with_context-409"><span class="linenos">409</span></a><span class="sd">    def func():</span>
</span><span id="with_context-410"><a href="#with_context-410"><span class="linenos">410</span></a><span class="sd">        pass</span>
</span><span id="with_context-411"><a href="#with_context-411"><span class="linenos">411</span></a><span class="sd">    ```</span>
</span><span id="with_context-412"><a href="#with_context-412"><span class="linenos">412</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="with_context-413"><a href="#with_context-413"><span class="linenos">413</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="with_context-414"><a href="#with_context-414"><span class="linenos">414</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;use `with_context()` with explicit `name=...` parameter&quot;</span><span class="p">)</span>
</span><span id="with_context-415"><a href="#with_context-415"><span class="linenos">415</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="n">fn</span><span class="o">.</span><span class="vm">__name__</span>
</span><span id="with_context-416"><a href="#with_context-416"><span class="linenos">416</span></a>
</span><span id="with_context-417"><a href="#with_context-417"><span class="linenos">417</span></a>    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="with_context-418"><a href="#with_context-418"><span class="linenos">418</span></a>        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="with_context-419"><a href="#with_context-419"><span class="linenos">419</span></a>
</span><span id="with_context-420"><a href="#with_context-420"><span class="linenos">420</span></a>        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="with_context-421"><a href="#with_context-421"><span class="linenos">421</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
</span><span id="with_context-422"><a href="#with_context-422"><span class="linenos">422</span></a>            <span class="n">binding</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_context-423"><a href="#with_context-423"><span class="linenos">423</span></a>            <span class="k">with</span> <span class="n">Context</span><span class="p">(</span>
</span><span id="with_context-424"><a href="#with_context-424"><span class="linenos">424</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span> <span class="ow">or</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span>
</span><span id="with_context-425"><a href="#with_context-425"><span class="linenos">425</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
</span><span id="with_context-426"><a href="#with_context-426"><span class="linenos">426</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_context-427"><a href="#with_context-427"><span class="linenos">427</span></a>                <span class="n">ctx</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="with_context-428"><a href="#with_context-428"><span class="linenos">428</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="with_context-429"><a href="#with_context-429"><span class="linenos">429</span></a>
</span><span id="with_context-430"><a href="#with_context-430"><span class="linenos">430</span></a>        <span class="k">async</span> <span class="k">def</span> <span class="nf">async_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
</span><span id="with_context-431"><a href="#with_context-431"><span class="linenos">431</span></a>            <span class="n">binding</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_context-432"><a href="#with_context-432"><span class="linenos">432</span></a>            <span class="k">with</span> <span class="n">Context</span><span class="p">(</span>
</span><span id="with_context-433"><a href="#with_context-433"><span class="linenos">433</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span> <span class="ow">or</span> <span class="s2">&quot;acall&quot;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">arguments</span>
</span><span id="with_context-434"><a href="#with_context-434"><span class="linenos">434</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">ctx</span><span class="p">:</span>
</span><span id="with_context-435"><a href="#with_context-435"><span class="linenos">435</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_context-436"><a href="#with_context-436"><span class="linenos">436</span></a>                <span class="n">ctx</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="with_context-437"><a href="#with_context-437"><span class="linenos">437</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="with_context-438"><a href="#with_context-438"><span class="linenos">438</span></a>
</span><span id="with_context-439"><a href="#with_context-439"><span class="linenos">439</span></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="with_context-440"><a href="#with_context-440"><span class="linenos">440</span></a>            <span class="k">return</span> <span class="n">async_wrapper</span>
</span><span id="with_context-441"><a href="#with_context-441"><span class="linenos">441</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="with_context-442"><a href="#with_context-442"><span class="linenos">442</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="with_context-443"><a href="#with_context-443"><span class="linenos">443</span></a>
</span><span id="with_context-444"><a href="#with_context-444"><span class="linenos">444</span></a>    <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="with_context-445"><a href="#with_context-445"><span class="linenos">445</span></a>        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="with_context-446"><a href="#with_context-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">helper</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="with_context-447"><a href="#with_context-447"><span class="linenos">447</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="with_context-448"><a href="#with_context-448"><span class="linenos">448</span></a>        <span class="k">return</span> <span class="n">helper</span>
</span></pre></div>


            <div class="docstring"><p>A decorator wrapping every execution of the function in a new <code><a href="#Context">Context</a></code>.</p>

<p>The <code>inputs</code>, <code>result</code>, and <code>error</code> (if any) are set automatically.
Note that you can access the created context in your function using <code><a href="#current_context">current_context</a></code>.</p>

<p><em>Usage:</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@with_context</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@with_context</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom_name&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;custom_kind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tag1&#39;</span><span class="p">,</span> <span class="s1">&#39;tag2&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre>
</div>
</div>


                </section>
                <section id="FileStorage">
                            <input id="FileStorage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FileStorage</span><wbr>(<span class="base"><a href="#StorageBase">interlab.context.StorageBase</a></span>):

                <label class="view-source-button" for="FileStorage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage-118"><a href="#FileStorage-118"><span class="linenos">118</span></a><span class="k">class</span> <span class="nc">FileStorage</span><span class="p">(</span><span class="n">StorageBase</span><span class="p">):</span>
</span><span id="FileStorage-119"><a href="#FileStorage-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-120"><a href="#FileStorage-120"><span class="linenos">120</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="FileStorage-121"><a href="#FileStorage-121"><span class="linenos">121</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage-122"><a href="#FileStorage-122"><span class="linenos">122</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage-123"><a href="#FileStorage-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="FileStorage-124"><a href="#FileStorage-124"><span class="linenos">124</span></a>
</span><span id="FileStorage-125"><a href="#FileStorage-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FileStorage-126"><a href="#FileStorage-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.gz&quot;</span><span class="p">)</span>
</span><span id="FileStorage-127"><a href="#FileStorage-127"><span class="linenos">127</span></a>
</span><span id="FileStorage-128"><a href="#FileStorage-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FileStorage-129"><a href="#FileStorage-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.ctx&quot;</span><span class="p">)</span>
</span><span id="FileStorage-130"><a href="#FileStorage-130"><span class="linenos">130</span></a>
</span><span id="FileStorage-131"><a href="#FileStorage-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">write_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="FileStorage-132"><a href="#FileStorage-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-133"><a href="#FileStorage-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-134"><a href="#FileStorage-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_into</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage-135"><a href="#FileStorage-135"><span class="linenos">135</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-136"><a href="#FileStorage-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-137"><a href="#FileStorage-137"><span class="linenos">137</span></a>
</span><span id="FileStorage-138"><a href="#FileStorage-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">_write_context_into</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">root_context</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="FileStorage-139"><a href="#FileStorage-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-140"><a href="#FileStorage-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-141"><a href="#FileStorage-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">context</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
</span><span id="FileStorage-142"><a href="#FileStorage-142"><span class="linenos">142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">root_context</span><span class="p">)</span>
</span><span id="FileStorage-143"><a href="#FileStorage-143"><span class="linenos">143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-144"><a href="#FileStorage-144"><span class="linenos">144</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root_context</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-145"><a href="#FileStorage-145"><span class="linenos">145</span></a>            <span class="n">data_root</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root_context</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-146"><a href="#FileStorage-146"><span class="linenos">146</span></a>            <span class="c1"># Write full first, so when root exists, then full is definitely there</span>
</span><span id="FileStorage-147"><a href="#FileStorage-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-148"><a href="#FileStorage-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">,</span> <span class="n">data_root</span><span class="p">)</span>
</span><span id="FileStorage-149"><a href="#FileStorage-149"><span class="linenos">149</span></a>
</span><span id="FileStorage-150"><a href="#FileStorage-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">_write_context_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">,</span> <span class="n">root_context</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="FileStorage-151"><a href="#FileStorage-151"><span class="linenos">151</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-152"><a href="#FileStorage-152"><span class="linenos">152</span></a>        <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;._tmp&quot;</span>
</span><span id="FileStorage-153"><a href="#FileStorage-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="FileStorage-154"><a href="#FileStorage-154"><span class="linenos">154</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-155"><a href="#FileStorage-155"><span class="linenos">155</span></a>            <span class="n">data_root</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root_context</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-156"><a href="#FileStorage-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_file</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">,</span> <span class="n">data_root</span><span class="p">)</span>
</span><span id="FileStorage-157"><a href="#FileStorage-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">context</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="FileStorage-158"><a href="#FileStorage-158"><span class="linenos">158</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_into</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage-159"><a href="#FileStorage-159"><span class="linenos">159</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-160"><a href="#FileStorage-160"><span class="linenos">160</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="FileStorage-161"><a href="#FileStorage-161"><span class="linenos">161</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
</span><span id="FileStorage-162"><a href="#FileStorage-162"><span class="linenos">162</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-163"><a href="#FileStorage-163"><span class="linenos">163</span></a>
</span><span id="FileStorage-164"><a href="#FileStorage-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">_write_context_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">):</span>
</span><span id="FileStorage-165"><a href="#FileStorage-165"><span class="linenos">165</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="FileStorage-166"><a href="#FileStorage-166"><span class="linenos">166</span></a>        <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;._tmp&quot;</span>
</span><span id="FileStorage-167"><a href="#FileStorage-167"><span class="linenos">167</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="FileStorage-168"><a href="#FileStorage-168"><span class="linenos">168</span></a>            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="FileStorage-169"><a href="#FileStorage-169"><span class="linenos">169</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-170"><a href="#FileStorage-170"><span class="linenos">170</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-171"><a href="#FileStorage-171"><span class="linenos">171</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="FileStorage-172"><a href="#FileStorage-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
</span><span id="FileStorage-173"><a href="#FileStorage-173"><span class="linenos">173</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-174"><a href="#FileStorage-174"><span class="linenos">174</span></a>
</span><span id="FileStorage-175"><a href="#FileStorage-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-176"><a href="#FileStorage-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-177"><a href="#FileStorage-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-178"><a href="#FileStorage-178"><span class="linenos">178</span></a>        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-179"><a href="#FileStorage-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="FileStorage-180"><a href="#FileStorage-180"><span class="linenos">180</span></a>            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="FileStorage-181"><a href="#FileStorage-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-182"><a href="#FileStorage-182"><span class="linenos">182</span></a>
</span><span id="FileStorage-183"><a href="#FileStorage-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-184"><a href="#FileStorage-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-185"><a href="#FileStorage-185"><span class="linenos">185</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-186"><a href="#FileStorage-186"><span class="linenos">186</span></a>        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-187"><a href="#FileStorage-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="FileStorage-188"><a href="#FileStorage-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_children</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage-189"><a href="#FileStorage-189"><span class="linenos">189</span></a>
</span><span id="FileStorage-190"><a href="#FileStorage-190"><span class="linenos">190</span></a>        <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-191"><a href="#FileStorage-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
</span><span id="FileStorage-192"><a href="#FileStorage-192"><span class="linenos">192</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage-193"><a href="#FileStorage-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-194"><a href="#FileStorage-194"><span class="linenos">194</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage-195"><a href="#FileStorage-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-196"><a href="#FileStorage-196"><span class="linenos">196</span></a>
</span><span id="FileStorage-197"><a href="#FileStorage-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-198"><a href="#FileStorage-198"><span class="linenos">198</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-199"><a href="#FileStorage-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-200"><a href="#FileStorage-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-201"><a href="#FileStorage-201"><span class="linenos">201</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-202"><a href="#FileStorage-202"><span class="linenos">202</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage-203"><a href="#FileStorage-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-204"><a href="#FileStorage-204"><span class="linenos">204</span></a>
</span><span id="FileStorage-205"><a href="#FileStorage-205"><span class="linenos">205</span></a>    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-206"><a href="#FileStorage-206"><span class="linenos">206</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="FileStorage-207"><a href="#FileStorage-207"><span class="linenos">207</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="FileStorage-208"><a href="#FileStorage-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-209"><a href="#FileStorage-209"><span class="linenos">209</span></a>
</span><span id="FileStorage-210"><a href="#FileStorage-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">_read_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-211"><a href="#FileStorage-211"><span class="linenos">211</span></a>        <span class="n">self_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage-212"><a href="#FileStorage-212"><span class="linenos">212</span></a>        <span class="n">self_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">self_path</span><span class="p">)</span>
</span><span id="FileStorage-213"><a href="#FileStorage-213"><span class="linenos">213</span></a>        <span class="n">children_uids</span> <span class="o">=</span> <span class="n">self_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;children_uids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-214"><a href="#FileStorage-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">children_uids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileStorage-215"><a href="#FileStorage-215"><span class="linenos">215</span></a>            <span class="k">return</span> <span class="n">self_data</span>
</span><span id="FileStorage-216"><a href="#FileStorage-216"><span class="linenos">216</span></a>        <span class="n">self_data</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">children_uids</span><span class="p">]</span>
</span><span id="FileStorage-217"><a href="#FileStorage-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">self_data</span>
</span><span id="FileStorage-218"><a href="#FileStorage-218"><span class="linenos">218</span></a>
</span><span id="FileStorage-219"><a href="#FileStorage-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FileStorage-220"><a href="#FileStorage-220"><span class="linenos">220</span></a>        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s2">&quot;.root.gz&quot;</span>
</span><span id="FileStorage-221"><a href="#FileStorage-221"><span class="linenos">221</span></a>        <span class="n">dir_suffix</span> <span class="o">=</span> <span class="s2">&quot;.ctx&quot;</span>
</span><span id="FileStorage-222"><a href="#FileStorage-222"><span class="linenos">222</span></a>
</span><span id="FileStorage-223"><a href="#FileStorage-223"><span class="linenos">223</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-224"><a href="#FileStorage-224"><span class="linenos">224</span></a>            <span class="n">ephemeral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="FileStorage-225"><a href="#FileStorage-225"><span class="linenos">225</span></a>
</span><span id="FileStorage-226"><a href="#FileStorage-226"><span class="linenos">226</span></a>        <span class="n">lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage-227"><a href="#FileStorage-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="FileStorage-228"><a href="#FileStorage-228"><span class="linenos">228</span></a>            <span class="n">ephemeral</span>
</span><span id="FileStorage-229"><a href="#FileStorage-229"><span class="linenos">229</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span>
</span><span id="FileStorage-230"><a href="#FileStorage-230"><span class="linenos">230</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span>
</span><span id="FileStorage-231"><a href="#FileStorage-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span><span id="FileStorage-232"><a href="#FileStorage-232"><span class="linenos">232</span></a>
</span><span id="FileStorage-233"><a href="#FileStorage-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-234"><a href="#FileStorage-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-235"><a href="#FileStorage-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-236"><a href="#FileStorage-236"><span class="linenos">236</span></a>        <span class="c1"># First try to remove .root, so it immediately disappear from listing</span>
</span><span id="FileStorage-237"><a href="#FileStorage-237"><span class="linenos">237</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage-238"><a href="#FileStorage-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-239"><a href="#FileStorage-239"><span class="linenos">239</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-240"><a href="#FileStorage-240"><span class="linenos">240</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage-241"><a href="#FileStorage-241"><span class="linenos">241</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-242"><a href="#FileStorage-242"><span class="linenos">242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-243"><a href="#FileStorage-243"><span class="linenos">243</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-244"><a href="#FileStorage-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-245"><a href="#FileStorage-245"><span class="linenos">245</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-246"><a href="#FileStorage-246"><span class="linenos">246</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-247"><a href="#FileStorage-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-248"><a href="#FileStorage-248"><span class="linenos">248</span></a>
</span><span id="FileStorage-249"><a href="#FileStorage-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FileStorage-250"><a href="#FileStorage-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;FileStorage directory=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="FileStorage.write_context" class="classattr">
                                        <input id="FileStorage.write_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">context</span><span class="p">:</span> <span class="n"><a href="#Context">Context</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FileStorage.write_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.write_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.write_context-131"><a href="#FileStorage.write_context-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">write_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="FileStorage.write_context-132"><a href="#FileStorage.write_context-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.write_context-133"><a href="#FileStorage.write_context-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.write_context-134"><a href="#FileStorage.write_context-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_context_into</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage.write_context-135"><a href="#FileStorage.write_context-135"><span class="linenos">135</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.write_context-136"><a href="#FileStorage.write_context-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write context into persistent storage</p>
</div>


                            </div>
                            <div id="FileStorage.read" class="classattr">
                                        <input id="FileStorage.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.read-175"><a href="#FileStorage.read-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage.read-176"><a href="#FileStorage.read-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.read-177"><a href="#FileStorage.read-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read-178"><a href="#FileStorage.read-178"><span class="linenos">178</span></a>        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read-179"><a href="#FileStorage.read-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="FileStorage.read-180"><a href="#FileStorage.read-180"><span class="linenos">180</span></a>            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="FileStorage.read-181"><a href="#FileStorage.read-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read unserialized context from the storage</p>
</div>


                            </div>
                            <div id="FileStorage.read_root" class="classattr">
                                        <input id="FileStorage.read_root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_root</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.read_root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.read_root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.read_root-183"><a href="#FileStorage.read_root-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage.read_root-184"><a href="#FileStorage.read_root-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.read_root-185"><a href="#FileStorage.read_root-185"><span class="linenos">185</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-186"><a href="#FileStorage.read_root-186"><span class="linenos">186</span></a>        <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read_root-187"><a href="#FileStorage.read_root-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">context</span><span class="p">:</span>
</span><span id="FileStorage.read_root-188"><a href="#FileStorage.read_root-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">context</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_children</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage.read_root-189"><a href="#FileStorage.read_root-189"><span class="linenos">189</span></a>
</span><span id="FileStorage.read_root-190"><a href="#FileStorage.read_root-190"><span class="linenos">190</span></a>        <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read_root-191"><a href="#FileStorage.read_root-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
</span><span id="FileStorage.read_root-192"><a href="#FileStorage.read_root-192"><span class="linenos">192</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-193"><a href="#FileStorage.read_root-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage.read_root-194"><a href="#FileStorage.read_root-194"><span class="linenos">194</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-195"><a href="#FileStorage.read_root-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read context without children</p>
</div>


                            </div>
                            <div id="FileStorage.list" class="classattr">
                                        <input id="FileStorage.list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.list-219"><a href="#FileStorage.list-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FileStorage.list-220"><a href="#FileStorage.list-220"><span class="linenos">220</span></a>        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s2">&quot;.root.gz&quot;</span>
</span><span id="FileStorage.list-221"><a href="#FileStorage.list-221"><span class="linenos">221</span></a>        <span class="n">dir_suffix</span> <span class="o">=</span> <span class="s2">&quot;.ctx&quot;</span>
</span><span id="FileStorage.list-222"><a href="#FileStorage.list-222"><span class="linenos">222</span></a>
</span><span id="FileStorage.list-223"><a href="#FileStorage.list-223"><span class="linenos">223</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.list-224"><a href="#FileStorage.list-224"><span class="linenos">224</span></a>            <span class="n">ephemeral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="FileStorage.list-225"><a href="#FileStorage.list-225"><span class="linenos">225</span></a>
</span><span id="FileStorage.list-226"><a href="#FileStorage.list-226"><span class="linenos">226</span></a>        <span class="n">lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage.list-227"><a href="#FileStorage.list-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="FileStorage.list-228"><a href="#FileStorage.list-228"><span class="linenos">228</span></a>            <span class="n">ephemeral</span>
</span><span id="FileStorage.list-229"><a href="#FileStorage.list-229"><span class="linenos">229</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span>
</span><span id="FileStorage.list-230"><a href="#FileStorage.list-230"><span class="linenos">230</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span>
</span><span id="FileStorage.list-231"><a href="#FileStorage.list-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List all context uids in storage</p>
</div>


                            </div>
                            <div id="FileStorage.remove_context" class="classattr">
                                        <input id="FileStorage.remove_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FileStorage.remove_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.remove_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.remove_context-233"><a href="#FileStorage.remove_context-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage.remove_context-234"><a href="#FileStorage.remove_context-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.remove_context-235"><a href="#FileStorage.remove_context-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-236"><a href="#FileStorage.remove_context-236"><span class="linenos">236</span></a>        <span class="c1"># First try to remove .root, so it immediately disappear from listing</span>
</span><span id="FileStorage.remove_context-237"><a href="#FileStorage.remove_context-237"><span class="linenos">237</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-238"><a href="#FileStorage.remove_context-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage.remove_context-239"><a href="#FileStorage.remove_context-239"><span class="linenos">239</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-240"><a href="#FileStorage.remove_context-240"><span class="linenos">240</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-241"><a href="#FileStorage.remove_context-241"><span class="linenos">241</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-242"><a href="#FileStorage.remove_context-242"><span class="linenos">242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage.remove_context-243"><a href="#FileStorage.remove_context-243"><span class="linenos">243</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-244"><a href="#FileStorage.remove_context-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage.remove_context-245"><a href="#FileStorage.remove_context-245"><span class="linenos">245</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_context-246"><a href="#FileStorage.remove_context-246"><span class="linenos">246</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.remove_context-247"><a href="#FileStorage.remove_context-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove context from storage</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StorageBase">StorageBase</a></dt>
                                <dd id="FileStorage.register_context" class="function"><a href="#StorageBase.register_context">register_context</a></dd>
                <dd id="FileStorage.get_ephemeral_context" class="function"><a href="#StorageBase.get_ephemeral_context">get_ephemeral_context</a></dd>
                <dd id="FileStorage.read_roots" class="function"><a href="#StorageBase.read_roots">read_roots</a></dd>
                <dd id="FileStorage.read_context" class="function"><a href="#StorageBase.read_context">read_context</a></dd>
                <dd id="FileStorage.read_all_contexts" class="function"><a href="#StorageBase.read_all_contexts">read_all_contexts</a></dd>
                <dd id="FileStorage.live_display" class="function"><a href="#StorageBase.live_display">live_display</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="StorageBase">
                            <input id="StorageBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StorageBase</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="StorageBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase-20"><a href="#StorageBase-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">StorageBase</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="StorageBase-21"><a href="#StorageBase-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-22"><a href="#StorageBase-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="StorageBase-23"><a href="#StorageBase-23"><span class="linenos"> 23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StorageBase-24"><a href="#StorageBase-24"><span class="linenos"> 24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StorageBase-25"><a href="#StorageBase-25"><span class="linenos"> 25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StorageBase-26"><a href="#StorageBase-26"><span class="linenos"> 26</span></a>
</span><span id="StorageBase-27"><a href="#StorageBase-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="nf">register_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="StorageBase-28"><a href="#StorageBase-28"><span class="linenos"> 28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register running context (without writing into the persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase-29"><a href="#StorageBase-29"><span class="linenos"> 29</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase-30"><a href="#StorageBase-30"><span class="linenos"> 30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>
</span><span id="StorageBase-31"><a href="#StorageBase-31"><span class="linenos"> 31</span></a>
</span><span id="StorageBase-32"><a href="#StorageBase-32"><span class="linenos"> 32</span></a>    <span class="k">def</span> <span class="nf">get_ephemeral_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="StorageBase-33"><a href="#StorageBase-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get running context (not from persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase-34"><a href="#StorageBase-34"><span class="linenos"> 34</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase-35"><a href="#StorageBase-35"><span class="linenos"> 35</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="StorageBase-36"><a href="#StorageBase-36"><span class="linenos"> 36</span></a>
</span><span id="StorageBase-37"><a href="#StorageBase-37"><span class="linenos"> 37</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-38"><a href="#StorageBase-38"><span class="linenos"> 38</span></a>    <span class="k">def</span> <span class="nf">write_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="StorageBase-39"><a href="#StorageBase-39"><span class="linenos"> 39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write context into persistent storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-40"><a href="#StorageBase-40"><span class="linenos"> 40</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-41"><a href="#StorageBase-41"><span class="linenos"> 41</span></a>
</span><span id="StorageBase-42"><a href="#StorageBase-42"><span class="linenos"> 42</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-43"><a href="#StorageBase-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase-44"><a href="#StorageBase-44"><span class="linenos"> 44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read unserialized context from the storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-45"><a href="#StorageBase-45"><span class="linenos"> 45</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-46"><a href="#StorageBase-46"><span class="linenos"> 46</span></a>
</span><span id="StorageBase-47"><a href="#StorageBase-47"><span class="linenos"> 47</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-48"><a href="#StorageBase-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase-49"><a href="#StorageBase-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read context without children&quot;&quot;&quot;</span>
</span><span id="StorageBase-50"><a href="#StorageBase-50"><span class="linenos"> 50</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-51"><a href="#StorageBase-51"><span class="linenos"> 51</span></a>
</span><span id="StorageBase-52"><a href="#StorageBase-52"><span class="linenos"> 52</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-53"><a href="#StorageBase-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StorageBase-54"><a href="#StorageBase-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove context from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-55"><a href="#StorageBase-55"><span class="linenos"> 55</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-56"><a href="#StorageBase-56"><span class="linenos"> 56</span></a>
</span><span id="StorageBase-57"><a href="#StorageBase-57"><span class="linenos"> 57</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-58"><a href="#StorageBase-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="StorageBase-59"><a href="#StorageBase-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all context uids in storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-60"><a href="#StorageBase-60"><span class="linenos"> 60</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-61"><a href="#StorageBase-61"><span class="linenos"> 61</span></a>
</span><span id="StorageBase-62"><a href="#StorageBase-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">read_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Data</span><span class="p">]:</span>
</span><span id="StorageBase-63"><a href="#StorageBase-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read given root contexts without children&quot;&quot;&quot;</span>
</span><span id="StorageBase-64"><a href="#StorageBase-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_root</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">]</span>
</span><span id="StorageBase-65"><a href="#StorageBase-65"><span class="linenos"> 65</span></a>
</span><span id="StorageBase-66"><a href="#StorageBase-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">read_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span><span class="p">:</span>
</span><span id="StorageBase-67"><a href="#StorageBase-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and serialize context from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-68"><a href="#StorageBase-68"><span class="linenos"> 68</span></a>        <span class="k">return</span> <span class="n">Context</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
</span><span id="StorageBase-69"><a href="#StorageBase-69"><span class="linenos"> 69</span></a>
</span><span id="StorageBase-70"><a href="#StorageBase-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="nf">read_all_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="StorageBase-71"><a href="#StorageBase-71"><span class="linenos"> 71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read all contexts from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-72"><a href="#StorageBase-72"><span class="linenos"> 72</span></a>        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="StorageBase-73"><a href="#StorageBase-73"><span class="linenos"> 73</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="StorageBase-74"><a href="#StorageBase-74"><span class="linenos"> 74</span></a>
</span><span id="StorageBase-75"><a href="#StorageBase-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">live_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;95%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">):</span>
</span><span id="StorageBase-76"><a href="#StorageBase-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show context in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="StorageBase-77"><a href="#StorageBase-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-78"><a href="#StorageBase-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_server</span><span class="p">()</span>
</span><span id="StorageBase-79"><a href="#StorageBase-79"><span class="linenos"> 79</span></a>        <span class="n">display_iframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span><span id="StorageBase-80"><a href="#StorageBase-80"><span class="linenos"> 80</span></a>
</span><span id="StorageBase-81"><a href="#StorageBase-81"><span class="linenos"> 81</span></a>    <span class="nd">@property</span>
</span><span id="StorageBase-82"><a href="#StorageBase-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-83"><a href="#StorageBase-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-84"><a href="#StorageBase-84"><span class="linenos"> 84</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Server not stared. Use method &#39;start_server&#39; on storage&quot;</span><span class="p">)</span>
</span><span id="StorageBase-85"><a href="#StorageBase-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>
</span><span id="StorageBase-86"><a href="#StorageBase-86"><span class="linenos"> 86</span></a>
</span><span id="StorageBase-87"><a href="#StorageBase-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">start_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="StorageBase-88"><a href="#StorageBase-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-89"><a href="#StorageBase-89"><span class="linenos"> 89</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Server already started&quot;</span><span class="p">)</span>
</span><span id="StorageBase-90"><a href="#StorageBase-90"><span class="linenos"> 90</span></a>        <span class="kn">from</span> <span class="nn">..ui.storage_server</span> <span class="kn">import</span> <span class="n">start_storage_server</span>
</span><span id="StorageBase-91"><a href="#StorageBase-91"><span class="linenos"> 91</span></a>
</span><span id="StorageBase-92"><a href="#StorageBase-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">start_storage_server</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span><span id="StorageBase-93"><a href="#StorageBase-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>
</span><span id="StorageBase-94"><a href="#StorageBase-94"><span class="linenos"> 94</span></a>
</span><span id="StorageBase-95"><a href="#StorageBase-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">find_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="StorageBase-96"><a href="#StorageBase-96"><span class="linenos"> 96</span></a>        <span class="k">for</span> <span class="n">context</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_all_contexts</span><span class="p">():</span>
</span><span id="StorageBase-97"><a href="#StorageBase-97"><span class="linenos"> 97</span></a>            <span class="k">yield from</span> <span class="n">context</span><span class="o">.</span><span class="n">find_contexts</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</span><span id="StorageBase-98"><a href="#StorageBase-98"><span class="linenos"> 98</span></a>
</span><span id="StorageBase-99"><a href="#StorageBase-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-100"><a href="#StorageBase-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">:</span>
</span><span id="StorageBase-101"><a href="#StorageBase-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Storage is already active&quot;</span><span class="p">)</span>
</span><span id="StorageBase-102"><a href="#StorageBase-102"><span class="linenos">102</span></a>        <span class="n">old</span> <span class="o">=</span> <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="StorageBase-103"><a href="#StorageBase-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">old</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
</span><span id="StorageBase-104"><a href="#StorageBase-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="StorageBase-105"><a href="#StorageBase-105"><span class="linenos">105</span></a>
</span><span id="StorageBase-106"><a href="#StorageBase-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">_exc_tb</span><span class="p">):</span>
</span><span id="StorageBase-107"><a href="#StorageBase-107"><span class="linenos">107</span></a>        <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">)</span>
</span><span id="StorageBase-108"><a href="#StorageBase-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="StorageBase.register_context" class="classattr">
                                        <input id="StorageBase.register_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">context</span><span class="p">:</span> <span class="n"><a href="#Context">Context</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.register_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.register_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.register_context-27"><a href="#StorageBase.register_context-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">register_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="StorageBase.register_context-28"><a href="#StorageBase.register_context-28"><span class="linenos">28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register running context (without writing into the persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase.register_context-29"><a href="#StorageBase.register_context-29"><span class="linenos">29</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase.register_context-30"><a href="#StorageBase.register_context-30"><span class="linenos">30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="p">[</span><span class="n">context</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>
</span></pre></div>


            <div class="docstring"><p>Register running context (without writing into the persistent storage)</p>
</div>


                            </div>
                            <div id="StorageBase.get_ephemeral_context" class="classattr">
                                        <input id="StorageBase.get_ephemeral_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ephemeral_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Context">Context</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.get_ephemeral_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.get_ephemeral_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.get_ephemeral_context-32"><a href="#StorageBase.get_ephemeral_context-32"><span class="linenos">32</span></a>    <span class="k">def</span> <span class="nf">get_ephemeral_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="StorageBase.get_ephemeral_context-33"><a href="#StorageBase.get_ephemeral_context-33"><span class="linenos">33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get running context (not from persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase.get_ephemeral_context-34"><a href="#StorageBase.get_ephemeral_context-34"><span class="linenos">34</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase.get_ephemeral_context-35"><a href="#StorageBase.get_ephemeral_context-35"><span class="linenos">35</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_contexts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get running context (not from persistent storage)</p>
</div>


                            </div>
                            <div id="StorageBase.write_context" class="classattr">
                                        <input id="StorageBase.write_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">write_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">context</span><span class="p">:</span> <span class="n"><a href="#Context">Context</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.write_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.write_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.write_context-37"><a href="#StorageBase.write_context-37"><span class="linenos">37</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.write_context-38"><a href="#StorageBase.write_context-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">write_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Context</span><span class="p">):</span>
</span><span id="StorageBase.write_context-39"><a href="#StorageBase.write_context-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write context into persistent storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.write_context-40"><a href="#StorageBase.write_context-40"><span class="linenos">40</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Write context into persistent storage</p>
</div>


                            </div>
                            <div id="StorageBase.read" class="classattr">
                                        <input id="StorageBase.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read-42"><a href="#StorageBase.read-42"><span class="linenos">42</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.read-43"><a href="#StorageBase.read-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase.read-44"><a href="#StorageBase.read-44"><span class="linenos">44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read unserialized context from the storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read-45"><a href="#StorageBase.read-45"><span class="linenos">45</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Read unserialized context from the storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_root" class="classattr">
                                        <input id="StorageBase.read_root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">read_root</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_root-47"><a href="#StorageBase.read_root-47"><span class="linenos">47</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.read_root-48"><a href="#StorageBase.read_root-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase.read_root-49"><a href="#StorageBase.read_root-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read context without children&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_root-50"><a href="#StorageBase.read_root-50"><span class="linenos">50</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Read context without children</p>
</div>


                            </div>
                            <div id="StorageBase.remove_context" class="classattr">
                                        <input id="StorageBase.remove_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">remove_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.remove_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.remove_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.remove_context-52"><a href="#StorageBase.remove_context-52"><span class="linenos">52</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.remove_context-53"><a href="#StorageBase.remove_context-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">remove_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StorageBase.remove_context-54"><a href="#StorageBase.remove_context-54"><span class="linenos">54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove context from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.remove_context-55"><a href="#StorageBase.remove_context-55"><span class="linenos">55</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Remove context from storage</p>
</div>


                            </div>
                            <div id="StorageBase.list" class="classattr">
                                        <input id="StorageBase.list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.list-57"><a href="#StorageBase.list-57"><span class="linenos">57</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.list-58"><a href="#StorageBase.list-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="StorageBase.list-59"><a href="#StorageBase.list-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all context uids in storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.list-60"><a href="#StorageBase.list-60"><span class="linenos">60</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>List all context uids in storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_roots" class="classattr">
                                        <input id="StorageBase.read_roots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_roots</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_roots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_roots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_roots-62"><a href="#StorageBase.read_roots-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="nf">read_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Data</span><span class="p">]:</span>
</span><span id="StorageBase.read_roots-63"><a href="#StorageBase.read_roots-63"><span class="linenos">63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read given root contexts without children&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_roots-64"><a href="#StorageBase.read_roots-64"><span class="linenos">64</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_root</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Read given root contexts without children</p>
</div>


                            </div>
                            <div id="StorageBase.read_context" class="classattr">
                                        <input id="StorageBase.read_context-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_context</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#Context">Context</a></span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_context-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_context"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_context-66"><a href="#StorageBase.read_context-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">read_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Context</span><span class="p">:</span>
</span><span id="StorageBase.read_context-67"><a href="#StorageBase.read_context-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and serialize context from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_context-68"><a href="#StorageBase.read_context-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="n">Context</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Read and serialize context from storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_all_contexts" class="classattr">
                                        <input id="StorageBase.read_all_contexts-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_all_contexts</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#Context">Context</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_all_contexts-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_all_contexts"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_all_contexts-70"><a href="#StorageBase.read_all_contexts-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">read_all_contexts</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">Context</span><span class="p">]:</span>
</span><span id="StorageBase.read_all_contexts-71"><a href="#StorageBase.read_all_contexts-71"><span class="linenos">71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read all contexts from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_all_contexts-72"><a href="#StorageBase.read_all_contexts-72"><span class="linenos">72</span></a>        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="StorageBase.read_all_contexts-73"><a href="#StorageBase.read_all_contexts-73"><span class="linenos">73</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_context</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read all contexts from storage</p>
</div>


                            </div>
                            <div id="StorageBase.live_display" class="classattr">
                                        <input id="StorageBase.live_display-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">live_display</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">width</span><span class="o">=</span><span class="s1">&#39;95%&#39;</span>, </span><span class="param"><span class="n">height</span><span class="o">=</span><span class="mi">700</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.live_display-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.live_display"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.live_display-75"><a href="#StorageBase.live_display-75"><span class="linenos">75</span></a>    <span class="k">def</span> <span class="nf">live_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;95%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">):</span>
</span><span id="StorageBase.live_display-76"><a href="#StorageBase.live_display-76"><span class="linenos">76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show context in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="StorageBase.live_display-77"><a href="#StorageBase.live_display-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase.live_display-78"><a href="#StorageBase.live_display-78"><span class="linenos">78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_server</span><span class="p">()</span>
</span><span id="StorageBase.live_display-79"><a href="#StorageBase.live_display-79"><span class="linenos">79</span></a>        <span class="n">display_iframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Show context in Jupyter notebook</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>