<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>treetrace API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#TracingNode">TracingNode</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#TracingNode.__init__">TracingNode</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.deserialize">deserialize</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.to_dict">to_dict</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.add_tag">add_tag</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.add_input">add_input</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.add_inputs">add_inputs</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.set_result">set_result</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.set_error">set_error</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.has_tag_name">has_tag_name</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.find_nodes">find_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#TracingNode.display">display</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Tag">Tag</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Tag.name">name</a>
                        </li>
                        <li>
                                <a class="variable" href="#Tag.color">color</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#current_tracing_node">current_tracing_node</a>
            </li>
            <li>
                    <a class="function" href="#with_trace">with_trace</a>
            </li>
            <li>
                    <a class="class" href="#FileStorage">FileStorage</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FileStorage.write_node">write_node</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.read_root">read_root</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.list">list</a>
                        </li>
                        <li>
                                <a class="function" href="#FileStorage.remove_node">remove_node</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#StorageBase">StorageBase</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#StorageBase.register_node">register_node</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.get_ephemeral_node">get_ephemeral_node</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.write_node">write_node</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read">read</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_root">read_root</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.remove_node">remove_node</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.list">list</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_roots">read_roots</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_node">read_node</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.read_all_nodes">read_all_nodes</a>
                        </li>
                        <li>
                                <a class="function" href="#StorageBase.live_display">live_display</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Html">Html</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#FormatStr">FormatStr</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#FormatStr.free_params">free_params</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#HtmlColor">HtmlColor</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#HtmlColor.as_floats">as_floats</a>
                        </li>
                        <li>
                                <a class="function" href="#HtmlColor.from_floats">from_floats</a>
                        </li>
                        <li>
                                <a class="function" href="#HtmlColor.lighter">lighter</a>
                        </li>
                        <li>
                                <a class="function" href="#HtmlColor.darker">darker</a>
                        </li>
                        <li>
                                <a class="function" href="#HtmlColor.with_alpha">with_alpha</a>
                        </li>
                        <li>
                                <a class="function" href="#HtmlColor.random_color">random_color</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
treetrace    </h1>

                
                        <input id="mod-treetrace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-treetrace-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">.tracing.tracingnode</span> <span class="kn">import</span> <span class="n">TracingNode</span><span class="p">,</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">current_tracing_node</span><span class="p">,</span> <span class="n">with_trace</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">treetrace.tracing.serialization</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a>    <span class="n">register_custom_serializer</span><span class="p">,</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>    <span class="n">unregister_custom_serializer</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="p">)</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.tracing.data.format_str</span> <span class="kn">import</span> <span class="n">FormatStr</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.tracing.data.blob</span> <span class="kn">import</span> <span class="n">DataWithMime</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.tracing.data.html</span> <span class="kn">import</span> <span class="n">Html</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span> <span class="nn">.tracing.storage</span> <span class="kn">import</span> <span class="n">FileStorage</span><span class="p">,</span> <span class="n">StorageBase</span><span class="p">,</span> <span class="n">current_storage</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">.utils.html_color</span> <span class="kn">import</span> <span class="n">HtmlColor</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span> <span class="nn">.utils.text</span> <span class="kn">import</span> <span class="n">shorten_str</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span> <span class="nn">.ui.console_server</span> <span class="kn">import</span> <span class="n">ConsoleServer</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ext</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a>    <span class="s2">&quot;TracingNode&quot;</span><span class="p">,</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="s2">&quot;Tag&quot;</span><span class="p">,</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="s2">&quot;current_tracing_node&quot;</span><span class="p">,</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;current_storage&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;with_trace&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;FileStorage&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;StorageBase&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;DataWithMime&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;Html&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;FormatStr&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;ext&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a>    <span class="s2">&quot;HtmlColor&quot;</span><span class="p">,</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>    <span class="s2">&quot;shorten_str&quot;</span><span class="p">,</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a>    <span class="s2">&quot;ConsoleServer&quot;</span><span class="p">,</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">30</span></a>    <span class="s2">&quot;register_custom_serializer&quot;</span><span class="p">,</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">31</span></a>    <span class="s2">&quot;unregister_custom_serializer&quot;</span><span class="p">,</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">32</span></a><span class="p">]</span>
</span></pre></div>


            </section>
                <section id="TracingNode">
                            <input id="TracingNode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TracingNode</span>:

                <label class="view-source-button" for="TracingNode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode-57"><a href="#TracingNode-57"><span class="linenos"> 57</span></a><span class="k">class</span> <span class="nc">TracingNode</span><span class="p">:</span>
</span><span id="TracingNode-58"><a href="#TracingNode-58"><span class="linenos"> 58</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-59"><a href="#TracingNode-59"><span class="linenos"> 59</span></a><span class="sd">    A tracing object that represents a single request or (sub)task in a nested hierarchy.</span>
</span><span id="TracingNode-60"><a href="#TracingNode-60"><span class="linenos"> 60</span></a>
</span><span id="TracingNode-61"><a href="#TracingNode-61"><span class="linenos"> 61</span></a><span class="sd">    The class has several attributes that are intended as read-only; use setters to modify them.</span>
</span><span id="TracingNode-62"><a href="#TracingNode-62"><span class="linenos"> 62</span></a>
</span><span id="TracingNode-63"><a href="#TracingNode-63"><span class="linenos"> 63</span></a><span class="sd">    The `TracingNode` can be used as context manager, e.g.:</span>
</span><span id="TracingNode-64"><a href="#TracingNode-64"><span class="linenos"> 64</span></a>
</span><span id="TracingNode-65"><a href="#TracingNode-65"><span class="linenos"> 65</span></a><span class="sd">    ```python</span>
</span><span id="TracingNode-66"><a href="#TracingNode-66"><span class="linenos"> 66</span></a><span class="sd">    with TracingNode(&quot;my node&quot;, inputs={&quot;z&quot;: 42}) as c:</span>
</span><span id="TracingNode-67"><a href="#TracingNode-67"><span class="linenos"> 67</span></a><span class="sd">        c.add_input(&quot;x&quot;, 1)</span>
</span><span id="TracingNode-68"><a href="#TracingNode-68"><span class="linenos"> 68</span></a><span class="sd">        y = do_some_computation(x=1)</span>
</span><span id="TracingNode-69"><a href="#TracingNode-69"><span class="linenos"> 69</span></a><span class="sd">        # The tracing node would also note any exceptions raised here</span>
</span><span id="TracingNode-70"><a href="#TracingNode-70"><span class="linenos"> 70</span></a><span class="sd">        # (letting it propagate upwards), but a result needs to be set manually:</span>
</span><span id="TracingNode-71"><a href="#TracingNode-71"><span class="linenos"> 71</span></a><span class="sd">        c.set_result(y)</span>
</span><span id="TracingNode-72"><a href="#TracingNode-72"><span class="linenos"> 72</span></a><span class="sd">    # &lt;- Here the tracing node is already closed.</span>
</span><span id="TracingNode-73"><a href="#TracingNode-73"><span class="linenos"> 73</span></a><span class="sd">    ```</span>
</span><span id="TracingNode-74"><a href="#TracingNode-74"><span class="linenos"> 74</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="TracingNode-75"><a href="#TracingNode-75"><span class="linenos"> 75</span></a>
</span><span id="TracingNode-76"><a href="#TracingNode-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="TracingNode-77"><a href="#TracingNode-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TracingNode-78"><a href="#TracingNode-78"><span class="linenos"> 78</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TracingNode-79"><a href="#TracingNode-79"><span class="linenos"> 79</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-80"><a href="#TracingNode-80"><span class="linenos"> 80</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-81"><a href="#TracingNode-81"><span class="linenos"> 81</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-82"><a href="#TracingNode-82"><span class="linenos"> 82</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-83"><a href="#TracingNode-83"><span class="linenos"> 83</span></a>        <span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StorageBase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-84"><a href="#TracingNode-84"><span class="linenos"> 84</span></a>        <span class="n">directory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TracingNode-85"><a href="#TracingNode-85"><span class="linenos"> 85</span></a>        <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-86"><a href="#TracingNode-86"><span class="linenos"> 86</span></a>    <span class="p">):</span>
</span><span id="TracingNode-87"><a href="#TracingNode-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-88"><a href="#TracingNode-88"><span class="linenos"> 88</span></a><span class="sd">        - `name` - A description or name for the tracing node.</span>
</span><span id="TracingNode-89"><a href="#TracingNode-89"><span class="linenos"> 89</span></a><span class="sd">        - `kind` - Indicates category of the tracing node, may e.g. influence display of the tracing node.</span>
</span><span id="TracingNode-90"><a href="#TracingNode-90"><span class="linenos"> 90</span></a><span class="sd">        - `inputs` - A dictionary of inputs for the tracing node.</span>
</span><span id="TracingNode-91"><a href="#TracingNode-91"><span class="linenos"> 91</span></a><span class="sd">        - `meta` - A dictionary of any metadata for the tracing node, e.g. UI style data.</span>
</span><span id="TracingNode-92"><a href="#TracingNode-92"><span class="linenos"> 92</span></a><span class="sd">        - `tags` - A list of tags for the tracing node</span>
</span><span id="TracingNode-93"><a href="#TracingNode-93"><span class="linenos"> 93</span></a><span class="sd">        - `storage` - A storage object for the tracing node. Set on the root tracing node to log all nodes below it.</span>
</span><span id="TracingNode-94"><a href="#TracingNode-94"><span class="linenos"> 94</span></a><span class="sd">        - `directory` - Whether to create a sub-directory for the tracing node while storing.</span>
</span><span id="TracingNode-95"><a href="#TracingNode-95"><span class="linenos"> 95</span></a><span class="sd">          This allows you to split the stored data across multiple files.</span>
</span><span id="TracingNode-96"><a href="#TracingNode-96"><span class="linenos"> 96</span></a><span class="sd">        - `result` - The result value of the tracing node, if it has already been computed.</span>
</span><span id="TracingNode-97"><a href="#TracingNode-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-98"><a href="#TracingNode-98"><span class="linenos"> 98</span></a>
</span><span id="TracingNode-99"><a href="#TracingNode-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">storage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_tracing_node</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-100"><a href="#TracingNode-100"><span class="linenos">100</span></a>            <span class="n">storage</span> <span class="o">=</span> <span class="n">current_storage</span><span class="p">()</span>
</span><span id="TracingNode-101"><a href="#TracingNode-101"><span class="linenos">101</span></a>
</span><span id="TracingNode-102"><a href="#TracingNode-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode-103"><a href="#TracingNode-103"><span class="linenos">103</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="TracingNode-104"><a href="#TracingNode-104"><span class="linenos">104</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
</span><span id="TracingNode-105"><a href="#TracingNode-105"><span class="linenos">105</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="TracingNode-106"><a href="#TracingNode-106"><span class="linenos">106</span></a>
</span><span id="TracingNode-107"><a href="#TracingNode-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
</span><span id="TracingNode-108"><a href="#TracingNode-108"><span class="linenos">108</span></a>            <span class="n">meta</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</span><span id="TracingNode-109"><a href="#TracingNode-109"><span class="linenos">109</span></a>
</span><span id="TracingNode-110"><a href="#TracingNode-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="TracingNode-111"><a href="#TracingNode-111"><span class="linenos">111</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="TracingNode-112"><a href="#TracingNode-112"><span class="linenos">112</span></a>
</span><span id="TracingNode-113"><a href="#TracingNode-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-114"><a href="#TracingNode-114"><span class="linenos">114</span></a>            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
</span><span id="TracingNode-115"><a href="#TracingNode-115"><span class="linenos">115</span></a>
</span><span id="TracingNode-116"><a href="#TracingNode-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="TracingNode-117"><a href="#TracingNode-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
</span><span id="TracingNode-118"><a href="#TracingNode-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
</span><span id="TracingNode-119"><a href="#TracingNode-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="TracingNode-120"><a href="#TracingNode-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-121"><a href="#TracingNode-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">TracingNodeState</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TracingNode-122"><a href="#TracingNode-122"><span class="linenos">122</span></a>            <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">NEW</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="TracingNode-123"><a href="#TracingNode-123"><span class="linenos">123</span></a>        <span class="p">)</span>
</span><span id="TracingNode-124"><a href="#TracingNode-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">generate_uid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="TracingNode-125"><a href="#TracingNode-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TracingNode-126"><a href="#TracingNode-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
</span><span id="TracingNode-127"><a href="#TracingNode-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-128"><a href="#TracingNode-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="TracingNode-129"><a href="#TracingNode-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
</span><span id="TracingNode-130"><a href="#TracingNode-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
</span><span id="TracingNode-131"><a href="#TracingNode-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="TracingNode-132"><a href="#TracingNode-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-133"><a href="#TracingNode-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TracingNode-134"><a href="#TracingNode-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="TracingNode-135"><a href="#TracingNode-135"><span class="linenos">135</span></a>
</span><span id="TracingNode-136"><a href="#TracingNode-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">storage</span><span class="p">:</span>
</span><span id="TracingNode-137"><a href="#TracingNode-137"><span class="linenos">137</span></a>            <span class="n">storage</span><span class="o">.</span><span class="n">register_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-138"><a href="#TracingNode-138"><span class="linenos">138</span></a>
</span><span id="TracingNode-139"><a href="#TracingNode-139"><span class="linenos">139</span></a>    <span class="nd">@classmethod</span>
</span><span id="TracingNode-140"><a href="#TracingNode-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="TracingNode-141"><a href="#TracingNode-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-142"><a href="#TracingNode-142"><span class="linenos">142</span></a><span class="sd">        Deserialize a `TracingNode` object from given JSON data.</span>
</span><span id="TracingNode-143"><a href="#TracingNode-143"><span class="linenos">143</span></a>
</span><span id="TracingNode-144"><a href="#TracingNode-144"><span class="linenos">144</span></a><span class="sd">        - `data` - A dictionary containing the serialized tracing data.</span>
</span><span id="TracingNode-145"><a href="#TracingNode-145"><span class="linenos">145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-146"><a href="#TracingNode-146"><span class="linenos">146</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="TracingNode-147"><a href="#TracingNode-147"><span class="linenos">147</span></a>
</span><span id="TracingNode-148"><a href="#TracingNode-148"><span class="linenos">148</span></a>        <span class="c1"># For backward compatibility we also &quot;Context&quot;</span>
</span><span id="TracingNode-149"><a href="#TracingNode-149"><span class="linenos">149</span></a>        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TracingNode&quot;</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Context&quot;</span>
</span><span id="TracingNode-150"><a href="#TracingNode-150"><span class="linenos">150</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="TracingNode-151"><a href="#TracingNode-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
</span><span id="TracingNode-152"><a href="#TracingNode-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="TracingNode-153"><a href="#TracingNode-153"><span class="linenos">153</span></a>
</span><span id="TracingNode-154"><a href="#TracingNode-154"><span class="linenos">154</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
</span><span id="TracingNode-155"><a href="#TracingNode-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
</span><span id="TracingNode-156"><a href="#TracingNode-156"><span class="linenos">156</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="TracingNode-157"><a href="#TracingNode-157"><span class="linenos">157</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-158"><a href="#TracingNode-158"><span class="linenos">158</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="TracingNode-159"><a href="#TracingNode-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
</span><span id="TracingNode-160"><a href="#TracingNode-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]:</span>
</span><span id="TracingNode-161"><a href="#TracingNode-161"><span class="linenos">161</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span id="TracingNode-162"><a href="#TracingNode-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">)</span>
</span><span id="TracingNode-163"><a href="#TracingNode-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span>
</span><span id="TracingNode-164"><a href="#TracingNode-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
</span><span id="TracingNode-165"><a href="#TracingNode-165"><span class="linenos">165</span></a>
</span><span id="TracingNode-166"><a href="#TracingNode-166"><span class="linenos">166</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span>
</span><span id="TracingNode-167"><a href="#TracingNode-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-168"><a href="#TracingNode-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-169"><a href="#TracingNode-169"><span class="linenos">169</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-170"><a href="#TracingNode-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="TracingNode-171"><a href="#TracingNode-171"><span class="linenos">171</span></a>
</span><span id="TracingNode-172"><a href="#TracingNode-172"><span class="linenos">172</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
</span><span id="TracingNode-173"><a href="#TracingNode-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-174"><a href="#TracingNode-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-175"><a href="#TracingNode-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-176"><a href="#TracingNode-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
</span><span id="TracingNode-177"><a href="#TracingNode-177"><span class="linenos">177</span></a>
</span><span id="TracingNode-178"><a href="#TracingNode-178"><span class="linenos">178</span></a>        <span class="n">children</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)</span>
</span><span id="TracingNode-179"><a href="#TracingNode-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-180"><a href="#TracingNode-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-181"><a href="#TracingNode-181"><span class="linenos">181</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-182"><a href="#TracingNode-182"><span class="linenos">182</span></a>            <span class="n">new_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TracingNode-183"><a href="#TracingNode-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TracingNode-184"><a href="#TracingNode-184"><span class="linenos">184</span></a>                <span class="n">TracingNode</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">new_depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span>
</span><span id="TracingNode-185"><a href="#TracingNode-185"><span class="linenos">185</span></a>            <span class="p">]</span>
</span><span id="TracingNode-186"><a href="#TracingNode-186"><span class="linenos">186</span></a>
</span><span id="TracingNode-187"><a href="#TracingNode-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-188"><a href="#TracingNode-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="TracingNode-189"><a href="#TracingNode-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="TracingNode-190"><a href="#TracingNode-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TracingNode-191"><a href="#TracingNode-191"><span class="linenos">191</span></a>
</span><span id="TracingNode-192"><a href="#TracingNode-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="TracingNode-193"><a href="#TracingNode-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-194"><a href="#TracingNode-194"><span class="linenos">194</span></a><span class="sd">        Serialize `TracingNode` object into JSON structure.</span>
</span><span id="TracingNode-195"><a href="#TracingNode-195"><span class="linenos">195</span></a>
</span><span id="TracingNode-196"><a href="#TracingNode-196"><span class="linenos">196</span></a><span class="sd">        - `with_children` - If True then children are recursively serialized.</span>
</span><span id="TracingNode-197"><a href="#TracingNode-197"><span class="linenos">197</span></a><span class="sd">                            If False then serialization of children is skipped and only</span>
</span><span id="TracingNode-198"><a href="#TracingNode-198"><span class="linenos">198</span></a><span class="sd">                            children UIDs are put into key `children_uids`</span>
</span><span id="TracingNode-199"><a href="#TracingNode-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-200"><a href="#TracingNode-200"><span class="linenos">200</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-201"><a href="#TracingNode-201"><span class="linenos">201</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;TracingNode&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">}</span>
</span><span id="TracingNode-202"><a href="#TracingNode-202"><span class="linenos">202</span></a>            <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
</span><span id="TracingNode-203"><a href="#TracingNode-203"><span class="linenos">203</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRACING_FORMAT_VERSION</span>
</span><span id="TracingNode-204"><a href="#TracingNode-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">:</span>
</span><span id="TracingNode-205"><a href="#TracingNode-205"><span class="linenos">205</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span>
</span><span id="TracingNode-206"><a href="#TracingNode-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
</span><span id="TracingNode-207"><a href="#TracingNode-207"><span class="linenos">207</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="TracingNode-208"><a href="#TracingNode-208"><span class="linenos">208</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-209"><a href="#TracingNode-209"><span class="linenos">209</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="TracingNode-210"><a href="#TracingNode-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode-211"><a href="#TracingNode-211"><span class="linenos">211</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="TracingNode-212"><a href="#TracingNode-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode-213"><a href="#TracingNode-213"><span class="linenos">213</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="TracingNode-214"><a href="#TracingNode-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode-215"><a href="#TracingNode-215"><span class="linenos">215</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children_uids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="TracingNode-216"><a href="#TracingNode-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
</span><span id="TracingNode-217"><a href="#TracingNode-217"><span class="linenos">217</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="TracingNode-218"><a href="#TracingNode-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span id="TracingNode-219"><a href="#TracingNode-219"><span class="linenos">219</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="TracingNode-220"><a href="#TracingNode-220"><span class="linenos">220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
</span><span id="TracingNode-221"><a href="#TracingNode-221"><span class="linenos">221</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
</span><span id="TracingNode-222"><a href="#TracingNode-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode-223"><a href="#TracingNode-223"><span class="linenos">223</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="TracingNode-224"><a href="#TracingNode-224"><span class="linenos">224</span></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="TracingNode-225"><a href="#TracingNode-225"><span class="linenos">225</span></a>
</span><span id="TracingNode-226"><a href="#TracingNode-226"><span class="linenos">226</span></a>    <span class="nd">@property</span>
</span><span id="TracingNode-227"><a href="#TracingNode-227"><span class="linenos">227</span></a>    <span class="k">def</span> <span class="nf">_pad</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TracingNode-228"><a href="#TracingNode-228"><span class="linenos">228</span></a>        <span class="k">return</span> <span class="s2">&quot; &quot;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span>
</span><span id="TracingNode-229"><a href="#TracingNode-229"><span class="linenos">229</span></a>
</span><span id="TracingNode-230"><a href="#TracingNode-230"><span class="linenos">230</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TracingNode-231"><a href="#TracingNode-231"><span class="linenos">231</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">depth</span><span class="p">):</span>
</span><span id="TracingNode-232"><a href="#TracingNode-232"><span class="linenos">232</span></a>            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-233"><a href="#TracingNode-233"><span class="linenos">233</span></a>                <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>
</span><span id="TracingNode-234"><a href="#TracingNode-234"><span class="linenos">234</span></a>                <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">NEW</span>
</span><span id="TracingNode-235"><a href="#TracingNode-235"><span class="linenos">235</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="TracingNode-236"><a href="#TracingNode-236"><span class="linenos">236</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="TracingNode-237"><a href="#TracingNode-237"><span class="linenos">237</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">_TRACING_STACK</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">parents</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
</span><span id="TracingNode-238"><a href="#TracingNode-238"><span class="linenos">238</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="TracingNode-239"><a href="#TracingNode-239"><span class="linenos">239</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="TracingNode-240"><a href="#TracingNode-240"><span class="linenos">240</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">TracingNode </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> inputs=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TracingNode-241"><a href="#TracingNode-241"><span class="linenos">241</span></a>                <span class="p">)</span>
</span><span id="TracingNode-242"><a href="#TracingNode-242"><span class="linenos">242</span></a>
</span><span id="TracingNode-243"><a href="#TracingNode-243"><span class="linenos">243</span></a>        <span class="c1"># First we need to get Lock from parent to not get in collision</span>
</span><span id="TracingNode-244"><a href="#TracingNode-244"><span class="linenos">244</span></a>        <span class="c1"># with to_dict() that goes down the tree</span>
</span><span id="TracingNode-245"><a href="#TracingNode-245"><span class="linenos">245</span></a>        <span class="n">parents</span> <span class="o">=</span> <span class="n">_TRACING_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="TracingNode-246"><a href="#TracingNode-246"><span class="linenos">246</span></a>        <span class="k">if</span> <span class="n">parents</span><span class="p">:</span>
</span><span id="TracingNode-247"><a href="#TracingNode-247"><span class="linenos">247</span></a>            <span class="n">parent</span> <span class="o">=</span> <span class="n">parents</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="TracingNode-248"><a href="#TracingNode-248"><span class="linenos">248</span></a>            <span class="k">with</span> <span class="n">parent</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>  <span class="c1"># noqa</span>
</span><span id="TracingNode-249"><a href="#TracingNode-249"><span class="linenos">249</span></a>                <span class="n">_helper</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">parents</span><span class="p">))</span>
</span><span id="TracingNode-250"><a href="#TracingNode-250"><span class="linenos">250</span></a>                <span class="n">parent</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-251"><a href="#TracingNode-251"><span class="linenos">251</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-252"><a href="#TracingNode-252"><span class="linenos">252</span></a>            <span class="n">_helper</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="TracingNode-253"><a href="#TracingNode-253"><span class="linenos">253</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="TracingNode-254"><a href="#TracingNode-254"><span class="linenos">254</span></a>
</span><span id="TracingNode-255"><a href="#TracingNode-255"><span class="linenos">255</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">_exc_tb</span><span class="p">):</span>
</span><span id="TracingNode-256"><a href="#TracingNode-256"><span class="linenos">256</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-257"><a href="#TracingNode-257"><span class="linenos">257</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>
</span><span id="TracingNode-258"><a href="#TracingNode-258"><span class="linenos">258</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">==</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">OPEN</span>
</span><span id="TracingNode-259"><a href="#TracingNode-259"><span class="linenos">259</span></a>            <span class="k">if</span> <span class="n">exc_val</span><span class="p">:</span>
</span><span id="TracingNode-260"><a href="#TracingNode-260"><span class="linenos">260</span></a>                <span class="c1"># Do not call set_error here as it takes a lock</span>
</span><span id="TracingNode-261"><a href="#TracingNode-261"><span class="linenos">261</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="TracingNode-262"><a href="#TracingNode-262"><span class="linenos">262</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc_val</span><span class="p">)</span>
</span><span id="TracingNode-263"><a href="#TracingNode-263"><span class="linenos">263</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="TracingNode-264"><a href="#TracingNode-264"><span class="linenos">264</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">-&gt; ERR  </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> error=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="n">exc_val</span><span class="p">,</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TracingNode-265"><a href="#TracingNode-265"><span class="linenos">265</span></a>                <span class="p">)</span>
</span><span id="TracingNode-266"><a href="#TracingNode-266"><span class="linenos">266</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-267"><a href="#TracingNode-267"><span class="linenos">267</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="TracingNode-268"><a href="#TracingNode-268"><span class="linenos">268</span></a>                <span class="n">_LOG</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="TracingNode-269"><a href="#TracingNode-269"><span class="linenos">269</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_pad</span><span class="si">}</span><span class="s2">-&gt; OK   </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="si">}</span><span class="s2"> result=</span><span class="si">{</span><span class="n">shorten_str</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">),</span><span class="w"> </span><span class="mi">50</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="TracingNode-270"><a href="#TracingNode-270"><span class="linenos">270</span></a>                <span class="p">)</span>
</span><span id="TracingNode-271"><a href="#TracingNode-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="TracingNode-272"><a href="#TracingNode-272"><span class="linenos">272</span></a>            <span class="n">_TRACING_STACK</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">)</span>
</span><span id="TracingNode-273"><a href="#TracingNode-273"><span class="linenos">273</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode-274"><a href="#TracingNode-274"><span class="linenos">274</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="p">:</span>
</span><span id="TracingNode-275"><a href="#TracingNode-275"><span class="linenos">275</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">storage</span><span class="o">.</span><span class="n">write_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-276"><a href="#TracingNode-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Propagate any exception</span>
</span><span id="TracingNode-277"><a href="#TracingNode-277"><span class="linenos">277</span></a>
</span><span id="TracingNode-278"><a href="#TracingNode-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="TracingNode-279"><a href="#TracingNode-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-280"><a href="#TracingNode-280"><span class="linenos">280</span></a><span class="sd">        Add a tag to the tracing node.</span>
</span><span id="TracingNode-281"><a href="#TracingNode-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-282"><a href="#TracingNode-282"><span class="linenos">282</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-283"><a href="#TracingNode-283"><span class="linenos">283</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-284"><a href="#TracingNode-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
</span><span id="TracingNode-285"><a href="#TracingNode-285"><span class="linenos">285</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode-286"><a href="#TracingNode-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span><span id="TracingNode-287"><a href="#TracingNode-287"><span class="linenos">287</span></a>
</span><span id="TracingNode-288"><a href="#TracingNode-288"><span class="linenos">288</span></a>    <span class="k">def</span> <span class="nf">add_event</span><span class="p">(</span>
</span><span id="TracingNode-289"><a href="#TracingNode-289"><span class="linenos">289</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TracingNode-290"><a href="#TracingNode-290"><span class="linenos">290</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TracingNode-291"><a href="#TracingNode-291"><span class="linenos">291</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-292"><a href="#TracingNode-292"><span class="linenos">292</span></a>        <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-293"><a href="#TracingNode-293"><span class="linenos">293</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-294"><a href="#TracingNode-294"><span class="linenos">294</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode-295"><a href="#TracingNode-295"><span class="linenos">295</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;TracingNode&quot;</span><span class="p">:</span>
</span><span id="TracingNode-296"><a href="#TracingNode-296"><span class="linenos">296</span></a>        <span class="n">event</span> <span class="o">=</span> <span class="n">TracingNode</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">meta</span><span class="o">=</span><span class="n">meta</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">)</span>
</span><span id="TracingNode-297"><a href="#TracingNode-297"><span class="linenos">297</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-298"><a href="#TracingNode-298"><span class="linenos">298</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span><span id="TracingNode-299"><a href="#TracingNode-299"><span class="linenos">299</span></a>        <span class="k">return</span> <span class="n">event</span>
</span><span id="TracingNode-300"><a href="#TracingNode-300"><span class="linenos">300</span></a>
</span><span id="TracingNode-301"><a href="#TracingNode-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="TracingNode-302"><a href="#TracingNode-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-303"><a href="#TracingNode-303"><span class="linenos">303</span></a><span class="sd">        Add a named input value to the tracing node.</span>
</span><span id="TracingNode-304"><a href="#TracingNode-304"><span class="linenos">304</span></a>
</span><span id="TracingNode-305"><a href="#TracingNode-305"><span class="linenos">305</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="TracingNode-306"><a href="#TracingNode-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-307"><a href="#TracingNode-307"><span class="linenos">307</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-308"><a href="#TracingNode-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-309"><a href="#TracingNode-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TracingNode-310"><a href="#TracingNode-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode-311"><a href="#TracingNode-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="TracingNode-312"><a href="#TracingNode-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="TracingNode-313"><a href="#TracingNode-313"><span class="linenos">313</span></a>
</span><span id="TracingNode-314"><a href="#TracingNode-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>
</span><span id="TracingNode-315"><a href="#TracingNode-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-316"><a href="#TracingNode-316"><span class="linenos">316</span></a><span class="sd">        Add a new input values to the tracing node.</span>
</span><span id="TracingNode-317"><a href="#TracingNode-317"><span class="linenos">317</span></a>
</span><span id="TracingNode-318"><a href="#TracingNode-318"><span class="linenos">318</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="TracingNode-319"><a href="#TracingNode-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-320"><a href="#TracingNode-320"><span class="linenos">320</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-321"><a href="#TracingNode-321"><span class="linenos">321</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode-322"><a href="#TracingNode-322"><span class="linenos">322</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TracingNode-323"><a href="#TracingNode-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode-324"><a href="#TracingNode-324"><span class="linenos">324</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode-325"><a href="#TracingNode-325"><span class="linenos">325</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="TracingNode-326"><a href="#TracingNode-326"><span class="linenos">326</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TracingNode-327"><a href="#TracingNode-327"><span class="linenos">327</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="TracingNode-328"><a href="#TracingNode-328"><span class="linenos">328</span></a>
</span><span id="TracingNode-329"><a href="#TracingNode-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="TracingNode-330"><a href="#TracingNode-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-331"><a href="#TracingNode-331"><span class="linenos">331</span></a><span class="sd">        Set the result value of the tracing node.</span>
</span><span id="TracingNode-332"><a href="#TracingNode-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-333"><a href="#TracingNode-333"><span class="linenos">333</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-334"><a href="#TracingNode-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="TracingNode-335"><a href="#TracingNode-335"><span class="linenos">335</span></a>
</span><span id="TracingNode-336"><a href="#TracingNode-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">set_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="TracingNode-337"><a href="#TracingNode-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-338"><a href="#TracingNode-338"><span class="linenos">338</span></a><span class="sd">        Set the error value of the tracing node (usually an `Exception` instance).</span>
</span><span id="TracingNode-339"><a href="#TracingNode-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-340"><a href="#TracingNode-340"><span class="linenos">340</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-341"><a href="#TracingNode-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="TracingNode-342"><a href="#TracingNode-342"><span class="linenos">342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="TracingNode-343"><a href="#TracingNode-343"><span class="linenos">343</span></a>
</span><span id="TracingNode-344"><a href="#TracingNode-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">has_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TracingNode-345"><a href="#TracingNode-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-346"><a href="#TracingNode-346"><span class="linenos">346</span></a><span class="sd">        Returns `True` if the tracing node has a tag with the given name.</span>
</span><span id="TracingNode-347"><a href="#TracingNode-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-348"><a href="#TracingNode-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode-349"><a href="#TracingNode-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TracingNode-350"><a href="#TracingNode-350"><span class="linenos">350</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode-351"><a href="#TracingNode-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">tag_name</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tag_name</span><span class="p">):</span>
</span><span id="TracingNode-352"><a href="#TracingNode-352"><span class="linenos">352</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TracingNode-353"><a href="#TracingNode-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="TracingNode-354"><a href="#TracingNode-354"><span class="linenos">354</span></a>
</span><span id="TracingNode-355"><a href="#TracingNode-355"><span class="linenos">355</span></a>    <span class="k">def</span> <span class="nf">find_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TracingNode&quot;</span><span class="p">]:</span>
</span><span id="TracingNode-356"><a href="#TracingNode-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode-357"><a href="#TracingNode-357"><span class="linenos">357</span></a><span class="sd">        Find all nodes matching the given callable `predicate`.</span>
</span><span id="TracingNode-358"><a href="#TracingNode-358"><span class="linenos">358</span></a>
</span><span id="TracingNode-359"><a href="#TracingNode-359"><span class="linenos">359</span></a><span class="sd">        The predicate is called with a single argument, the `TracingNode` to check, and should return `bool`.</span>
</span><span id="TracingNode-360"><a href="#TracingNode-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode-361"><a href="#TracingNode-361"><span class="linenos">361</span></a>
</span><span id="TracingNode-362"><a href="#TracingNode-362"><span class="linenos">362</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="TracingNode-363"><a href="#TracingNode-363"><span class="linenos">363</span></a>            <span class="k">with</span> <span class="n">node</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode-364"><a href="#TracingNode-364"><span class="linenos">364</span></a>                <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="TracingNode-365"><a href="#TracingNode-365"><span class="linenos">365</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="TracingNode-366"><a href="#TracingNode-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode-367"><a href="#TracingNode-367"><span class="linenos">367</span></a>                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode-368"><a href="#TracingNode-368"><span class="linenos">368</span></a>                        <span class="n">_helper</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span id="TracingNode-369"><a href="#TracingNode-369"><span class="linenos">369</span></a>
</span><span id="TracingNode-370"><a href="#TracingNode-370"><span class="linenos">370</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TracingNode-371"><a href="#TracingNode-371"><span class="linenos">371</span></a>        <span class="n">_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-372"><a href="#TracingNode-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="TracingNode-373"><a href="#TracingNode-373"><span class="linenos">373</span></a>
</span><span id="TracingNode-374"><a href="#TracingNode-374"><span class="linenos">374</span></a>    <span class="k">def</span> <span class="nf">write_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TracingNode-375"><a href="#TracingNode-375"><span class="linenos">375</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_node_static_page</span>
</span><span id="TracingNode-376"><a href="#TracingNode-376"><span class="linenos">376</span></a>
</span><span id="TracingNode-377"><a href="#TracingNode-377"><span class="linenos">377</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_node_static_page</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-378"><a href="#TracingNode-378"><span class="linenos">378</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="TracingNode-379"><a href="#TracingNode-379"><span class="linenos">379</span></a>            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span id="TracingNode-380"><a href="#TracingNode-380"><span class="linenos">380</span></a>
</span><span id="TracingNode-381"><a href="#TracingNode-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TracingNode-382"><a href="#TracingNode-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show tracing in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="TracingNode-383"><a href="#TracingNode-383"><span class="linenos">383</span></a>        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</span><span id="TracingNode-384"><a href="#TracingNode-384"><span class="linenos">384</span></a>        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span><span id="TracingNode-385"><a href="#TracingNode-385"><span class="linenos">385</span></a>
</span><span id="TracingNode-386"><a href="#TracingNode-386"><span class="linenos">386</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_node_static_html</span>
</span><span id="TracingNode-387"><a href="#TracingNode-387"><span class="linenos">387</span></a>
</span><span id="TracingNode-388"><a href="#TracingNode-388"><span class="linenos">388</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_node_static_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode-389"><a href="#TracingNode-389"><span class="linenos">389</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>A tracing object that represents a single request or (sub)task in a nested hierarchy.</p>

<p>The class has several attributes that are intended as read-only; use setters to modify them.</p>

<p>The <code><a href="#TracingNode">TracingNode</a></code> can be used as context manager, e.g.:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">with</span> <span class="n">TracingNode</span><span class="p">(</span><span class="s2">&quot;my node&quot;</span><span class="p">,</span> <span class="n">inputs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;z&quot;</span><span class="p">:</span> <span class="mi">42</span><span class="p">})</span> <span class="k">as</span> <span class="n">c</span><span class="p">:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">add_input</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">do_some_computation</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># The tracing node would also note any exceptions raised here</span>
    <span class="c1"># (letting it propagate upwards), but a result needs to be set manually:</span>
    <span class="n">c</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
<span class="c1"># &lt;- Here the tracing node is already closed.</span>
</code></pre>
</div>
</div>


                            <div id="TracingNode.__init__" class="classattr">
                                        <input id="TracingNode.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">TracingNode</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">name</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#StorageBase">StorageBase</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">directory</span><span class="o">=</span><span class="kc">False</span>,</span><span class="param">	<span class="n">result</span><span class="o">=</span><span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="TracingNode.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.__init__-76"><a href="#TracingNode.__init__-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
</span><span id="TracingNode.__init__-77"><a href="#TracingNode.__init__-77"><span class="linenos"> 77</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="TracingNode.__init__-78"><a href="#TracingNode.__init__-78"><span class="linenos"> 78</span></a>        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="TracingNode.__init__-79"><a href="#TracingNode.__init__-79"><span class="linenos"> 79</span></a>        <span class="n">kind</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-80"><a href="#TracingNode.__init__-80"><span class="linenos"> 80</span></a>        <span class="n">inputs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-81"><a href="#TracingNode.__init__-81"><span class="linenos"> 81</span></a>        <span class="n">meta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Data</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-82"><a href="#TracingNode.__init__-82"><span class="linenos"> 82</span></a>        <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-83"><a href="#TracingNode.__init__-83"><span class="linenos"> 83</span></a>        <span class="n">storage</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;StorageBase&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-84"><a href="#TracingNode.__init__-84"><span class="linenos"> 84</span></a>        <span class="n">directory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="TracingNode.__init__-85"><a href="#TracingNode.__init__-85"><span class="linenos"> 85</span></a>        <span class="n">result</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="TracingNode.__init__-86"><a href="#TracingNode.__init__-86"><span class="linenos"> 86</span></a>    <span class="p">):</span>
</span><span id="TracingNode.__init__-87"><a href="#TracingNode.__init__-87"><span class="linenos"> 87</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.__init__-88"><a href="#TracingNode.__init__-88"><span class="linenos"> 88</span></a><span class="sd">        - `name` - A description or name for the tracing node.</span>
</span><span id="TracingNode.__init__-89"><a href="#TracingNode.__init__-89"><span class="linenos"> 89</span></a><span class="sd">        - `kind` - Indicates category of the tracing node, may e.g. influence display of the tracing node.</span>
</span><span id="TracingNode.__init__-90"><a href="#TracingNode.__init__-90"><span class="linenos"> 90</span></a><span class="sd">        - `inputs` - A dictionary of inputs for the tracing node.</span>
</span><span id="TracingNode.__init__-91"><a href="#TracingNode.__init__-91"><span class="linenos"> 91</span></a><span class="sd">        - `meta` - A dictionary of any metadata for the tracing node, e.g. UI style data.</span>
</span><span id="TracingNode.__init__-92"><a href="#TracingNode.__init__-92"><span class="linenos"> 92</span></a><span class="sd">        - `tags` - A list of tags for the tracing node</span>
</span><span id="TracingNode.__init__-93"><a href="#TracingNode.__init__-93"><span class="linenos"> 93</span></a><span class="sd">        - `storage` - A storage object for the tracing node. Set on the root tracing node to log all nodes below it.</span>
</span><span id="TracingNode.__init__-94"><a href="#TracingNode.__init__-94"><span class="linenos"> 94</span></a><span class="sd">        - `directory` - Whether to create a sub-directory for the tracing node while storing.</span>
</span><span id="TracingNode.__init__-95"><a href="#TracingNode.__init__-95"><span class="linenos"> 95</span></a><span class="sd">          This allows you to split the stored data across multiple files.</span>
</span><span id="TracingNode.__init__-96"><a href="#TracingNode.__init__-96"><span class="linenos"> 96</span></a><span class="sd">        - `result` - The result value of the tracing node, if it has already been computed.</span>
</span><span id="TracingNode.__init__-97"><a href="#TracingNode.__init__-97"><span class="linenos"> 97</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.__init__-98"><a href="#TracingNode.__init__-98"><span class="linenos"> 98</span></a>
</span><span id="TracingNode.__init__-99"><a href="#TracingNode.__init__-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="n">storage</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">current_tracing_node</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.__init__-100"><a href="#TracingNode.__init__-100"><span class="linenos">100</span></a>            <span class="n">storage</span> <span class="o">=</span> <span class="n">current_storage</span><span class="p">()</span>
</span><span id="TracingNode.__init__-101"><a href="#TracingNode.__init__-101"><span class="linenos">101</span></a>
</span><span id="TracingNode.__init__-102"><a href="#TracingNode.__init__-102"><span class="linenos">102</span></a>        <span class="k">if</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode.__init__-103"><a href="#TracingNode.__init__-103"><span class="linenos">103</span></a>            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inputs</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="TracingNode.__init__-104"><a href="#TracingNode.__init__-104"><span class="linenos">104</span></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">)</span>
</span><span id="TracingNode.__init__-105"><a href="#TracingNode.__init__-105"><span class="linenos">105</span></a>            <span class="n">inputs</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">inputs</span><span class="p">)</span>
</span><span id="TracingNode.__init__-106"><a href="#TracingNode.__init__-106"><span class="linenos">106</span></a>
</span><span id="TracingNode.__init__-107"><a href="#TracingNode.__init__-107"><span class="linenos">107</span></a>        <span class="k">if</span> <span class="n">meta</span><span class="p">:</span>
</span><span id="TracingNode.__init__-108"><a href="#TracingNode.__init__-108"><span class="linenos">108</span></a>            <span class="n">meta</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">meta</span><span class="p">)</span>
</span><span id="TracingNode.__init__-109"><a href="#TracingNode.__init__-109"><span class="linenos">109</span></a>
</span><span id="TracingNode.__init__-110"><a href="#TracingNode.__init__-110"><span class="linenos">110</span></a>        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
</span><span id="TracingNode.__init__-111"><a href="#TracingNode.__init__-111"><span class="linenos">111</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="TracingNode.__init__-112"><a href="#TracingNode.__init__-112"><span class="linenos">112</span></a>
</span><span id="TracingNode.__init__-113"><a href="#TracingNode.__init__-113"><span class="linenos">113</span></a>        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.__init__-114"><a href="#TracingNode.__init__-114"><span class="linenos">114</span></a>            <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">tags</span><span class="p">]</span>
</span><span id="TracingNode.__init__-115"><a href="#TracingNode.__init__-115"><span class="linenos">115</span></a>
</span><span id="TracingNode.__init__-116"><a href="#TracingNode.__init__-116"><span class="linenos">116</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span id="TracingNode.__init__-117"><a href="#TracingNode.__init__-117"><span class="linenos">117</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">kind</span>
</span><span id="TracingNode.__init__-118"><a href="#TracingNode.__init__-118"><span class="linenos">118</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">inputs</span>
</span><span id="TracingNode.__init__-119"><a href="#TracingNode.__init__-119"><span class="linenos">119</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
</span><span id="TracingNode.__init__-120"><a href="#TracingNode.__init__-120"><span class="linenos">120</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.__init__-121"><a href="#TracingNode.__init__-121"><span class="linenos">121</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="n">TracingNodeState</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="TracingNode.__init__-122"><a href="#TracingNode.__init__-122"><span class="linenos">122</span></a>            <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">NEW</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="TracingNode.__init__-123"><a href="#TracingNode.__init__-123"><span class="linenos">123</span></a>        <span class="p">)</span>
</span><span id="TracingNode.__init__-124"><a href="#TracingNode.__init__-124"><span class="linenos">124</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">generate_uid</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span id="TracingNode.__init__-125"><a href="#TracingNode.__init__-125"><span class="linenos">125</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TracingNode.__init__-126"><a href="#TracingNode.__init__-126"><span class="linenos">126</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
</span><span id="TracingNode.__init__-127"><a href="#TracingNode.__init__-127"><span class="linenos">127</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.__init__-128"><a href="#TracingNode.__init__-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</span><span id="TracingNode.__init__-129"><a href="#TracingNode.__init__-129"><span class="linenos">129</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">meta</span> <span class="o">=</span> <span class="n">meta</span>
</span><span id="TracingNode.__init__-130"><a href="#TracingNode.__init__-130"><span class="linenos">130</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">storage</span> <span class="o">=</span> <span class="n">storage</span>
</span><span id="TracingNode.__init__-131"><a href="#TracingNode.__init__-131"><span class="linenos">131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="TracingNode.__init__-132"><a href="#TracingNode.__init__-132"><span class="linenos">132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.__init__-133"><a href="#TracingNode.__init__-133"><span class="linenos">133</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="TracingNode.__init__-134"><a href="#TracingNode.__init__-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="TracingNode.__init__-135"><a href="#TracingNode.__init__-135"><span class="linenos">135</span></a>
</span><span id="TracingNode.__init__-136"><a href="#TracingNode.__init__-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="n">storage</span><span class="p">:</span>
</span><span id="TracingNode.__init__-137"><a href="#TracingNode.__init__-137"><span class="linenos">137</span></a>            <span class="n">storage</span><span class="o">.</span><span class="n">register_node</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><ul>
<li><code>name</code> - A description or name for the tracing node.</li>
<li><code>kind</code> - Indicates category of the tracing node, may e.g. influence display of the tracing node.</li>
<li><code>inputs</code> - A dictionary of inputs for the tracing node.</li>
<li><code>meta</code> - A dictionary of any metadata for the tracing node, e.g. UI style data.</li>
<li><code>tags</code> - A list of tags for the tracing node</li>
<li><code>storage</code> - A storage object for the tracing node. Set on the root tracing node to log all nodes below it.</li>
<li><code>directory</code> - Whether to create a sub-directory for the tracing node while storing.
This allows you to split the stored data across multiple files.</li>
<li><code>result</code> - The result value of the tracing node, if it has already been computed.</li>
</ul>
</div>


                            </div>
                            <div id="TracingNode.deserialize" class="classattr">
                                        <input id="TracingNode.deserialize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">deserialize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">data</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="n">depth</span><span class="o">=</span><span class="mi">0</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.deserialize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.deserialize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.deserialize-139"><a href="#TracingNode.deserialize-139"><span class="linenos">139</span></a>    <span class="nd">@classmethod</span>
</span><span id="TracingNode.deserialize-140"><a href="#TracingNode.deserialize-140"><span class="linenos">140</span></a>    <span class="k">def</span> <span class="nf">deserialize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="TracingNode.deserialize-141"><a href="#TracingNode.deserialize-141"><span class="linenos">141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.deserialize-142"><a href="#TracingNode.deserialize-142"><span class="linenos">142</span></a><span class="sd">        Deserialize a `TracingNode` object from given JSON data.</span>
</span><span id="TracingNode.deserialize-143"><a href="#TracingNode.deserialize-143"><span class="linenos">143</span></a>
</span><span id="TracingNode.deserialize-144"><a href="#TracingNode.deserialize-144"><span class="linenos">144</span></a><span class="sd">        - `data` - A dictionary containing the serialized tracing data.</span>
</span><span id="TracingNode.deserialize-145"><a href="#TracingNode.deserialize-145"><span class="linenos">145</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.deserialize-146"><a href="#TracingNode.deserialize-146"><span class="linenos">146</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-147"><a href="#TracingNode.deserialize-147"><span class="linenos">147</span></a>
</span><span id="TracingNode.deserialize-148"><a href="#TracingNode.deserialize-148"><span class="linenos">148</span></a>        <span class="c1"># For backward compatibility we also &quot;Context&quot;</span>
</span><span id="TracingNode.deserialize-149"><a href="#TracingNode.deserialize-149"><span class="linenos">149</span></a>        <span class="k">assert</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;TracingNode&quot;</span> <span class="ow">or</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;_type&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Context&quot;</span>
</span><span id="TracingNode.deserialize-150"><a href="#TracingNode.deserialize-150"><span class="linenos">150</span></a>        <span class="bp">self</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-151"><a href="#TracingNode.deserialize-151"><span class="linenos">151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">uid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;uid&quot;</span><span class="p">]</span>
</span><span id="TracingNode.deserialize-152"><a href="#TracingNode.deserialize-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="TracingNode.deserialize-153"><a href="#TracingNode.deserialize-153"><span class="linenos">153</span></a>
</span><span id="TracingNode.deserialize-154"><a href="#TracingNode.deserialize-154"><span class="linenos">154</span></a>        <span class="n">state</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-155"><a href="#TracingNode.deserialize-155"><span class="linenos">155</span></a>        <span class="k">if</span> <span class="n">state</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-156"><a href="#TracingNode.deserialize-156"><span class="linenos">156</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-157"><a href="#TracingNode.deserialize-157"><span class="linenos">157</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-158"><a href="#TracingNode.deserialize-158"><span class="linenos">158</span></a>            <span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span>
</span><span id="TracingNode.deserialize-159"><a href="#TracingNode.deserialize-159"><span class="linenos">159</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
</span><span id="TracingNode.deserialize-160"><a href="#TracingNode.deserialize-160"><span class="linenos">160</span></a>        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="s2">&quot;meta&quot;</span><span class="p">]:</span>
</span><span id="TracingNode.deserialize-161"><a href="#TracingNode.deserialize-161"><span class="linenos">161</span></a>            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span id="TracingNode.deserialize-162"><a href="#TracingNode.deserialize-162"><span class="linenos">162</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">kind</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;kind&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-163"><a href="#TracingNode.deserialize-163"><span class="linenos">163</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;inputs&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-164"><a href="#TracingNode.deserialize-164"><span class="linenos">164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-165"><a href="#TracingNode.deserialize-165"><span class="linenos">165</span></a>
</span><span id="TracingNode.deserialize-166"><a href="#TracingNode.deserialize-166"><span class="linenos">166</span></a>        <span class="n">start_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;start_time&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-167"><a href="#TracingNode.deserialize-167"><span class="linenos">167</span></a>        <span class="k">if</span> <span class="n">start_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-168"><a href="#TracingNode.deserialize-168"><span class="linenos">168</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.deserialize-169"><a href="#TracingNode.deserialize-169"><span class="linenos">169</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-170"><a href="#TracingNode.deserialize-170"><span class="linenos">170</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-171"><a href="#TracingNode.deserialize-171"><span class="linenos">171</span></a>
</span><span id="TracingNode.deserialize-172"><a href="#TracingNode.deserialize-172"><span class="linenos">172</span></a>        <span class="n">end_time</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;end_time&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-173"><a href="#TracingNode.deserialize-173"><span class="linenos">173</span></a>        <span class="k">if</span> <span class="n">end_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-174"><a href="#TracingNode.deserialize-174"><span class="linenos">174</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.deserialize-175"><a href="#TracingNode.deserialize-175"><span class="linenos">175</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-176"><a href="#TracingNode.deserialize-176"><span class="linenos">176</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">end_time</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-177"><a href="#TracingNode.deserialize-177"><span class="linenos">177</span></a>
</span><span id="TracingNode.deserialize-178"><a href="#TracingNode.deserialize-178"><span class="linenos">178</span></a>        <span class="n">children</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;children&quot;</span><span class="p">)</span>
</span><span id="TracingNode.deserialize-179"><a href="#TracingNode.deserialize-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">children</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-180"><a href="#TracingNode.deserialize-180"><span class="linenos">180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.deserialize-181"><a href="#TracingNode.deserialize-181"><span class="linenos">181</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode.deserialize-182"><a href="#TracingNode.deserialize-182"><span class="linenos">182</span></a>            <span class="n">new_depth</span> <span class="o">=</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="TracingNode.deserialize-183"><a href="#TracingNode.deserialize-183"><span class="linenos">183</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="TracingNode.deserialize-184"><a href="#TracingNode.deserialize-184"><span class="linenos">184</span></a>                <span class="n">TracingNode</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="n">new_depth</span><span class="p">)</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span>
</span><span id="TracingNode.deserialize-185"><a href="#TracingNode.deserialize-185"><span class="linenos">185</span></a>            <span class="p">]</span>
</span><span id="TracingNode.deserialize-186"><a href="#TracingNode.deserialize-186"><span class="linenos">186</span></a>
</span><span id="TracingNode.deserialize-187"><a href="#TracingNode.deserialize-187"><span class="linenos">187</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="TracingNode.deserialize-188"><a href="#TracingNode.deserialize-188"><span class="linenos">188</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_depth</span> <span class="o">=</span> <span class="n">depth</span>
</span><span id="TracingNode.deserialize-189"><a href="#TracingNode.deserialize-189"><span class="linenos">189</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
</span><span id="TracingNode.deserialize-190"><a href="#TracingNode.deserialize-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span></pre></div>


            <div class="docstring"><p>Deserialize a <code><a href="#TracingNode">TracingNode</a></code> object from given JSON data.</p>

<ul>
<li><code>data</code> - A dictionary containing the serialized tracing data.</li>
</ul>
</div>


                            </div>
                            <div id="TracingNode.to_dict" class="classattr">
                                        <input id="TracingNode.to_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">to_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">with_children</span><span class="o">=</span><span class="kc">True</span>, </span><span class="param"><span class="n">root</span><span class="o">=</span><span class="kc">True</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.to_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.to_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.to_dict-192"><a href="#TracingNode.to_dict-192"><span class="linenos">192</span></a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">with_children</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="TracingNode.to_dict-193"><a href="#TracingNode.to_dict-193"><span class="linenos">193</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.to_dict-194"><a href="#TracingNode.to_dict-194"><span class="linenos">194</span></a><span class="sd">        Serialize `TracingNode` object into JSON structure.</span>
</span><span id="TracingNode.to_dict-195"><a href="#TracingNode.to_dict-195"><span class="linenos">195</span></a>
</span><span id="TracingNode.to_dict-196"><a href="#TracingNode.to_dict-196"><span class="linenos">196</span></a><span class="sd">        - `with_children` - If True then children are recursively serialized.</span>
</span><span id="TracingNode.to_dict-197"><a href="#TracingNode.to_dict-197"><span class="linenos">197</span></a><span class="sd">                            If False then serialization of children is skipped and only</span>
</span><span id="TracingNode.to_dict-198"><a href="#TracingNode.to_dict-198"><span class="linenos">198</span></a><span class="sd">                            children UIDs are put into key `children_uids`</span>
</span><span id="TracingNode.to_dict-199"><a href="#TracingNode.to_dict-199"><span class="linenos">199</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.to_dict-200"><a href="#TracingNode.to_dict-200"><span class="linenos">200</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-201"><a href="#TracingNode.to_dict-201"><span class="linenos">201</span></a>            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;TracingNode&quot;</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;uid&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">uid</span><span class="p">}</span>
</span><span id="TracingNode.to_dict-202"><a href="#TracingNode.to_dict-202"><span class="linenos">202</span></a>            <span class="k">if</span> <span class="n">root</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-203"><a href="#TracingNode.to_dict-203"><span class="linenos">203</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">TRACING_FORMAT_VERSION</span>
</span><span id="TracingNode.to_dict-204"><a href="#TracingNode.to_dict-204"><span class="linenos">204</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">!=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">FINISHED</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-205"><a href="#TracingNode.to_dict-205"><span class="linenos">205</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">value</span>
</span><span id="TracingNode.to_dict-206"><a href="#TracingNode.to_dict-206"><span class="linenos">206</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;kind&quot;</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="s2">&quot;tags&quot;</span><span class="p">]:</span>
</span><span id="TracingNode.to_dict-207"><a href="#TracingNode.to_dict-207"><span class="linenos">207</span></a>                <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="TracingNode.to_dict-208"><a href="#TracingNode.to_dict-208"><span class="linenos">208</span></a>                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-209"><a href="#TracingNode.to_dict-209"><span class="linenos">209</span></a>                    <span class="n">result</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="TracingNode.to_dict-210"><a href="#TracingNode.to_dict-210"><span class="linenos">210</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-211"><a href="#TracingNode.to_dict-211"><span class="linenos">211</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;inputs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span>
</span><span id="TracingNode.to_dict-212"><a href="#TracingNode.to_dict-212"><span class="linenos">212</span></a>            <span class="k">if</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-213"><a href="#TracingNode.to_dict-213"><span class="linenos">213</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="TracingNode.to_dict-214"><a href="#TracingNode.to_dict-214"><span class="linenos">214</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">with_children</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-215"><a href="#TracingNode.to_dict-215"><span class="linenos">215</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;children_uids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">uid</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">children</span><span class="p">]</span>
</span><span id="TracingNode.to_dict-216"><a href="#TracingNode.to_dict-216"><span class="linenos">216</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-217"><a href="#TracingNode.to_dict-217"><span class="linenos">217</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;start_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="TracingNode.to_dict-218"><a href="#TracingNode.to_dict-218"><span class="linenos">218</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-219"><a href="#TracingNode.to_dict-219"><span class="linenos">219</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;end_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="TracingNode.to_dict-220"><a href="#TracingNode.to_dict-220"><span class="linenos">220</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-221"><a href="#TracingNode.to_dict-221"><span class="linenos">221</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">meta</span>
</span><span id="TracingNode.to_dict-222"><a href="#TracingNode.to_dict-222"><span class="linenos">222</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode.to_dict-223"><a href="#TracingNode.to_dict-223"><span class="linenos">223</span></a>                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>
</span><span id="TracingNode.to_dict-224"><a href="#TracingNode.to_dict-224"><span class="linenos">224</span></a>            <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Serialize <code><a href="#TracingNode">TracingNode</a></code> object into JSON structure.</p>

<ul>
<li><code>with_children</code> - If True then children are recursively serialized.
If False then serialization of children is skipped and only
children UIDs are put into key <code>children_uids</code></li>
</ul>
</div>


                            </div>
                            <div id="TracingNode.add_tag" class="classattr">
                                        <input id="TracingNode.add_tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_tag</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.add_tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.add_tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.add_tag-278"><a href="#TracingNode.add_tag-278"><span class="linenos">278</span></a>    <span class="k">def</span> <span class="nf">add_tag</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="TracingNode.add_tag-279"><a href="#TracingNode.add_tag-279"><span class="linenos">279</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.add_tag-280"><a href="#TracingNode.add_tag-280"><span class="linenos">280</span></a><span class="sd">        Add a tag to the tracing node.</span>
</span><span id="TracingNode.add_tag-281"><a href="#TracingNode.add_tag-281"><span class="linenos">281</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.add_tag-282"><a href="#TracingNode.add_tag-282"><span class="linenos">282</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.add_tag-283"><a href="#TracingNode.add_tag-283"><span class="linenos">283</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.add_tag-284"><a href="#TracingNode.add_tag-284"><span class="linenos">284</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span> <span class="o">=</span> <span class="p">[</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">)]</span>
</span><span id="TracingNode.add_tag-285"><a href="#TracingNode.add_tag-285"><span class="linenos">285</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="TracingNode.add_tag-286"><a href="#TracingNode.add_tag-286"><span class="linenos">286</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">into_tag</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Add a tag to the tracing node.</p>
</div>


                            </div>
                            <div id="TracingNode.add_input" class="classattr">
                                        <input id="TracingNode.add_input-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_input</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">name</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">object</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.add_input-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.add_input"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.add_input-301"><a href="#TracingNode.add_input-301"><span class="linenos">301</span></a>    <span class="k">def</span> <span class="nf">add_input</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">):</span>
</span><span id="TracingNode.add_input-302"><a href="#TracingNode.add_input-302"><span class="linenos">302</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.add_input-303"><a href="#TracingNode.add_input-303"><span class="linenos">303</span></a><span class="sd">        Add a named input value to the tracing node.</span>
</span><span id="TracingNode.add_input-304"><a href="#TracingNode.add_input-304"><span class="linenos">304</span></a>
</span><span id="TracingNode.add_input-305"><a href="#TracingNode.add_input-305"><span class="linenos">305</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="TracingNode.add_input-306"><a href="#TracingNode.add_input-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.add_input-307"><a href="#TracingNode.add_input-307"><span class="linenos">307</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.add_input-308"><a href="#TracingNode.add_input-308"><span class="linenos">308</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.add_input-309"><a href="#TracingNode.add_input-309"><span class="linenos">309</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TracingNode.add_input-310"><a href="#TracingNode.add_input-310"><span class="linenos">310</span></a>            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode.add_input-311"><a href="#TracingNode.add_input-311"><span class="linenos">311</span></a>                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="TracingNode.add_input-312"><a href="#TracingNode.add_input-312"><span class="linenos">312</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a named input value to the tracing node.</p>

<p>If an input of the same name already exists, an exception is raised.</p>
</div>


                            </div>
                            <div id="TracingNode.add_inputs" class="classattr">
                                        <input id="TracingNode.add_inputs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_inputs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.add_inputs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.add_inputs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.add_inputs-314"><a href="#TracingNode.add_inputs-314"><span class="linenos">314</span></a>    <span class="k">def</span> <span class="nf">add_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inputs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">object</span><span class="p">]):</span>
</span><span id="TracingNode.add_inputs-315"><a href="#TracingNode.add_inputs-315"><span class="linenos">315</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.add_inputs-316"><a href="#TracingNode.add_inputs-316"><span class="linenos">316</span></a><span class="sd">        Add a new input values to the tracing node.</span>
</span><span id="TracingNode.add_inputs-317"><a href="#TracingNode.add_inputs-317"><span class="linenos">317</span></a>
</span><span id="TracingNode.add_inputs-318"><a href="#TracingNode.add_inputs-318"><span class="linenos">318</span></a><span class="sd">        If an input of the same name already exists, an exception is raised.</span>
</span><span id="TracingNode.add_inputs-319"><a href="#TracingNode.add_inputs-319"><span class="linenos">319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.add_inputs-320"><a href="#TracingNode.add_inputs-320"><span class="linenos">320</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.add_inputs-321"><a href="#TracingNode.add_inputs-321"><span class="linenos">321</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TracingNode.add_inputs-322"><a href="#TracingNode.add_inputs-322"><span class="linenos">322</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="TracingNode.add_inputs-323"><a href="#TracingNode.add_inputs-323"><span class="linenos">323</span></a>            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode.add_inputs-324"><a href="#TracingNode.add_inputs-324"><span class="linenos">324</span></a>                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">:</span>
</span><span id="TracingNode.add_inputs-325"><a href="#TracingNode.add_inputs-325"><span class="linenos">325</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> already exists&quot;</span><span class="p">)</span>
</span><span id="TracingNode.add_inputs-326"><a href="#TracingNode.add_inputs-326"><span class="linenos">326</span></a>            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">inputs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="TracingNode.add_inputs-327"><a href="#TracingNode.add_inputs-327"><span class="linenos">327</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">inputs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add a new input values to the tracing node.</p>

<p>If an input of the same name already exists, an exception is raised.</p>
</div>


                            </div>
                            <div id="TracingNode.set_result" class="classattr">
                                        <input id="TracingNode.set_result-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_result</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.set_result-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.set_result"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.set_result-329"><a href="#TracingNode.set_result-329"><span class="linenos">329</span></a>    <span class="k">def</span> <span class="nf">set_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="TracingNode.set_result-330"><a href="#TracingNode.set_result-330"><span class="linenos">330</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.set_result-331"><a href="#TracingNode.set_result-331"><span class="linenos">331</span></a><span class="sd">        Set the result value of the tracing node.</span>
</span><span id="TracingNode.set_result-332"><a href="#TracingNode.set_result-332"><span class="linenos">332</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.set_result-333"><a href="#TracingNode.set_result-333"><span class="linenos">333</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.set_result-334"><a href="#TracingNode.set_result-334"><span class="linenos">334</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the result value of the tracing node.</p>
</div>


                            </div>
                            <div id="TracingNode.set_error" class="classattr">
                                        <input id="TracingNode.set_error-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_error</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">exc</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.set_error-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.set_error"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.set_error-336"><a href="#TracingNode.set_error-336"><span class="linenos">336</span></a>    <span class="k">def</span> <span class="nf">set_error</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="TracingNode.set_error-337"><a href="#TracingNode.set_error-337"><span class="linenos">337</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.set_error-338"><a href="#TracingNode.set_error-338"><span class="linenos">338</span></a><span class="sd">        Set the error value of the tracing node (usually an `Exception` instance).</span>
</span><span id="TracingNode.set_error-339"><a href="#TracingNode.set_error-339"><span class="linenos">339</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.set_error-340"><a href="#TracingNode.set_error-340"><span class="linenos">340</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.set_error-341"><a href="#TracingNode.set_error-341"><span class="linenos">341</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">TracingNodeState</span><span class="o">.</span><span class="n">ERROR</span>
</span><span id="TracingNode.set_error-342"><a href="#TracingNode.set_error-342"><span class="linenos">342</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">error</span> <span class="o">=</span> <span class="n">serialize_with_type</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Set the error value of the tracing node (usually an <code>Exception</code> instance).</p>
</div>


                            </div>
                            <div id="TracingNode.has_tag_name" class="classattr">
                                        <input id="TracingNode.has_tag_name-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">has_tag_name</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.has_tag_name-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.has_tag_name"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.has_tag_name-344"><a href="#TracingNode.has_tag_name-344"><span class="linenos">344</span></a>    <span class="k">def</span> <span class="nf">has_tag_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="TracingNode.has_tag_name-345"><a href="#TracingNode.has_tag_name-345"><span class="linenos">345</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.has_tag_name-346"><a href="#TracingNode.has_tag_name-346"><span class="linenos">346</span></a><span class="sd">        Returns `True` if the tracing node has a tag with the given name.</span>
</span><span id="TracingNode.has_tag_name-347"><a href="#TracingNode.has_tag_name-347"><span class="linenos">347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.has_tag_name-348"><a href="#TracingNode.has_tag_name-348"><span class="linenos">348</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode.has_tag_name-349"><a href="#TracingNode.has_tag_name-349"><span class="linenos">349</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="TracingNode.has_tag_name-350"><a href="#TracingNode.has_tag_name-350"><span class="linenos">350</span></a>        <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
</span><span id="TracingNode.has_tag_name-351"><a href="#TracingNode.has_tag_name-351"><span class="linenos">351</span></a>            <span class="k">if</span> <span class="n">tag</span> <span class="o">==</span> <span class="n">tag_name</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">Tag</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tag</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">tag_name</span><span class="p">):</span>
</span><span id="TracingNode.has_tag_name-352"><a href="#TracingNode.has_tag_name-352"><span class="linenos">352</span></a>                <span class="k">return</span> <span class="kc">True</span>
</span><span id="TracingNode.has_tag_name-353"><a href="#TracingNode.has_tag_name-353"><span class="linenos">353</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Returns <code>True</code> if the tracing node has a tag with the given name.</p>
</div>


                            </div>
                            <div id="TracingNode.find_nodes" class="classattr">
                                        <input id="TracingNode.find_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_nodes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n"><a href="#TracingNode">TracingNode</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="TracingNode.find_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.find_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.find_nodes-355"><a href="#TracingNode.find_nodes-355"><span class="linenos">355</span></a>    <span class="k">def</span> <span class="nf">find_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="s2">&quot;TracingNode&quot;</span><span class="p">]:</span>
</span><span id="TracingNode.find_nodes-356"><a href="#TracingNode.find_nodes-356"><span class="linenos">356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="TracingNode.find_nodes-357"><a href="#TracingNode.find_nodes-357"><span class="linenos">357</span></a><span class="sd">        Find all nodes matching the given callable `predicate`.</span>
</span><span id="TracingNode.find_nodes-358"><a href="#TracingNode.find_nodes-358"><span class="linenos">358</span></a>
</span><span id="TracingNode.find_nodes-359"><a href="#TracingNode.find_nodes-359"><span class="linenos">359</span></a><span class="sd">        The predicate is called with a single argument, the `TracingNode` to check, and should return `bool`.</span>
</span><span id="TracingNode.find_nodes-360"><a href="#TracingNode.find_nodes-360"><span class="linenos">360</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="TracingNode.find_nodes-361"><a href="#TracingNode.find_nodes-361"><span class="linenos">361</span></a>
</span><span id="TracingNode.find_nodes-362"><a href="#TracingNode.find_nodes-362"><span class="linenos">362</span></a>        <span class="k">def</span> <span class="nf">_helper</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="TracingNode.find_nodes-363"><a href="#TracingNode.find_nodes-363"><span class="linenos">363</span></a>            <span class="k">with</span> <span class="n">node</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="TracingNode.find_nodes-364"><a href="#TracingNode.find_nodes-364"><span class="linenos">364</span></a>                <span class="k">if</span> <span class="n">predicate</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
</span><span id="TracingNode.find_nodes-365"><a href="#TracingNode.find_nodes-365"><span class="linenos">365</span></a>                    <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
</span><span id="TracingNode.find_nodes-366"><a href="#TracingNode.find_nodes-366"><span class="linenos">366</span></a>                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode.find_nodes-367"><a href="#TracingNode.find_nodes-367"><span class="linenos">367</span></a>                    <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="TracingNode.find_nodes-368"><a href="#TracingNode.find_nodes-368"><span class="linenos">368</span></a>                        <span class="n">_helper</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
</span><span id="TracingNode.find_nodes-369"><a href="#TracingNode.find_nodes-369"><span class="linenos">369</span></a>
</span><span id="TracingNode.find_nodes-370"><a href="#TracingNode.find_nodes-370"><span class="linenos">370</span></a>        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="TracingNode.find_nodes-371"><a href="#TracingNode.find_nodes-371"><span class="linenos">371</span></a>        <span class="n">_helper</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode.find_nodes-372"><a href="#TracingNode.find_nodes-372"><span class="linenos">372</span></a>        <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Find all nodes matching the given callable <code>predicate</code>.</p>

<p>The predicate is called with a single argument, the <code><a href="#TracingNode">TracingNode</a></code> to check, and should return <code>bool</code>.</p>
</div>


                            </div>
                            <div id="TracingNode.display" class="classattr">
                                        <input id="TracingNode.display-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">display</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="TracingNode.display-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TracingNode.display"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TracingNode.display-381"><a href="#TracingNode.display-381"><span class="linenos">381</span></a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="TracingNode.display-382"><a href="#TracingNode.display-382"><span class="linenos">382</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show tracing in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="TracingNode.display-383"><a href="#TracingNode.display-383"><span class="linenos">383</span></a>        <span class="kn">from</span> <span class="nn">IPython.core.display</span> <span class="kn">import</span> <span class="n">HTML</span>
</span><span id="TracingNode.display-384"><a href="#TracingNode.display-384"><span class="linenos">384</span></a>        <span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
</span><span id="TracingNode.display-385"><a href="#TracingNode.display-385"><span class="linenos">385</span></a>
</span><span id="TracingNode.display-386"><a href="#TracingNode.display-386"><span class="linenos">386</span></a>        <span class="kn">from</span> <span class="nn">..ui.staticview</span> <span class="kn">import</span> <span class="n">create_node_static_html</span>
</span><span id="TracingNode.display-387"><a href="#TracingNode.display-387"><span class="linenos">387</span></a>
</span><span id="TracingNode.display-388"><a href="#TracingNode.display-388"><span class="linenos">388</span></a>        <span class="n">html</span> <span class="o">=</span> <span class="n">create_node_static_html</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="TracingNode.display-389"><a href="#TracingNode.display-389"><span class="linenos">389</span></a>        <span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Show tracing in Jupyter notebook</p>
</div>


                            </div>
                </section>
                <section id="Tag">
                            <input id="Tag-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclass</div>

    <span class="def">class</span>
    <span class="name">Tag</span>:

                <label class="view-source-button" for="Tag-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Tag"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Tag-37"><a href="#Tag-37"><span class="linenos">37</span></a><span class="nd">@dataclass</span>
</span><span id="Tag-38"><a href="#Tag-38"><span class="linenos">38</span></a><span class="k">class</span> <span class="nc">Tag</span><span class="p">:</span>
</span><span id="Tag-39"><a href="#Tag-39"><span class="linenos">39</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Tag-40"><a href="#Tag-40"><span class="linenos">40</span></a><span class="sd">    A simple class representing a tag that can be applied to a tracing node. Optionally with style information.</span>
</span><span id="Tag-41"><a href="#Tag-41"><span class="linenos">41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Tag-42"><a href="#Tag-42"><span class="linenos">42</span></a>
</span><span id="Tag-43"><a href="#Tag-43"><span class="linenos">43</span></a>    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Tag-44"><a href="#Tag-44"><span class="linenos">44</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The name of the tag; any short string.&quot;&quot;&quot;</span>
</span><span id="Tag-45"><a href="#Tag-45"><span class="linenos">45</span></a>    <span class="n">color</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Tag-46"><a href="#Tag-46"><span class="linenos">46</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;HTML hex color code, e.g. `#ff0000`.&quot;&quot;&quot;</span>
</span><span id="Tag-47"><a href="#Tag-47"><span class="linenos">47</span></a>
</span><span id="Tag-48"><a href="#Tag-48"><span class="linenos">48</span></a>    <span class="nd">@staticmethod</span>
</span><span id="Tag-49"><a href="#Tag-49"><span class="linenos">49</span></a>    <span class="k">def</span> <span class="nf">into_tag</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;Tag&quot;</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tag&quot;</span><span class="p">:</span>
</span><span id="Tag-50"><a href="#Tag-50"><span class="linenos">50</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
</span><span id="Tag-51"><a href="#Tag-51"><span class="linenos">51</span></a>            <span class="k">return</span> <span class="n">obj</span>
</span><span id="Tag-52"><a href="#Tag-52"><span class="linenos">52</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Tag-53"><a href="#Tag-53"><span class="linenos">53</span></a>            <span class="k">return</span> <span class="n">Tag</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span><span id="Tag-54"><a href="#Tag-54"><span class="linenos">54</span></a>        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Object </span><span class="si">{</span><span class="n">obj</span><span class="si">!r}</span><span class="s2"> cannot be converted into Tag&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>A simple class representing a tag that can be applied to a tracing node. Optionally with style information.</p>
</div>


                            <div id="Tag.name" class="classattr">
                                <div class="attr variable">
            <span class="name">name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#Tag.name"></a>
    
            <div class="docstring"><p>The name of the tag; any short string.</p>
</div>


                            </div>
                            <div id="Tag.color" class="classattr">
                                <div class="attr variable">
            <span class="name">color</span><span class="annotation">: Optional[str]</span>        =
<span class="default_value">None</span>

        
    </div>
    <a class="headerlink" href="#Tag.color"></a>
    
            <div class="docstring"><p>HTML hex color code, e.g. <code>#ff0000</code>.</p>
</div>


                            </div>
                </section>
                <section id="current_tracing_node">
                            <input id="current_tracing_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">current_tracing_node</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#TracingNode">TracingNode</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="current_tracing_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#current_tracing_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="current_tracing_node-455"><a href="#current_tracing_node-455"><span class="linenos">455</span></a><span class="k">def</span> <span class="nf">current_tracing_node</span><span class="p">(</span><span class="n">check</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="current_tracing_node-456"><a href="#current_tracing_node-456"><span class="linenos">456</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="current_tracing_node-457"><a href="#current_tracing_node-457"><span class="linenos">457</span></a><span class="sd">    Returns the inner-most open tracing node, if any.</span>
</span><span id="current_tracing_node-458"><a href="#current_tracing_node-458"><span class="linenos">458</span></a>
</span><span id="current_tracing_node-459"><a href="#current_tracing_node-459"><span class="linenos">459</span></a><span class="sd">    Throws an error if `check` is `True` and there is no current tracing node. If `check` is `False` and there is</span>
</span><span id="current_tracing_node-460"><a href="#current_tracing_node-460"><span class="linenos">460</span></a><span class="sd">    no current tracing node, it returns `None`.</span>
</span><span id="current_tracing_node-461"><a href="#current_tracing_node-461"><span class="linenos">461</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="current_tracing_node-462"><a href="#current_tracing_node-462"><span class="linenos">462</span></a>    <span class="n">stack</span> <span class="o">=</span> <span class="n">_TRACING_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="current_tracing_node-463"><a href="#current_tracing_node-463"><span class="linenos">463</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">stack</span><span class="p">:</span>
</span><span id="current_tracing_node-464"><a href="#current_tracing_node-464"><span class="linenos">464</span></a>        <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
</span><span id="current_tracing_node-465"><a href="#current_tracing_node-465"><span class="linenos">465</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;No current tracing&quot;</span><span class="p">)</span>
</span><span id="current_tracing_node-466"><a href="#current_tracing_node-466"><span class="linenos">466</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="current_tracing_node-467"><a href="#current_tracing_node-467"><span class="linenos">467</span></a>    <span class="k">return</span> <span class="n">stack</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns the inner-most open tracing node, if any.</p>

<p>Throws an error if <code>check</code> is <code>True</code> and there is no current tracing node. If <code>check</code> is <code>False</code> and there is
no current tracing node, it returns <code>None</code>.</p>
</div>


                </section>
                <section id="with_trace">
                            <input id="with_trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">with_trace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">kind</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n"><a href="#Tag">Tag</a></span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="with_trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#with_trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="with_trace-392"><a href="#with_trace-392"><span class="linenos">392</span></a><span class="k">def</span> <span class="nf">with_trace</span><span class="p">(</span>
</span><span id="with_trace-393"><a href="#with_trace-393"><span class="linenos">393</span></a>    <span class="n">fn</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tags</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Tag</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="with_trace-394"><a href="#with_trace-394"><span class="linenos">394</span></a><span class="p">):</span>
</span><span id="with_trace-395"><a href="#with_trace-395"><span class="linenos">395</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="with_trace-396"><a href="#with_trace-396"><span class="linenos">396</span></a><span class="sd">    A decorator wrapping every execution of the function in a new `TracingNode`.</span>
</span><span id="with_trace-397"><a href="#with_trace-397"><span class="linenos">397</span></a>
</span><span id="with_trace-398"><a href="#with_trace-398"><span class="linenos">398</span></a><span class="sd">    The `inputs`, `result`, and `error` (if any) are set automatically.</span>
</span><span id="with_trace-399"><a href="#with_trace-399"><span class="linenos">399</span></a><span class="sd">    Note that you can access the created tracing in your function using `current_tracing_node`.</span>
</span><span id="with_trace-400"><a href="#with_trace-400"><span class="linenos">400</span></a>
</span><span id="with_trace-401"><a href="#with_trace-401"><span class="linenos">401</span></a><span class="sd">    *Usage:*</span>
</span><span id="with_trace-402"><a href="#with_trace-402"><span class="linenos">402</span></a>
</span><span id="with_trace-403"><a href="#with_trace-403"><span class="linenos">403</span></a><span class="sd">    ```python</span>
</span><span id="with_trace-404"><a href="#with_trace-404"><span class="linenos">404</span></a><span class="sd">    @with_trace</span>
</span><span id="with_trace-405"><a href="#with_trace-405"><span class="linenos">405</span></a><span class="sd">    def func():</span>
</span><span id="with_trace-406"><a href="#with_trace-406"><span class="linenos">406</span></a><span class="sd">        pass</span>
</span><span id="with_trace-407"><a href="#with_trace-407"><span class="linenos">407</span></a>
</span><span id="with_trace-408"><a href="#with_trace-408"><span class="linenos">408</span></a><span class="sd">    @with_trace(name=&quot;custom_name&quot;, kind=&quot;custom_kind&quot;, tags=[&#39;tag1&#39;, &#39;tag2&#39;])</span>
</span><span id="with_trace-409"><a href="#with_trace-409"><span class="linenos">409</span></a><span class="sd">    def func():</span>
</span><span id="with_trace-410"><a href="#with_trace-410"><span class="linenos">410</span></a><span class="sd">        pass</span>
</span><span id="with_trace-411"><a href="#with_trace-411"><span class="linenos">411</span></a><span class="sd">    ```</span>
</span><span id="with_trace-412"><a href="#with_trace-412"><span class="linenos">412</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="with_trace-413"><a href="#with_trace-413"><span class="linenos">413</span></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="with_trace-414"><a href="#with_trace-414"><span class="linenos">414</span></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;use `with_tracing()` with explicit `name=...` parameter&quot;</span><span class="p">)</span>
</span><span id="with_trace-415"><a href="#with_trace-415"><span class="linenos">415</span></a>
</span><span id="with_trace-416"><a href="#with_trace-416"><span class="linenos">416</span></a>    <span class="k">def</span> <span class="nf">helper</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="with_trace-417"><a href="#with_trace-417"><span class="linenos">417</span></a>        <span class="n">signature</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="with_trace-418"><a href="#with_trace-418"><span class="linenos">418</span></a>
</span><span id="with_trace-419"><a href="#with_trace-419"><span class="linenos">419</span></a>        <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="with_trace-420"><a href="#with_trace-420"><span class="linenos">420</span></a>        <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
</span><span id="with_trace-421"><a href="#with_trace-421"><span class="linenos">421</span></a>            <span class="n">binding</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_trace-422"><a href="#with_trace-422"><span class="linenos">422</span></a>            <span class="k">with</span> <span class="n">TracingNode</span><span class="p">(</span>
</span><span id="with_trace-423"><a href="#with_trace-423"><span class="linenos">423</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">name</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="with_trace-424"><a href="#with_trace-424"><span class="linenos">424</span></a>                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span> <span class="ow">or</span> <span class="s2">&quot;call&quot;</span><span class="p">,</span>
</span><span id="with_trace-425"><a href="#with_trace-425"><span class="linenos">425</span></a>                <span class="n">inputs</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span>
</span><span id="with_trace-426"><a href="#with_trace-426"><span class="linenos">426</span></a>                <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
</span><span id="with_trace-427"><a href="#with_trace-427"><span class="linenos">427</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">node</span><span class="p">:</span>
</span><span id="with_trace-428"><a href="#with_trace-428"><span class="linenos">428</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_trace-429"><a href="#with_trace-429"><span class="linenos">429</span></a>                <span class="n">node</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="with_trace-430"><a href="#with_trace-430"><span class="linenos">430</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="with_trace-431"><a href="#with_trace-431"><span class="linenos">431</span></a>
</span><span id="with_trace-432"><a href="#with_trace-432"><span class="linenos">432</span></a>        <span class="k">async</span> <span class="k">def</span> <span class="nf">async_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
</span><span id="with_trace-433"><a href="#with_trace-433"><span class="linenos">433</span></a>            <span class="n">binding</span> <span class="o">=</span> <span class="n">signature</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_trace-434"><a href="#with_trace-434"><span class="linenos">434</span></a>            <span class="k">with</span> <span class="n">TracingNode</span><span class="p">(</span>
</span><span id="with_trace-435"><a href="#with_trace-435"><span class="linenos">435</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">name</span> <span class="ow">or</span> <span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
</span><span id="with_trace-436"><a href="#with_trace-436"><span class="linenos">436</span></a>                <span class="n">kind</span><span class="o">=</span><span class="n">kind</span> <span class="ow">or</span> <span class="s2">&quot;acall&quot;</span><span class="p">,</span>
</span><span id="with_trace-437"><a href="#with_trace-437"><span class="linenos">437</span></a>                <span class="n">inputs</span><span class="o">=</span><span class="n">binding</span><span class="o">.</span><span class="n">arguments</span><span class="p">,</span>
</span><span id="with_trace-438"><a href="#with_trace-438"><span class="linenos">438</span></a>            <span class="p">)</span> <span class="k">as</span> <span class="n">node</span><span class="p">:</span>
</span><span id="with_trace-439"><a href="#with_trace-439"><span class="linenos">439</span></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
</span><span id="with_trace-440"><a href="#with_trace-440"><span class="linenos">440</span></a>                <span class="n">node</span><span class="o">.</span><span class="n">set_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="with_trace-441"><a href="#with_trace-441"><span class="linenos">441</span></a>                <span class="k">return</span> <span class="n">result</span>
</span><span id="with_trace-442"><a href="#with_trace-442"><span class="linenos">442</span></a>
</span><span id="with_trace-443"><a href="#with_trace-443"><span class="linenos">443</span></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
</span><span id="with_trace-444"><a href="#with_trace-444"><span class="linenos">444</span></a>            <span class="k">return</span> <span class="n">async_wrapper</span>
</span><span id="with_trace-445"><a href="#with_trace-445"><span class="linenos">445</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="with_trace-446"><a href="#with_trace-446"><span class="linenos">446</span></a>            <span class="k">return</span> <span class="n">wrapper</span>
</span><span id="with_trace-447"><a href="#with_trace-447"><span class="linenos">447</span></a>
</span><span id="with_trace-448"><a href="#with_trace-448"><span class="linenos">448</span></a>    <span class="k">if</span> <span class="n">fn</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="with_trace-449"><a href="#with_trace-449"><span class="linenos">449</span></a>        <span class="k">assert</span> <span class="nb">callable</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="with_trace-450"><a href="#with_trace-450"><span class="linenos">450</span></a>        <span class="k">return</span> <span class="n">helper</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
</span><span id="with_trace-451"><a href="#with_trace-451"><span class="linenos">451</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="with_trace-452"><a href="#with_trace-452"><span class="linenos">452</span></a>        <span class="k">return</span> <span class="n">helper</span>
</span></pre></div>


            <div class="docstring"><p>A decorator wrapping every execution of the function in a new <code><a href="#TracingNode">TracingNode</a></code>.</p>

<p>The <code>inputs</code>, <code>result</code>, and <code>error</code> (if any) are set automatically.
Note that you can access the created tracing in your function using <code><a href="#current_tracing_node">current_tracing_node</a></code>.</p>

<p><em>Usage:</em></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nd">@with_trace</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>

<span class="nd">@with_trace</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;custom_name&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;custom_kind&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tag1&#39;</span><span class="p">,</span> <span class="s1">&#39;tag2&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">func</span><span class="p">():</span>
    <span class="k">pass</span>
</code></pre>
</div>
</div>


                </section>
                <section id="FileStorage">
                            <input id="FileStorage-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FileStorage</span><wbr>(<span class="base"><a href="#StorageBase">treetrace.StorageBase</a></span>):

                <label class="view-source-button" for="FileStorage-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage-118"><a href="#FileStorage-118"><span class="linenos">118</span></a><span class="k">class</span> <span class="nc">FileStorage</span><span class="p">(</span><span class="n">StorageBase</span><span class="p">):</span>
</span><span id="FileStorage-119"><a href="#FileStorage-119"><span class="linenos">119</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="n">PathLike</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-120"><a href="#FileStorage-120"><span class="linenos">120</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="FileStorage-121"><a href="#FileStorage-121"><span class="linenos">121</span></a>        <span class="n">directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage-122"><a href="#FileStorage-122"><span class="linenos">122</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage-123"><a href="#FileStorage-123"><span class="linenos">123</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">directory</span> <span class="o">=</span> <span class="n">directory</span>
</span><span id="FileStorage-124"><a href="#FileStorage-124"><span class="linenos">124</span></a>
</span><span id="FileStorage-125"><a href="#FileStorage-125"><span class="linenos">125</span></a>    <span class="k">def</span> <span class="nf">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FileStorage-126"><a href="#FileStorage-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.gz&quot;</span><span class="p">)</span>
</span><span id="FileStorage-127"><a href="#FileStorage-127"><span class="linenos">127</span></a>
</span><span id="FileStorage-128"><a href="#FileStorage-128"><span class="linenos">128</span></a>    <span class="k">def</span> <span class="nf">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FileStorage-129"><a href="#FileStorage-129"><span class="linenos">129</span></a>        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.ctx&quot;</span><span class="p">)</span>
</span><span id="FileStorage-130"><a href="#FileStorage-130"><span class="linenos">130</span></a>
</span><span id="FileStorage-131"><a href="#FileStorage-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">write_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="FileStorage-132"><a href="#FileStorage-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-133"><a href="#FileStorage-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-134"><a href="#FileStorage-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_into</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage-135"><a href="#FileStorage-135"><span class="linenos">135</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-136"><a href="#FileStorage-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-137"><a href="#FileStorage-137"><span class="linenos">137</span></a>
</span><span id="FileStorage-138"><a href="#FileStorage-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">_write_node_into</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">,</span> <span class="n">root_node</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="FileStorage-139"><a href="#FileStorage-139"><span class="linenos">139</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-140"><a href="#FileStorage-140"><span class="linenos">140</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-141"><a href="#FileStorage-141"><span class="linenos">141</span></a>        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">directory</span><span class="p">:</span>
</span><span id="FileStorage-142"><a href="#FileStorage-142"><span class="linenos">142</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_dir</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">root_node</span><span class="p">)</span>
</span><span id="FileStorage-143"><a href="#FileStorage-143"><span class="linenos">143</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-144"><a href="#FileStorage-144"><span class="linenos">144</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">root</span><span class="o">=</span><span class="n">root_node</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-145"><a href="#FileStorage-145"><span class="linenos">145</span></a>            <span class="n">data_root</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">root_node</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-146"><a href="#FileStorage-146"><span class="linenos">146</span></a>            <span class="c1"># Write full first, so when root exists, then full is definitely there</span>
</span><span id="FileStorage-147"><a href="#FileStorage-147"><span class="linenos">147</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-148"><a href="#FileStorage-148"><span class="linenos">148</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_file</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">,</span> <span class="n">data_root</span><span class="p">)</span>
</span><span id="FileStorage-149"><a href="#FileStorage-149"><span class="linenos">149</span></a>
</span><span id="FileStorage-150"><a href="#FileStorage-150"><span class="linenos">150</span></a>    <span class="k">def</span> <span class="nf">_write_node_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">,</span> <span class="n">node_content</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="FileStorage-151"><a href="#FileStorage-151"><span class="linenos">151</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-152"><a href="#FileStorage-152"><span class="linenos">152</span></a>        <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;._tmp&quot;</span>
</span><span id="FileStorage-153"><a href="#FileStorage-153"><span class="linenos">153</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="FileStorage-154"><a href="#FileStorage-154"><span class="linenos">154</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-155"><a href="#FileStorage-155"><span class="linenos">155</span></a>            <span class="n">data_root</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="n">root</span><span class="o">=</span><span class="n">node_content</span><span class="p">))</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="FileStorage-156"><a href="#FileStorage-156"><span class="linenos">156</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_file</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">,</span> <span class="n">data_root</span><span class="p">)</span>
</span><span id="FileStorage-157"><a href="#FileStorage-157"><span class="linenos">157</span></a>            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">children</span><span class="p">:</span>
</span><span id="FileStorage-158"><a href="#FileStorage-158"><span class="linenos">158</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_into</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage-159"><a href="#FileStorage-159"><span class="linenos">159</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-160"><a href="#FileStorage-160"><span class="linenos">160</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="FileStorage-161"><a href="#FileStorage-161"><span class="linenos">161</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
</span><span id="FileStorage-162"><a href="#FileStorage-162"><span class="linenos">162</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-163"><a href="#FileStorage-163"><span class="linenos">163</span></a>
</span><span id="FileStorage-164"><a href="#FileStorage-164"><span class="linenos">164</span></a>    <span class="k">def</span> <span class="nf">_write_node_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Data</span><span class="p">):</span>
</span><span id="FileStorage-165"><a href="#FileStorage-165"><span class="linenos">165</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span id="FileStorage-166"><a href="#FileStorage-166"><span class="linenos">166</span></a>        <span class="n">tmp_path</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s2">&quot;._tmp&quot;</span>
</span><span id="FileStorage-167"><a href="#FileStorage-167"><span class="linenos">167</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="FileStorage-168"><a href="#FileStorage-168"><span class="linenos">168</span></a>            <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="FileStorage-169"><a href="#FileStorage-169"><span class="linenos">169</span></a>                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-170"><a href="#FileStorage-170"><span class="linenos">170</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-171"><a href="#FileStorage-171"><span class="linenos">171</span></a>        <span class="k">finally</span><span class="p">:</span>
</span><span id="FileStorage-172"><a href="#FileStorage-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">):</span>
</span><span id="FileStorage-173"><a href="#FileStorage-173"><span class="linenos">173</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">tmp_path</span><span class="p">)</span>
</span><span id="FileStorage-174"><a href="#FileStorage-174"><span class="linenos">174</span></a>
</span><span id="FileStorage-175"><a href="#FileStorage-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-176"><a href="#FileStorage-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-177"><a href="#FileStorage-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-178"><a href="#FileStorage-178"><span class="linenos">178</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-179"><a href="#FileStorage-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
</span><span id="FileStorage-180"><a href="#FileStorage-180"><span class="linenos">180</span></a>            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="FileStorage-181"><a href="#FileStorage-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-182"><a href="#FileStorage-182"><span class="linenos">182</span></a>
</span><span id="FileStorage-183"><a href="#FileStorage-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-184"><a href="#FileStorage-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-185"><a href="#FileStorage-185"><span class="linenos">185</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-186"><a href="#FileStorage-186"><span class="linenos">186</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-187"><a href="#FileStorage-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
</span><span id="FileStorage-188"><a href="#FileStorage-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_children</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage-189"><a href="#FileStorage-189"><span class="linenos">189</span></a>
</span><span id="FileStorage-190"><a href="#FileStorage-190"><span class="linenos">190</span></a>        <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-191"><a href="#FileStorage-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
</span><span id="FileStorage-192"><a href="#FileStorage-192"><span class="linenos">192</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage-193"><a href="#FileStorage-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-194"><a href="#FileStorage-194"><span class="linenos">194</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage-195"><a href="#FileStorage-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-196"><a href="#FileStorage-196"><span class="linenos">196</span></a>
</span><span id="FileStorage-197"><a href="#FileStorage-197"><span class="linenos">197</span></a>    <span class="k">def</span> <span class="nf">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage-198"><a href="#FileStorage-198"><span class="linenos">198</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-199"><a href="#FileStorage-199"><span class="linenos">199</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-200"><a href="#FileStorage-200"><span class="linenos">200</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_dir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-201"><a href="#FileStorage-201"><span class="linenos">201</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-202"><a href="#FileStorage-202"><span class="linenos">202</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage-203"><a href="#FileStorage-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-204"><a href="#FileStorage-204"><span class="linenos">204</span></a>
</span><span id="FileStorage-205"><a href="#FileStorage-205"><span class="linenos">205</span></a>    <span class="k">def</span> <span class="nf">_read_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-206"><a href="#FileStorage-206"><span class="linenos">206</span></a>        <span class="k">with</span> <span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="FileStorage-207"><a href="#FileStorage-207"><span class="linenos">207</span></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="FileStorage-208"><a href="#FileStorage-208"><span class="linenos">208</span></a>        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="FileStorage-209"><a href="#FileStorage-209"><span class="linenos">209</span></a>
</span><span id="FileStorage-210"><a href="#FileStorage-210"><span class="linenos">210</span></a>    <span class="k">def</span> <span class="nf">_read_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-211"><a href="#FileStorage-211"><span class="linenos">211</span></a>        <span class="n">self_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage-212"><a href="#FileStorage-212"><span class="linenos">212</span></a>        <span class="n">self_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">self_path</span><span class="p">)</span>
</span><span id="FileStorage-213"><a href="#FileStorage-213"><span class="linenos">213</span></a>        <span class="n">children_uids</span> <span class="o">=</span> <span class="n">self_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;children_uids&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-214"><a href="#FileStorage-214"><span class="linenos">214</span></a>        <span class="k">if</span> <span class="n">children_uids</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FileStorage-215"><a href="#FileStorage-215"><span class="linenos">215</span></a>            <span class="k">return</span> <span class="n">self_data</span>
</span><span id="FileStorage-216"><a href="#FileStorage-216"><span class="linenos">216</span></a>        <span class="n">self_data</span><span class="p">[</span><span class="s2">&quot;children&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">children_uids</span><span class="p">]</span>
</span><span id="FileStorage-217"><a href="#FileStorage-217"><span class="linenos">217</span></a>        <span class="k">return</span> <span class="n">self_data</span>
</span><span id="FileStorage-218"><a href="#FileStorage-218"><span class="linenos">218</span></a>
</span><span id="FileStorage-219"><a href="#FileStorage-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FileStorage-220"><a href="#FileStorage-220"><span class="linenos">220</span></a>        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s2">&quot;.root.gz&quot;</span>
</span><span id="FileStorage-221"><a href="#FileStorage-221"><span class="linenos">221</span></a>        <span class="n">dir_suffix</span> <span class="o">=</span> <span class="s2">&quot;.ctx&quot;</span>
</span><span id="FileStorage-222"><a href="#FileStorage-222"><span class="linenos">222</span></a>
</span><span id="FileStorage-223"><a href="#FileStorage-223"><span class="linenos">223</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-224"><a href="#FileStorage-224"><span class="linenos">224</span></a>            <span class="n">ephemeral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="FileStorage-225"><a href="#FileStorage-225"><span class="linenos">225</span></a>
</span><span id="FileStorage-226"><a href="#FileStorage-226"><span class="linenos">226</span></a>        <span class="n">lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage-227"><a href="#FileStorage-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="FileStorage-228"><a href="#FileStorage-228"><span class="linenos">228</span></a>            <span class="n">ephemeral</span>
</span><span id="FileStorage-229"><a href="#FileStorage-229"><span class="linenos">229</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span>
</span><span id="FileStorage-230"><a href="#FileStorage-230"><span class="linenos">230</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span>
</span><span id="FileStorage-231"><a href="#FileStorage-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span><span id="FileStorage-232"><a href="#FileStorage-232"><span class="linenos">232</span></a>
</span><span id="FileStorage-233"><a href="#FileStorage-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage-234"><a href="#FileStorage-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage-235"><a href="#FileStorage-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage-236"><a href="#FileStorage-236"><span class="linenos">236</span></a>        <span class="c1"># First try to remove .root, so it immediately disappear from listing</span>
</span><span id="FileStorage-237"><a href="#FileStorage-237"><span class="linenos">237</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage-238"><a href="#FileStorage-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-239"><a href="#FileStorage-239"><span class="linenos">239</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-240"><a href="#FileStorage-240"><span class="linenos">240</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage-241"><a href="#FileStorage-241"><span class="linenos">241</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-242"><a href="#FileStorage-242"><span class="linenos">242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage-243"><a href="#FileStorage-243"><span class="linenos">243</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage-244"><a href="#FileStorage-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage-245"><a href="#FileStorage-245"><span class="linenos">245</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage-246"><a href="#FileStorage-246"><span class="linenos">246</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage-247"><a href="#FileStorage-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="FileStorage-248"><a href="#FileStorage-248"><span class="linenos">248</span></a>
</span><span id="FileStorage-249"><a href="#FileStorage-249"><span class="linenos">249</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FileStorage-250"><a href="#FileStorage-250"><span class="linenos">250</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&lt;FileStorage directory=</span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span><span class="si">}</span><span class="s2">&gt;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="FileStorage.write_node" class="classattr">
                                        <input id="FileStorage.write_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#TracingNode">TracingNode</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FileStorage.write_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.write_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.write_node-131"><a href="#FileStorage.write_node-131"><span class="linenos">131</span></a>    <span class="k">def</span> <span class="nf">write_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="FileStorage.write_node-132"><a href="#FileStorage.write_node-132"><span class="linenos">132</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.write_node-133"><a href="#FileStorage.write_node-133"><span class="linenos">133</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.write_node-134"><a href="#FileStorage.write_node-134"><span class="linenos">134</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_write_node_into</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="FileStorage.write_node-135"><a href="#FileStorage.write_node-135"><span class="linenos">135</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.write_node-136"><a href="#FileStorage.write_node-136"><span class="linenos">136</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Write tracing node into persistent storage</p>
</div>


                            </div>
                            <div id="FileStorage.read" class="classattr">
                                        <input id="FileStorage.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.read-175"><a href="#FileStorage.read-175"><span class="linenos">175</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage.read-176"><a href="#FileStorage.read-176"><span class="linenos">176</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.read-177"><a href="#FileStorage.read-177"><span class="linenos">177</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read-178"><a href="#FileStorage.read-178"><span class="linenos">178</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read-179"><a href="#FileStorage.read-179"><span class="linenos">179</span></a>        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
</span><span id="FileStorage.read-180"><a href="#FileStorage.read-180"><span class="linenos">180</span></a>            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
</span><span id="FileStorage.read-181"><a href="#FileStorage.read-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_from</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read unserialized tracing from the storage</p>
</div>


                            </div>
                            <div id="FileStorage.read_root" class="classattr">
                                        <input id="FileStorage.read_root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_root</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.read_root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.read_root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.read_root-183"><a href="#FileStorage.read_root-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="FileStorage.read_root-184"><a href="#FileStorage.read_root-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.read_root-185"><a href="#FileStorage.read_root-185"><span class="linenos">185</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-186"><a href="#FileStorage.read_root-186"><span class="linenos">186</span></a>        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ephemeral_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read_root-187"><a href="#FileStorage.read_root-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">node</span><span class="p">:</span>
</span><span id="FileStorage.read_root-188"><a href="#FileStorage.read_root-188"><span class="linenos">188</span></a>            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">with_children</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="FileStorage.read_root-189"><a href="#FileStorage.read_root-189"><span class="linenos">189</span></a>
</span><span id="FileStorage.read_root-190"><a href="#FileStorage.read_root-190"><span class="linenos">190</span></a>        <span class="n">dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.read_root-191"><a href="#FileStorage.read_root-191"><span class="linenos">191</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">dir_path</span><span class="p">):</span>
</span><span id="FileStorage.read_root-192"><a href="#FileStorage.read_root-192"><span class="linenos">192</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="n">dir_path</span><span class="p">,</span> <span class="s2">&quot;_self&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-193"><a href="#FileStorage.read_root-193"><span class="linenos">193</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage.read_root-194"><a href="#FileStorage.read_root-194"><span class="linenos">194</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage.read_root-195"><a href="#FileStorage.read_root-195"><span class="linenos">195</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_file</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read tracing without children</p>
</div>


                            </div>
                            <div id="FileStorage.list" class="classattr">
                                        <input id="FileStorage.list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FileStorage.list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.list-219"><a href="#FileStorage.list-219"><span class="linenos">219</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FileStorage.list-220"><a href="#FileStorage.list-220"><span class="linenos">220</span></a>        <span class="n">file_suffix</span> <span class="o">=</span> <span class="s2">&quot;.root.gz&quot;</span>
</span><span id="FileStorage.list-221"><a href="#FileStorage.list-221"><span class="linenos">221</span></a>        <span class="n">dir_suffix</span> <span class="o">=</span> <span class="s2">&quot;.ctx&quot;</span>
</span><span id="FileStorage.list-222"><a href="#FileStorage.list-222"><span class="linenos">222</span></a>
</span><span id="FileStorage.list-223"><a href="#FileStorage.list-223"><span class="linenos">223</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.list-224"><a href="#FileStorage.list-224"><span class="linenos">224</span></a>            <span class="n">ephemeral</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="FileStorage.list-225"><a href="#FileStorage.list-225"><span class="linenos">225</span></a>
</span><span id="FileStorage.list-226"><a href="#FileStorage.list-226"><span class="linenos">226</span></a>        <span class="n">lst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">)</span>
</span><span id="FileStorage.list-227"><a href="#FileStorage.list-227"><span class="linenos">227</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="FileStorage.list-228"><a href="#FileStorage.list-228"><span class="linenos">228</span></a>            <span class="n">ephemeral</span>
</span><span id="FileStorage.list-229"><a href="#FileStorage.list-229"><span class="linenos">229</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">file_suffix</span><span class="p">)]</span>
</span><span id="FileStorage.list-230"><a href="#FileStorage.list-230"><span class="linenos">230</span></a>            <span class="o">+</span> <span class="p">[</span><span class="n">name</span><span class="p">[:</span> <span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">lst</span> <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">dir_suffix</span><span class="p">)]</span>
</span><span id="FileStorage.list-231"><a href="#FileStorage.list-231"><span class="linenos">231</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>List all tracing uids in storage</p>
</div>


                            </div>
                            <div id="FileStorage.remove_node" class="classattr">
                                        <input id="FileStorage.remove_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">remove_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="FileStorage.remove_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FileStorage.remove_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FileStorage.remove_node-233"><a href="#FileStorage.remove_node-233"><span class="linenos">233</span></a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FileStorage.remove_node-234"><a href="#FileStorage.remove_node-234"><span class="linenos">234</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_uid</span><span class="p">(</span><span class="n">uid</span><span class="p">):</span>
</span><span id="FileStorage.remove_node-235"><a href="#FileStorage.remove_node-235"><span class="linenos">235</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid uid&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-236"><a href="#FileStorage.remove_node-236"><span class="linenos">236</span></a>        <span class="c1"># First try to remove .root, so it immediately disappear from listing</span>
</span><span id="FileStorage.remove_node-237"><a href="#FileStorage.remove_node-237"><span class="linenos">237</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.root&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-238"><a href="#FileStorage.remove_node-238"><span class="linenos">238</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage.remove_node-239"><a href="#FileStorage.remove_node-239"><span class="linenos">239</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-240"><a href="#FileStorage.remove_node-240"><span class="linenos">240</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_file_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span> <span class="o">+</span> <span class="s2">&quot;.full&quot;</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-241"><a href="#FileStorage.remove_node-241"><span class="linenos">241</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">unlink</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-242"><a href="#FileStorage.remove_node-242"><span class="linenos">242</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FileStorage.remove_node-243"><a href="#FileStorage.remove_node-243"><span class="linenos">243</span></a>            <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dir_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">directory</span><span class="p">,</span> <span class="n">uid</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-244"><a href="#FileStorage.remove_node-244"><span class="linenos">244</span></a>            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span><span id="FileStorage.remove_node-245"><a href="#FileStorage.remove_node-245"><span class="linenos">245</span></a>                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="FileStorage.remove_node-246"><a href="#FileStorage.remove_node-246"><span class="linenos">246</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="FileStorage.remove_node-247"><a href="#FileStorage.remove_node-247"><span class="linenos">247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove tracing from storage</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#StorageBase">StorageBase</a></dt>
                                <dd id="FileStorage.register_node" class="function"><a href="#StorageBase.register_node">register_node</a></dd>
                <dd id="FileStorage.get_ephemeral_node" class="function"><a href="#StorageBase.get_ephemeral_node">get_ephemeral_node</a></dd>
                <dd id="FileStorage.read_roots" class="function"><a href="#StorageBase.read_roots">read_roots</a></dd>
                <dd id="FileStorage.read_node" class="function"><a href="#StorageBase.read_node">read_node</a></dd>
                <dd id="FileStorage.read_all_nodes" class="function"><a href="#StorageBase.read_all_nodes">read_all_nodes</a></dd>
                <dd id="FileStorage.live_display" class="function"><a href="#StorageBase.live_display">live_display</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="StorageBase">
                            <input id="StorageBase-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">StorageBase</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="StorageBase-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase-20"><a href="#StorageBase-20"><span class="linenos"> 20</span></a><span class="k">class</span> <span class="nc">StorageBase</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="StorageBase-21"><a href="#StorageBase-21"><span class="linenos"> 21</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-22"><a href="#StorageBase-22"><span class="linenos"> 22</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>
</span><span id="StorageBase-23"><a href="#StorageBase-23"><span class="linenos"> 23</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="StorageBase-24"><a href="#StorageBase-24"><span class="linenos"> 24</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StorageBase-25"><a href="#StorageBase-25"><span class="linenos"> 25</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="StorageBase-26"><a href="#StorageBase-26"><span class="linenos"> 26</span></a>
</span><span id="StorageBase-27"><a href="#StorageBase-27"><span class="linenos"> 27</span></a>    <span class="k">def</span> <span class="nf">register_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="StorageBase-28"><a href="#StorageBase-28"><span class="linenos"> 28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register running tracing node (without writing into the persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase-29"><a href="#StorageBase-29"><span class="linenos"> 29</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase-30"><a href="#StorageBase-30"><span class="linenos"> 30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
</span><span id="StorageBase-31"><a href="#StorageBase-31"><span class="linenos"> 31</span></a>
</span><span id="StorageBase-32"><a href="#StorageBase-32"><span class="linenos"> 32</span></a>    <span class="k">def</span> <span class="nf">get_ephemeral_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="StorageBase-33"><a href="#StorageBase-33"><span class="linenos"> 33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get running tracing node (not from persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase-34"><a href="#StorageBase-34"><span class="linenos"> 34</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase-35"><a href="#StorageBase-35"><span class="linenos"> 35</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="StorageBase-36"><a href="#StorageBase-36"><span class="linenos"> 36</span></a>
</span><span id="StorageBase-37"><a href="#StorageBase-37"><span class="linenos"> 37</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-38"><a href="#StorageBase-38"><span class="linenos"> 38</span></a>    <span class="k">def</span> <span class="nf">write_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="StorageBase-39"><a href="#StorageBase-39"><span class="linenos"> 39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write tracing node into persistent storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-40"><a href="#StorageBase-40"><span class="linenos"> 40</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-41"><a href="#StorageBase-41"><span class="linenos"> 41</span></a>
</span><span id="StorageBase-42"><a href="#StorageBase-42"><span class="linenos"> 42</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-43"><a href="#StorageBase-43"><span class="linenos"> 43</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase-44"><a href="#StorageBase-44"><span class="linenos"> 44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read unserialized tracing from the storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-45"><a href="#StorageBase-45"><span class="linenos"> 45</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-46"><a href="#StorageBase-46"><span class="linenos"> 46</span></a>
</span><span id="StorageBase-47"><a href="#StorageBase-47"><span class="linenos"> 47</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-48"><a href="#StorageBase-48"><span class="linenos"> 48</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase-49"><a href="#StorageBase-49"><span class="linenos"> 49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read tracing without children&quot;&quot;&quot;</span>
</span><span id="StorageBase-50"><a href="#StorageBase-50"><span class="linenos"> 50</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-51"><a href="#StorageBase-51"><span class="linenos"> 51</span></a>
</span><span id="StorageBase-52"><a href="#StorageBase-52"><span class="linenos"> 52</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-53"><a href="#StorageBase-53"><span class="linenos"> 53</span></a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StorageBase-54"><a href="#StorageBase-54"><span class="linenos"> 54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove tracing from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-55"><a href="#StorageBase-55"><span class="linenos"> 55</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-56"><a href="#StorageBase-56"><span class="linenos"> 56</span></a>
</span><span id="StorageBase-57"><a href="#StorageBase-57"><span class="linenos"> 57</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase-58"><a href="#StorageBase-58"><span class="linenos"> 58</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="StorageBase-59"><a href="#StorageBase-59"><span class="linenos"> 59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all tracing uids in storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-60"><a href="#StorageBase-60"><span class="linenos"> 60</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span><span id="StorageBase-61"><a href="#StorageBase-61"><span class="linenos"> 61</span></a>
</span><span id="StorageBase-62"><a href="#StorageBase-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">read_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Data</span><span class="p">]:</span>
</span><span id="StorageBase-63"><a href="#StorageBase-63"><span class="linenos"> 63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read given root nodes without children&quot;&quot;&quot;</span>
</span><span id="StorageBase-64"><a href="#StorageBase-64"><span class="linenos"> 64</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_root</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">]</span>
</span><span id="StorageBase-65"><a href="#StorageBase-65"><span class="linenos"> 65</span></a>
</span><span id="StorageBase-66"><a href="#StorageBase-66"><span class="linenos"> 66</span></a>    <span class="k">def</span> <span class="nf">read_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TracingNode</span><span class="p">:</span>
</span><span id="StorageBase-67"><a href="#StorageBase-67"><span class="linenos"> 67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and serialize tracing node from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-68"><a href="#StorageBase-68"><span class="linenos"> 68</span></a>        <span class="k">return</span> <span class="n">TracingNode</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
</span><span id="StorageBase-69"><a href="#StorageBase-69"><span class="linenos"> 69</span></a>
</span><span id="StorageBase-70"><a href="#StorageBase-70"><span class="linenos"> 70</span></a>    <span class="k">def</span> <span class="nf">read_all_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="StorageBase-71"><a href="#StorageBase-71"><span class="linenos"> 71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read all nodes from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase-72"><a href="#StorageBase-72"><span class="linenos"> 72</span></a>        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="StorageBase-73"><a href="#StorageBase-73"><span class="linenos"> 73</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span><span id="StorageBase-74"><a href="#StorageBase-74"><span class="linenos"> 74</span></a>
</span><span id="StorageBase-75"><a href="#StorageBase-75"><span class="linenos"> 75</span></a>    <span class="k">def</span> <span class="nf">live_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;95%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">):</span>
</span><span id="StorageBase-76"><a href="#StorageBase-76"><span class="linenos"> 76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show tracing in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="StorageBase-77"><a href="#StorageBase-77"><span class="linenos"> 77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-78"><a href="#StorageBase-78"><span class="linenos"> 78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_server</span><span class="p">()</span>
</span><span id="StorageBase-79"><a href="#StorageBase-79"><span class="linenos"> 79</span></a>        <span class="n">display_iframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span><span id="StorageBase-80"><a href="#StorageBase-80"><span class="linenos"> 80</span></a>
</span><span id="StorageBase-81"><a href="#StorageBase-81"><span class="linenos"> 81</span></a>    <span class="nd">@property</span>
</span><span id="StorageBase-82"><a href="#StorageBase-82"><span class="linenos"> 82</span></a>    <span class="k">def</span> <span class="nf">server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-83"><a href="#StorageBase-83"><span class="linenos"> 83</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-84"><a href="#StorageBase-84"><span class="linenos"> 84</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Server not stared. Use method &#39;start_server&#39; on storage&quot;</span><span class="p">)</span>
</span><span id="StorageBase-85"><a href="#StorageBase-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>
</span><span id="StorageBase-86"><a href="#StorageBase-86"><span class="linenos"> 86</span></a>
</span><span id="StorageBase-87"><a href="#StorageBase-87"><span class="linenos"> 87</span></a>    <span class="k">def</span> <span class="nf">start_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="StorageBase-88"><a href="#StorageBase-88"><span class="linenos"> 88</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase-89"><a href="#StorageBase-89"><span class="linenos"> 89</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Server already started&quot;</span><span class="p">)</span>
</span><span id="StorageBase-90"><a href="#StorageBase-90"><span class="linenos"> 90</span></a>        <span class="kn">from</span> <span class="nn">..ui.storage_server</span> <span class="kn">import</span> <span class="n">start_storage_server</span>
</span><span id="StorageBase-91"><a href="#StorageBase-91"><span class="linenos"> 91</span></a>
</span><span id="StorageBase-92"><a href="#StorageBase-92"><span class="linenos"> 92</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="o">=</span> <span class="n">start_storage_server</span><span class="p">(</span><span class="n">storage</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
</span><span id="StorageBase-93"><a href="#StorageBase-93"><span class="linenos"> 93</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span>
</span><span id="StorageBase-94"><a href="#StorageBase-94"><span class="linenos"> 94</span></a>
</span><span id="StorageBase-95"><a href="#StorageBase-95"><span class="linenos"> 95</span></a>    <span class="k">def</span> <span class="nf">find_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="StorageBase-96"><a href="#StorageBase-96"><span class="linenos"> 96</span></a>        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_all_nodes</span><span class="p">():</span>
</span><span id="StorageBase-97"><a href="#StorageBase-97"><span class="linenos"> 97</span></a>            <span class="k">yield from</span> <span class="n">node</span><span class="o">.</span><span class="n">find_nodes</span><span class="p">(</span><span class="n">predicate</span><span class="p">)</span>
</span><span id="StorageBase-98"><a href="#StorageBase-98"><span class="linenos"> 98</span></a>
</span><span id="StorageBase-99"><a href="#StorageBase-99"><span class="linenos"> 99</span></a>    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="StorageBase-100"><a href="#StorageBase-100"><span class="linenos">100</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">:</span>
</span><span id="StorageBase-101"><a href="#StorageBase-101"><span class="linenos">101</span></a>            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Storage is already active&quot;</span><span class="p">)</span>
</span><span id="StorageBase-102"><a href="#StorageBase-102"><span class="linenos">102</span></a>        <span class="n">old</span> <span class="o">=</span> <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</span><span id="StorageBase-103"><a href="#StorageBase-103"><span class="linenos">103</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">old</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="p">,))</span>
</span><span id="StorageBase-104"><a href="#StorageBase-104"><span class="linenos">104</span></a>        <span class="k">return</span> <span class="bp">self</span>
</span><span id="StorageBase-105"><a href="#StorageBase-105"><span class="linenos">105</span></a>
</span><span id="StorageBase-106"><a href="#StorageBase-106"><span class="linenos">106</span></a>    <span class="k">def</span> <span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">_exc_tb</span><span class="p">):</span>
</span><span id="StorageBase-107"><a href="#StorageBase-107"><span class="linenos">107</span></a>        <span class="n">_STORAGE_STACK</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">)</span>
</span><span id="StorageBase-108"><a href="#StorageBase-108"><span class="linenos">108</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Helper class that provides a standard way to create an ABC using
inheritance.</p>
</div>


                            <div id="StorageBase.register_node" class="classattr">
                                        <input id="StorageBase.register_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">register_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#TracingNode">TracingNode</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.register_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.register_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.register_node-27"><a href="#StorageBase.register_node-27"><span class="linenos">27</span></a>    <span class="k">def</span> <span class="nf">register_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="StorageBase.register_node-28"><a href="#StorageBase.register_node-28"><span class="linenos">28</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Register running tracing node (without writing into the persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase.register_node-29"><a href="#StorageBase.register_node-29"><span class="linenos">29</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase.register_node-30"><a href="#StorageBase.register_node-30"><span class="linenos">30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">uid</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span>
</span></pre></div>


            <div class="docstring"><p>Register running tracing node (without writing into the persistent storage)</p>
</div>


                            </div>
                            <div id="StorageBase.get_ephemeral_node" class="classattr">
                                        <input id="StorageBase.get_ephemeral_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_ephemeral_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#TracingNode">TracingNode</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.get_ephemeral_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.get_ephemeral_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.get_ephemeral_node-32"><a href="#StorageBase.get_ephemeral_node-32"><span class="linenos">32</span></a>    <span class="k">def</span> <span class="nf">get_ephemeral_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="StorageBase.get_ephemeral_node-33"><a href="#StorageBase.get_ephemeral_node-33"><span class="linenos">33</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get running tracing node (not from persistent storage)&quot;&quot;&quot;</span>
</span><span id="StorageBase.get_ephemeral_node-34"><a href="#StorageBase.get_ephemeral_node-34"><span class="linenos">34</span></a>        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
</span><span id="StorageBase.get_ephemeral_node-35"><a href="#StorageBase.get_ephemeral_node-35"><span class="linenos">35</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ephemeral_nodes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Get running tracing node (not from persistent storage)</p>
</div>


                            </div>
                            <div id="StorageBase.write_node" class="classattr">
                                        <input id="StorageBase.write_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">write_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">node</span><span class="p">:</span> <span class="n"><a href="#TracingNode">TracingNode</a></span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.write_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.write_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.write_node-37"><a href="#StorageBase.write_node-37"><span class="linenos">37</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.write_node-38"><a href="#StorageBase.write_node-38"><span class="linenos">38</span></a>    <span class="k">def</span> <span class="nf">write_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">TracingNode</span><span class="p">):</span>
</span><span id="StorageBase.write_node-39"><a href="#StorageBase.write_node-39"><span class="linenos">39</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Write tracing node into persistent storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.write_node-40"><a href="#StorageBase.write_node-40"><span class="linenos">40</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Write tracing node into persistent storage</p>
</div>


                            </div>
                            <div id="StorageBase.read" class="classattr">
                                        <input id="StorageBase.read-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">read</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read-42"><a href="#StorageBase.read-42"><span class="linenos">42</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.read-43"><a href="#StorageBase.read-43"><span class="linenos">43</span></a>    <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase.read-44"><a href="#StorageBase.read-44"><span class="linenos">44</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read unserialized tracing from the storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read-45"><a href="#StorageBase.read-45"><span class="linenos">45</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Read unserialized tracing from the storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_root" class="classattr">
                                        <input id="StorageBase.read_root-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">read_root</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_root-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_root"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_root-47"><a href="#StorageBase.read_root-47"><span class="linenos">47</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.read_root-48"><a href="#StorageBase.read_root-48"><span class="linenos">48</span></a>    <span class="k">def</span> <span class="nf">read_root</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Data</span><span class="p">:</span>
</span><span id="StorageBase.read_root-49"><a href="#StorageBase.read_root-49"><span class="linenos">49</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read tracing without children&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_root-50"><a href="#StorageBase.read_root-50"><span class="linenos">50</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Read tracing without children</p>
</div>


                            </div>
                            <div id="StorageBase.remove_node" class="classattr">
                                        <input id="StorageBase.remove_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">remove_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.remove_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.remove_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.remove_node-52"><a href="#StorageBase.remove_node-52"><span class="linenos">52</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.remove_node-53"><a href="#StorageBase.remove_node-53"><span class="linenos">53</span></a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="StorageBase.remove_node-54"><a href="#StorageBase.remove_node-54"><span class="linenos">54</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove tracing from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.remove_node-55"><a href="#StorageBase.remove_node-55"><span class="linenos">55</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>Remove tracing from storage</p>
</div>


                            </div>
                            <div id="StorageBase.list" class="classattr">
                                        <input id="StorageBase.list-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@abc.abstractmethod</div>

        <span class="def">def</span>
        <span class="name">list</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.list-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.list"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.list-57"><a href="#StorageBase.list-57"><span class="linenos">57</span></a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
</span><span id="StorageBase.list-58"><a href="#StorageBase.list-58"><span class="linenos">58</span></a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="StorageBase.list-59"><a href="#StorageBase.list-59"><span class="linenos">59</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;List all tracing uids in storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.list-60"><a href="#StorageBase.list-60"><span class="linenos">60</span></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</span></pre></div>


            <div class="docstring"><p>List all tracing uids in storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_roots" class="classattr">
                                        <input id="StorageBase.read_roots-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_roots</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="n">List</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="n">List</span><span class="p">[</span><span class="n">ForwardRef</span><span class="p">(</span><span class="s1">&#39;Data&#39;</span><span class="p">)],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]],</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_roots-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_roots"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_roots-62"><a href="#StorageBase.read_roots-62"><span class="linenos">62</span></a>    <span class="k">def</span> <span class="nf">read_roots</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uids</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Data</span><span class="p">]:</span>
</span><span id="StorageBase.read_roots-63"><a href="#StorageBase.read_roots-63"><span class="linenos">63</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read given root nodes without children&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_roots-64"><a href="#StorageBase.read_roots-64"><span class="linenos">64</span></a>        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">read_root</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span> <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">uids</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Read given root nodes without children</p>
</div>


                            </div>
                            <div id="StorageBase.read_node" class="classattr">
                                        <input id="StorageBase.read_node-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_node</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">uid</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n"><a href="#TracingNode">TracingNode</a></span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_node-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_node"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_node-66"><a href="#StorageBase.read_node-66"><span class="linenos">66</span></a>    <span class="k">def</span> <span class="nf">read_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uid</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TracingNode</span><span class="p">:</span>
</span><span id="StorageBase.read_node-67"><a href="#StorageBase.read_node-67"><span class="linenos">67</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read and serialize tracing node from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_node-68"><a href="#StorageBase.read_node-68"><span class="linenos">68</span></a>        <span class="k">return</span> <span class="n">TracingNode</span><span class="o">.</span><span class="n">deserialize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">uid</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Read and serialize tracing node from storage</p>
</div>


                            </div>
                            <div id="StorageBase.read_all_nodes" class="classattr">
                                        <input id="StorageBase.read_all_nodes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_all_nodes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Iterator</span><span class="p">[</span><span class="n"><a href="#TracingNode">TracingNode</a></span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="StorageBase.read_all_nodes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.read_all_nodes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.read_all_nodes-70"><a href="#StorageBase.read_all_nodes-70"><span class="linenos">70</span></a>    <span class="k">def</span> <span class="nf">read_all_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">[</span><span class="n">TracingNode</span><span class="p">]:</span>
</span><span id="StorageBase.read_all_nodes-71"><a href="#StorageBase.read_all_nodes-71"><span class="linenos">71</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Read all nodes from storage&quot;&quot;&quot;</span>
</span><span id="StorageBase.read_all_nodes-72"><a href="#StorageBase.read_all_nodes-72"><span class="linenos">72</span></a>        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">list</span><span class="p">():</span>
</span><span id="StorageBase.read_all_nodes-73"><a href="#StorageBase.read_all_nodes-73"><span class="linenos">73</span></a>            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_node</span><span class="p">(</span><span class="n">uid</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read all nodes from storage</p>
</div>


                            </div>
                            <div id="StorageBase.live_display" class="classattr">
                                        <input id="StorageBase.live_display-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">live_display</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">width</span><span class="o">=</span><span class="s1">&#39;95%&#39;</span>, </span><span class="param"><span class="n">height</span><span class="o">=</span><span class="mi">700</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="StorageBase.live_display-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#StorageBase.live_display"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="StorageBase.live_display-75"><a href="#StorageBase.live_display-75"><span class="linenos">75</span></a>    <span class="k">def</span> <span class="nf">live_display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;95%&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">):</span>
</span><span id="StorageBase.live_display-76"><a href="#StorageBase.live_display-76"><span class="linenos">76</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Show tracing in Jupyter notebook&quot;&quot;&quot;</span>
</span><span id="StorageBase.live_display-77"><a href="#StorageBase.live_display-77"><span class="linenos">77</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="StorageBase.live_display-78"><a href="#StorageBase.live_display-78"><span class="linenos">78</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">start_server</span><span class="p">()</span>
</span><span id="StorageBase.live_display-79"><a href="#StorageBase.live_display-79"><span class="linenos">79</span></a>        <span class="n">display_iframe</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server</span><span class="o">.</span><span class="n">port</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Show tracing in Jupyter notebook</p>
</div>


                            </div>
                </section>
                <section id="Html">
                            <input id="Html-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Html</span>:

                <label class="view-source-button" for="Html-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Html"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Html-2"><a href="#Html-2"><span class="linenos"> 2</span></a><span class="k">class</span> <span class="nc">Html</span><span class="p">:</span>
</span><span id="Html-3"><a href="#Html-3"><span class="linenos"> 3</span></a>
</span><span id="Html-4"><a href="#Html-4"><span class="linenos"> 4</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="Html-5"><a href="#Html-5"><span class="linenos"> 5</span></a><span class="sd">    Wrapper around HTML code that is directly rendered in Data Browser</span>
</span><span id="Html-6"><a href="#Html-6"><span class="linenos"> 6</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Html-7"><a href="#Html-7"><span class="linenos"> 7</span></a>
</span><span id="Html-8"><a href="#Html-8"><span class="linenos"> 8</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="Html-9"><a href="#Html-9"><span class="linenos"> 9</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">html</span> <span class="o">=</span> <span class="n">html</span>
</span><span id="Html-10"><a href="#Html-10"><span class="linenos">10</span></a>
</span><span id="Html-11"><a href="#Html-11"><span class="linenos">11</span></a>    <span class="k">def</span> <span class="nf">__trace_to_node__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="Html-12"><a href="#Html-12"><span class="linenos">12</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;$html&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">html</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Wrapper around HTML code that is directly rendered in Data Browser</p>
</div>


                </section>
                <section id="FormatStr">
                            <input id="FormatStr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">FormatStr</span>:

                <label class="view-source-button" for="FormatStr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FormatStr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FormatStr-75"><a href="#FormatStr-75"><span class="linenos"> 75</span></a><span class="k">class</span> <span class="nc">FormatStr</span><span class="p">:</span>
</span><span id="FormatStr-76"><a href="#FormatStr-76"><span class="linenos"> 76</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="FormatStr-77"><a href="#FormatStr-77"><span class="linenos"> 77</span></a><span class="sd">    A partially-formatted string that remembers the substitutions made (incl. nesting). Immutable.</span>
</span><span id="FormatStr-78"><a href="#FormatStr-78"><span class="linenos"> 78</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="FormatStr-79"><a href="#FormatStr-79"><span class="linenos"> 79</span></a>
</span><span id="FormatStr-80"><a href="#FormatStr-80"><span class="linenos"> 80</span></a>    <span class="n">_parts</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">_SubFormatStr</span> <span class="o">|</span> <span class="n">_FormatStrField</span><span class="p">]</span>
</span><span id="FormatStr-81"><a href="#FormatStr-81"><span class="linenos"> 81</span></a>    <span class="n">_text</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
</span><span id="FormatStr-82"><a href="#FormatStr-82"><span class="linenos"> 82</span></a>
</span><span id="FormatStr-83"><a href="#FormatStr-83"><span class="linenos"> 83</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fstr</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">_parts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">_text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="FormatStr-84"><a href="#FormatStr-84"><span class="linenos"> 84</span></a>        <span class="k">if</span> <span class="n">_parts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FormatStr-85"><a href="#FormatStr-85"><span class="linenos"> 85</span></a>            <span class="k">assert</span> <span class="n">fstr</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="FormatStr-86"><a href="#FormatStr-86"><span class="linenos"> 86</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">_parts</span><span class="p">)</span>
</span><span id="FormatStr-87"><a href="#FormatStr-87"><span class="linenos"> 87</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">_text</span>
</span><span id="FormatStr-88"><a href="#FormatStr-88"><span class="linenos"> 88</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FormatStr-89"><a href="#FormatStr-89"><span class="linenos"> 89</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gen_text</span><span class="p">()</span>
</span><span id="FormatStr-90"><a href="#FormatStr-90"><span class="linenos"> 90</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-91"><a href="#FormatStr-91"><span class="linenos"> 91</span></a>            <span class="k">assert</span> <span class="n">_text</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="FormatStr-92"><a href="#FormatStr-92"><span class="linenos"> 92</span></a>            <span class="k">if</span> <span class="n">fstr</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FormatStr-93"><a href="#FormatStr-93"><span class="linenos"> 93</span></a>                <span class="n">fstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="FormatStr-94"><a href="#FormatStr-94"><span class="linenos"> 94</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parse_fstring</span><span class="p">(</span><span class="n">fstr</span><span class="p">))</span>
</span><span id="FormatStr-95"><a href="#FormatStr-95"><span class="linenos"> 95</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_text</span> <span class="o">=</span> <span class="n">fstr</span>
</span><span id="FormatStr-96"><a href="#FormatStr-96"><span class="linenos"> 96</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="FormatStr-97"><a href="#FormatStr-97"><span class="linenos"> 97</span></a>
</span><span id="FormatStr-98"><a href="#FormatStr-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="fm">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FormatStr-99"><a href="#FormatStr-99"><span class="linenos"> 99</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_initialized&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span><span class="p">:</span>
</span><span id="FormatStr-100"><a href="#FormatStr-100"><span class="linenos">100</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Instances of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2"> are immutable&quot;</span><span class="p">)</span>
</span><span id="FormatStr-101"><a href="#FormatStr-101"><span class="linenos">101</span></a>        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="FormatStr-102"><a href="#FormatStr-102"><span class="linenos">102</span></a>
</span><span id="FormatStr-103"><a href="#FormatStr-103"><span class="linenos">103</span></a>    <span class="k">def</span> <span class="nf">into_html</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FormatStr-104"><a href="#FormatStr-104"><span class="linenos">104</span></a>        <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">p</span><span class="o">.</span><span class="n">into_html</span><span class="p">(</span><span class="n">level</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">]</span>
</span><span id="FormatStr-105"><a href="#FormatStr-105"><span class="linenos">105</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&lt;span class=&quot;FmtString__span&quot; style=&quot;white-space: pre-wrap;&quot;&gt;</span><span class="si">{</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span><span class="si">}</span><span class="s1">&lt;/span&gt;&#39;</span>
</span><span id="FormatStr-106"><a href="#FormatStr-106"><span class="linenos">106</span></a>
</span><span id="FormatStr-107"><a href="#FormatStr-107"><span class="linenos">107</span></a>    <span class="k">def</span> <span class="nf">__trace_to_node__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="FormatStr-108"><a href="#FormatStr-108"><span class="linenos">108</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;_type&quot;</span><span class="p">:</span> <span class="s2">&quot;$html&quot;</span><span class="p">,</span> <span class="s2">&quot;html&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">into_html</span><span class="p">()}</span>
</span><span id="FormatStr-109"><a href="#FormatStr-109"><span class="linenos">109</span></a>
</span><span id="FormatStr-110"><a href="#FormatStr-110"><span class="linenos">110</span></a>    <span class="nd">@classmethod</span>
</span><span id="FormatStr-111"><a href="#FormatStr-111"><span class="linenos">111</span></a>    <span class="k">def</span> <span class="nf">_parse_fstring</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fstr</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">_SubFormatStr</span> <span class="o">|</span> <span class="n">_FormatStrField</span><span class="p">]:</span>
</span><span id="FormatStr-112"><a href="#FormatStr-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Split a given string into&quot;&quot;&quot;</span>
</span><span id="FormatStr-113"><a href="#FormatStr-113"><span class="linenos">113</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FormatStr-114"><a href="#FormatStr-114"><span class="linenos">114</span></a>        <span class="k">for</span> <span class="n">literal_text</span><span class="p">,</span> <span class="n">field_name</span><span class="p">,</span> <span class="n">format_spec</span><span class="p">,</span> <span class="n">conversion</span> <span class="ow">in</span> <span class="n">_formatter</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fstr</span><span class="p">):</span>
</span><span id="FormatStr-115"><a href="#FormatStr-115"><span class="linenos">115</span></a>            <span class="k">if</span> <span class="n">literal_text</span><span class="p">:</span>
</span><span id="FormatStr-116"><a href="#FormatStr-116"><span class="linenos">116</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">literal_text</span><span class="p">)</span>
</span><span id="FormatStr-117"><a href="#FormatStr-117"><span class="linenos">117</span></a>            <span class="k">if</span> <span class="n">field_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="FormatStr-118"><a href="#FormatStr-118"><span class="linenos">118</span></a>                <span class="k">if</span> <span class="s2">&quot;#&quot;</span> <span class="ow">in</span> <span class="n">field_name</span><span class="p">:</span>
</span><span id="FormatStr-119"><a href="#FormatStr-119"><span class="linenos">119</span></a>                    <span class="n">field_name</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="n">field_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="FormatStr-120"><a href="#FormatStr-120"><span class="linenos">120</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-121"><a href="#FormatStr-121"><span class="linenos">121</span></a>                    <span class="n">color</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="FormatStr-122"><a href="#FormatStr-122"><span class="linenos">122</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">field_name</span> <span class="ow">or</span> <span class="n">field_name</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
</span><span id="FormatStr-123"><a href="#FormatStr-123"><span class="linenos">123</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Position-based format arguments are unsupported&quot;</span><span class="p">)</span>
</span><span id="FormatStr-124"><a href="#FormatStr-124"><span class="linenos">124</span></a>                <span class="k">if</span> <span class="s2">&quot;{&quot;</span> <span class="ow">in</span> <span class="n">format_spec</span><span class="p">:</span>
</span><span id="FormatStr-125"><a href="#FormatStr-125"><span class="linenos">125</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="FormatStr-126"><a href="#FormatStr-126"><span class="linenos">126</span></a>                        <span class="sa">f</span><span class="s2">&quot;Format specifiers with arguments unsupported in </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FormatStr-127"><a href="#FormatStr-127"><span class="linenos">127</span></a>                    <span class="p">)</span>
</span><span id="FormatStr-128"><a href="#FormatStr-128"><span class="linenos">128</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="FormatStr-129"><a href="#FormatStr-129"><span class="linenos">129</span></a>                    <span class="n">_FormatStrField</span><span class="p">(</span>
</span><span id="FormatStr-130"><a href="#FormatStr-130"><span class="linenos">130</span></a>                        <span class="n">field_name</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="FormatStr-131"><a href="#FormatStr-131"><span class="linenos">131</span></a>                        <span class="n">format_spec</span><span class="o">=</span><span class="n">format_spec</span><span class="p">,</span>
</span><span id="FormatStr-132"><a href="#FormatStr-132"><span class="linenos">132</span></a>                        <span class="n">conversion</span><span class="o">=</span><span class="n">conversion</span><span class="p">,</span>
</span><span id="FormatStr-133"><a href="#FormatStr-133"><span class="linenos">133</span></a>                        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
</span><span id="FormatStr-134"><a href="#FormatStr-134"><span class="linenos">134</span></a>                    <span class="p">)</span>
</span><span id="FormatStr-135"><a href="#FormatStr-135"><span class="linenos">135</span></a>                <span class="p">)</span>
</span><span id="FormatStr-136"><a href="#FormatStr-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">res</span>
</span><span id="FormatStr-137"><a href="#FormatStr-137"><span class="linenos">137</span></a>
</span><span id="FormatStr-138"><a href="#FormatStr-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FormatStr-139"><a href="#FormatStr-139"><span class="linenos">139</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_text</span>
</span><span id="FormatStr-140"><a href="#FormatStr-140"><span class="linenos">140</span></a>
</span><span id="FormatStr-141"><a href="#FormatStr-141"><span class="linenos">141</span></a>    <span class="k">def</span> <span class="nf">_gen_text</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="FormatStr-142"><a href="#FormatStr-142"><span class="linenos">142</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate the underlying (partially formatted) string&quot;&quot;&quot;</span>
</span><span id="FormatStr-143"><a href="#FormatStr-143"><span class="linenos">143</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FormatStr-144"><a href="#FormatStr-144"><span class="linenos">144</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">:</span>
</span><span id="FormatStr-145"><a href="#FormatStr-145"><span class="linenos">145</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FormatStr-146"><a href="#FormatStr-146"><span class="linenos">146</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="FormatStr-147"><a href="#FormatStr-147"><span class="linenos">147</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_FormatStrField</span><span class="p">):</span>
</span><span id="FormatStr-148"><a href="#FormatStr-148"><span class="linenos">148</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">field_format_spec</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span><span class="p">)</span>
</span><span id="FormatStr-149"><a href="#FormatStr-149"><span class="linenos">149</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_SubFormatStr</span><span class="p">):</span>
</span><span id="FormatStr-150"><a href="#FormatStr-150"><span class="linenos">150</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
</span><span id="FormatStr-151"><a href="#FormatStr-151"><span class="linenos">151</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-152"><a href="#FormatStr-152"><span class="linenos">152</span></a>                <span class="k">assert</span> <span class="kc">False</span>
</span><span id="FormatStr-153"><a href="#FormatStr-153"><span class="linenos">153</span></a>        <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</span><span id="FormatStr-154"><a href="#FormatStr-154"><span class="linenos">154</span></a>
</span><span id="FormatStr-155"><a href="#FormatStr-155"><span class="linenos">155</span></a>    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">FormatStr</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FormatStr</span><span class="p">:</span>
</span><span id="FormatStr-156"><a href="#FormatStr-156"><span class="linenos">156</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">)</span>
</span><span id="FormatStr-157"><a href="#FormatStr-157"><span class="linenos">157</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FormatStr-158"><a href="#FormatStr-158"><span class="linenos">158</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
</span><span id="FormatStr-159"><a href="#FormatStr-159"><span class="linenos">159</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FormatStr</span><span class="p">):</span>
</span><span id="FormatStr-160"><a href="#FormatStr-160"><span class="linenos">160</span></a>            <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other</span><span class="o">.</span><span class="n">_parts</span><span class="p">)</span>
</span><span id="FormatStr-161"><a href="#FormatStr-161"><span class="linenos">161</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-162"><a href="#FormatStr-162"><span class="linenos">162</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="FormatStr-163"><a href="#FormatStr-163"><span class="linenos">163</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.__add__() only accepts str and FormatStr, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FormatStr-164"><a href="#FormatStr-164"><span class="linenos">164</span></a>            <span class="p">)</span>
</span><span id="FormatStr-165"><a href="#FormatStr-165"><span class="linenos">165</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_parts</span><span class="o">=</span><span class="n">parts</span><span class="p">)</span>
</span><span id="FormatStr-166"><a href="#FormatStr-166"><span class="linenos">166</span></a>
</span><span id="FormatStr-167"><a href="#FormatStr-167"><span class="linenos">167</span></a>    <span class="k">def</span> <span class="nf">join</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">iter</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">FormatStr</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">FormatStr</span><span class="p">:</span>
</span><span id="FormatStr-168"><a href="#FormatStr-168"><span class="linenos">168</span></a>        <span class="n">parts</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FormatStr-169"><a href="#FormatStr-169"><span class="linenos">169</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">iter</span><span class="p">):</span>
</span><span id="FormatStr-170"><a href="#FormatStr-170"><span class="linenos">170</span></a>            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="FormatStr-171"><a href="#FormatStr-171"><span class="linenos">171</span></a>                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">)</span>
</span><span id="FormatStr-172"><a href="#FormatStr-172"><span class="linenos">172</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FormatStr-173"><a href="#FormatStr-173"><span class="linenos">173</span></a>                <span class="n">parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="FormatStr-174"><a href="#FormatStr-174"><span class="linenos">174</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">FormatStr</span><span class="p">):</span>
</span><span id="FormatStr-175"><a href="#FormatStr-175"><span class="linenos">175</span></a>                <span class="n">parts</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">_parts</span><span class="p">)</span>
</span><span id="FormatStr-176"><a href="#FormatStr-176"><span class="linenos">176</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-177"><a href="#FormatStr-177"><span class="linenos">177</span></a>                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="FormatStr-178"><a href="#FormatStr-178"><span class="linenos">178</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">.join() only accepts str and FormatStr, got </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="FormatStr-179"><a href="#FormatStr-179"><span class="linenos">179</span></a>                <span class="p">)</span>
</span><span id="FormatStr-180"><a href="#FormatStr-180"><span class="linenos">180</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_parts</span><span class="o">=</span><span class="n">parts</span><span class="p">)</span>
</span><span id="FormatStr-181"><a href="#FormatStr-181"><span class="linenos">181</span></a>
</span><span id="FormatStr-182"><a href="#FormatStr-182"><span class="linenos">182</span></a>    <span class="k">def</span> <span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">_partial</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;FormatStr&quot;</span><span class="p">:</span>
</span><span id="FormatStr-183"><a href="#FormatStr-183"><span class="linenos">183</span></a>        <span class="k">assert</span> <span class="n">_recursive</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">_recursive</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="FormatStr-184"><a href="#FormatStr-184"><span class="linenos">184</span></a>        <span class="k">assert</span> <span class="n">_partial</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">_partial</span> <span class="ow">is</span> <span class="kc">False</span>
</span><span id="FormatStr-185"><a href="#FormatStr-185"><span class="linenos">185</span></a>
</span><span id="FormatStr-186"><a href="#FormatStr-186"><span class="linenos">186</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="FormatStr-187"><a href="#FormatStr-187"><span class="linenos">187</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">:</span>
</span><span id="FormatStr-188"><a href="#FormatStr-188"><span class="linenos">188</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="FormatStr-189"><a href="#FormatStr-189"><span class="linenos">189</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="FormatStr-190"><a href="#FormatStr-190"><span class="linenos">190</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_SubFormatStr</span><span class="p">):</span>
</span><span id="FormatStr-191"><a href="#FormatStr-191"><span class="linenos">191</span></a>                <span class="n">p2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="FormatStr-192"><a href="#FormatStr-192"><span class="linenos">192</span></a>                <span class="k">if</span> <span class="n">_recursive</span><span class="p">:</span>
</span><span id="FormatStr-193"><a href="#FormatStr-193"><span class="linenos">193</span></a>                    <span class="n">p2</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
</span><span id="FormatStr-194"><a href="#FormatStr-194"><span class="linenos">194</span></a>                        <span class="n">_recursive</span><span class="o">=</span><span class="n">_recursive</span><span class="p">,</span> <span class="n">_partial</span><span class="o">=</span><span class="n">_partial</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
</span><span id="FormatStr-195"><a href="#FormatStr-195"><span class="linenos">195</span></a>                    <span class="p">)</span>
</span><span id="FormatStr-196"><a href="#FormatStr-196"><span class="linenos">196</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
</span><span id="FormatStr-197"><a href="#FormatStr-197"><span class="linenos">197</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_FormatStrField</span><span class="p">):</span>
</span><span id="FormatStr-198"><a href="#FormatStr-198"><span class="linenos">198</span></a>                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">field_name</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="FormatStr-199"><a href="#FormatStr-199"><span class="linenos">199</span></a>                    <span class="n">v</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">field_name</span><span class="p">]</span>
</span><span id="FormatStr-200"><a href="#FormatStr-200"><span class="linenos">200</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">conversion</span><span class="p">:</span>
</span><span id="FormatStr-201"><a href="#FormatStr-201"><span class="linenos">201</span></a>                        <span class="n">v</span> <span class="o">=</span> <span class="n">_formatter</span><span class="o">.</span><span class="n">convert_field</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">conversion</span><span class="p">)</span>
</span><span id="FormatStr-202"><a href="#FormatStr-202"><span class="linenos">202</span></a>                    <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">format_spec</span><span class="p">:</span>
</span><span id="FormatStr-203"><a href="#FormatStr-203"><span class="linenos">203</span></a>                        <span class="n">v</span> <span class="o">=</span> <span class="n">_formatter</span><span class="o">.</span><span class="n">format_field</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">format_spec</span><span class="p">)</span>
</span><span id="FormatStr-204"><a href="#FormatStr-204"><span class="linenos">204</span></a>                    <span class="c1"># In case v is not already a string or FmtString</span>
</span><span id="FormatStr-205"><a href="#FormatStr-205"><span class="linenos">205</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="n">FormatStr</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="FormatStr-206"><a href="#FormatStr-206"><span class="linenos">206</span></a>                        <span class="n">v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="FormatStr-207"><a href="#FormatStr-207"><span class="linenos">207</span></a>                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="FormatStr-208"><a href="#FormatStr-208"><span class="linenos">208</span></a>                        <span class="n">_SubFormatStr</span><span class="p">(</span>
</span><span id="FormatStr-209"><a href="#FormatStr-209"><span class="linenos">209</span></a>                            <span class="n">field_name</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">field_name</span><span class="p">,</span>
</span><span id="FormatStr-210"><a href="#FormatStr-210"><span class="linenos">210</span></a>                            <span class="n">field_format_spec</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">field_format_spec</span><span class="p">,</span>
</span><span id="FormatStr-211"><a href="#FormatStr-211"><span class="linenos">211</span></a>                            <span class="n">value</span><span class="o">=</span><span class="n">v</span><span class="p">,</span>
</span><span id="FormatStr-212"><a href="#FormatStr-212"><span class="linenos">212</span></a>                            <span class="n">color</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
</span><span id="FormatStr-213"><a href="#FormatStr-213"><span class="linenos">213</span></a>                        <span class="p">)</span>
</span><span id="FormatStr-214"><a href="#FormatStr-214"><span class="linenos">214</span></a>                    <span class="p">)</span>
</span><span id="FormatStr-215"><a href="#FormatStr-215"><span class="linenos">215</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="FormatStr-216"><a href="#FormatStr-216"><span class="linenos">216</span></a>                    <span class="k">if</span> <span class="ow">not</span> <span class="n">_partial</span><span class="p">:</span>
</span><span id="FormatStr-217"><a href="#FormatStr-217"><span class="linenos">217</span></a>                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="FormatStr-218"><a href="#FormatStr-218"><span class="linenos">218</span></a>                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</span><span id="FormatStr-219"><a href="#FormatStr-219"><span class="linenos">219</span></a>        <span class="k">return</span> <span class="n">FormatStr</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">_parts</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
</span><span id="FormatStr-220"><a href="#FormatStr-220"><span class="linenos">220</span></a>
</span><span id="FormatStr-221"><a href="#FormatStr-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">free_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FormatStr-222"><a href="#FormatStr-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return names of all free parameters&quot;&quot;&quot;</span>
</span><span id="FormatStr-223"><a href="#FormatStr-223"><span class="linenos">223</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="FormatStr-224"><a href="#FormatStr-224"><span class="linenos">224</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">:</span>
</span><span id="FormatStr-225"><a href="#FormatStr-225"><span class="linenos">225</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_FormatStrField</span><span class="p">):</span>
</span><span id="FormatStr-226"><a href="#FormatStr-226"><span class="linenos">226</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="FormatStr-227"><a href="#FormatStr-227"><span class="linenos">227</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_SubFormatStr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_recursive</span><span class="p">:</span>
</span><span id="FormatStr-228"><a href="#FormatStr-228"><span class="linenos">228</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">free_params</span><span class="p">(</span><span class="n">_recursive</span><span class="o">=</span><span class="n">_recursive</span><span class="p">))</span>
</span><span id="FormatStr-229"><a href="#FormatStr-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>A partially-formatted string that remembers the substitutions made (incl. nesting). Immutable.</p>
</div>


                            <div id="FormatStr.free_params" class="classattr">
                                        <input id="FormatStr.free_params-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">free_params</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">_recursive</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">) -> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="FormatStr.free_params-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#FormatStr.free_params"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="FormatStr.free_params-221"><a href="#FormatStr.free_params-221"><span class="linenos">221</span></a>    <span class="k">def</span> <span class="nf">free_params</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">_recursive</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="FormatStr.free_params-222"><a href="#FormatStr.free_params-222"><span class="linenos">222</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return names of all free parameters&quot;&quot;&quot;</span>
</span><span id="FormatStr.free_params-223"><a href="#FormatStr.free_params-223"><span class="linenos">223</span></a>        <span class="n">res</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="FormatStr.free_params-224"><a href="#FormatStr.free_params-224"><span class="linenos">224</span></a>        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parts</span><span class="p">:</span>
</span><span id="FormatStr.free_params-225"><a href="#FormatStr.free_params-225"><span class="linenos">225</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_FormatStrField</span><span class="p">):</span>
</span><span id="FormatStr.free_params-226"><a href="#FormatStr.free_params-226"><span class="linenos">226</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">field_name</span><span class="p">)</span>
</span><span id="FormatStr.free_params-227"><a href="#FormatStr.free_params-227"><span class="linenos">227</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">_SubFormatStr</span><span class="p">)</span> <span class="ow">and</span> <span class="n">_recursive</span><span class="p">:</span>
</span><span id="FormatStr.free_params-228"><a href="#FormatStr.free_params-228"><span class="linenos">228</span></a>                <span class="n">res</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">free_params</span><span class="p">(</span><span class="n">_recursive</span><span class="o">=</span><span class="n">_recursive</span><span class="p">))</span>
</span><span id="FormatStr.free_params-229"><a href="#FormatStr.free_params-229"><span class="linenos">229</span></a>        <span class="k">return</span> <span class="n">res</span>
</span></pre></div>


            <div class="docstring"><p>Return names of all free parameters</p>
</div>


                            </div>
                </section>
                <section id="HtmlColor">
                            <input id="HtmlColor-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">HtmlColor</span>:

                <label class="view-source-button" for="HtmlColor-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor-9"><a href="#HtmlColor-9"><span class="linenos">  9</span></a><span class="k">class</span> <span class="nc">HtmlColor</span><span class="p">:</span>
</span><span id="HtmlColor-10"><a href="#HtmlColor-10"><span class="linenos"> 10</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper class representing RGB color. Accepts HTML hex notation (3, 4, 6 or 8 hex digits, with optional &#39;#&#39;).&quot;&quot;&quot;</span>
</span><span id="HtmlColor-11"><a href="#HtmlColor-11"><span class="linenos"> 11</span></a>
</span><span id="HtmlColor-12"><a href="#HtmlColor-12"><span class="linenos"> 12</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="HtmlColor-13"><a href="#HtmlColor-13"><span class="linenos"> 13</span></a>        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="HtmlColor-14"><a href="#HtmlColor-14"><span class="linenos"> 14</span></a>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[#]?([0-9a-f]{3,8})&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
</span><span id="HtmlColor-15"><a href="#HtmlColor-15"><span class="linenos"> 15</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
</span><span id="HtmlColor-16"><a href="#HtmlColor-16"><span class="linenos"> 16</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="HtmlColor-17"><a href="#HtmlColor-17"><span class="linenos"> 17</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid color spec: </span><span class="si">{</span><span class="n">color</span><span class="si">!r}</span><span class="s2">, expected HTML hex color spec&quot;</span>
</span><span id="HtmlColor-18"><a href="#HtmlColor-18"><span class="linenos"> 18</span></a>            <span class="p">)</span>
</span><span id="HtmlColor-19"><a href="#HtmlColor-19"><span class="linenos"> 19</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="HtmlColor-20"><a href="#HtmlColor-20"><span class="linenos"> 20</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
</span><span id="HtmlColor-21"><a href="#HtmlColor-21"><span class="linenos"> 21</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="HtmlColor-22"><a href="#HtmlColor-22"><span class="linenos"> 22</span></a>                <span class="sa">f</span><span class="s2">&quot;Invalid color spec: </span><span class="si">{</span><span class="n">color</span><span class="si">!r}</span><span class="s2">, expected HTML hex color spec&quot;</span>
</span><span id="HtmlColor-23"><a href="#HtmlColor-23"><span class="linenos"> 23</span></a>            <span class="p">)</span>
</span><span id="HtmlColor-24"><a href="#HtmlColor-24"><span class="linenos"> 24</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="HtmlColor-25"><a href="#HtmlColor-25"><span class="linenos"> 25</span></a>            <span class="n">c</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">c</span><span class="p">)</span>
</span><span id="HtmlColor-26"><a href="#HtmlColor-26"><span class="linenos"> 26</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="HtmlColor-27"><a href="#HtmlColor-27"><span class="linenos"> 27</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="HtmlColor-28"><a href="#HtmlColor-28"><span class="linenos"> 28</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="HtmlColor-29"><a href="#HtmlColor-29"><span class="linenos"> 29</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
</span><span id="HtmlColor-30"><a href="#HtmlColor-30"><span class="linenos"> 30</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</span><span id="HtmlColor-31"><a href="#HtmlColor-31"><span class="linenos"> 31</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="HtmlColor-32"><a href="#HtmlColor-32"><span class="linenos"> 32</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="HtmlColor-33"><a href="#HtmlColor-33"><span class="linenos"> 33</span></a>
</span><span id="HtmlColor-34"><a href="#HtmlColor-34"><span class="linenos"> 34</span></a>    <span class="k">def</span> <span class="nf">as_floats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="HtmlColor-35"><a href="#HtmlColor-35"><span class="linenos"> 35</span></a>        <span class="s2">&quot;Returns (r,g,b) or (r,g,b,a), with all values 0..1&quot;</span>
</span><span id="HtmlColor-36"><a href="#HtmlColor-36"><span class="linenos"> 36</span></a>        <span class="n">cf</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-37"><a href="#HtmlColor-37"><span class="linenos"> 37</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HtmlColor-38"><a href="#HtmlColor-38"><span class="linenos"> 38</span></a>            <span class="n">cf</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,)</span>
</span><span id="HtmlColor-39"><a href="#HtmlColor-39"><span class="linenos"> 39</span></a>        <span class="k">return</span> <span class="n">cf</span>
</span><span id="HtmlColor-40"><a href="#HtmlColor-40"><span class="linenos"> 40</span></a>
</span><span id="HtmlColor-41"><a href="#HtmlColor-41"><span class="linenos"> 41</span></a>    <span class="nd">@classmethod</span>
</span><span id="HtmlColor-42"><a href="#HtmlColor-42"><span class="linenos"> 42</span></a>    <span class="k">def</span> <span class="nf">from_floats</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor-43"><a href="#HtmlColor-43"><span class="linenos"> 43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns (r,g,b) or (r,g,b,a), with all values 0.0 .. 1.0.&quot;&quot;&quot;</span>
</span><span id="HtmlColor-44"><a href="#HtmlColor-44"><span class="linenos"> 44</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot;000000&quot;</span><span class="p">)</span>
</span><span id="HtmlColor-45"><a href="#HtmlColor-45"><span class="linenos"> 45</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-46"><a href="#HtmlColor-46"><span class="linenos"> 46</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-47"><a href="#HtmlColor-47"><span class="linenos"> 47</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-48"><a href="#HtmlColor-48"><span class="linenos"> 48</span></a>        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HtmlColor-49"><a href="#HtmlColor-49"><span class="linenos"> 49</span></a>            <span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-50"><a href="#HtmlColor-50"><span class="linenos"> 50</span></a>        <span class="k">return</span> <span class="n">c</span>
</span><span id="HtmlColor-51"><a href="#HtmlColor-51"><span class="linenos"> 51</span></a>
</span><span id="HtmlColor-52"><a href="#HtmlColor-52"><span class="linenos"> 52</span></a>    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HtmlColor-53"><a href="#HtmlColor-53"><span class="linenos"> 53</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the color in &#39;#RRGGBB[AA]&#39; HTML hex format.&quot;&quot;&quot;</span>
</span><span id="HtmlColor-54"><a href="#HtmlColor-54"><span class="linenos"> 54</span></a>        <span class="n">s</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="si">:</span><span class="s2">02x</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="si">:</span><span class="s2">02x</span><span class="si">}{</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HtmlColor-55"><a href="#HtmlColor-55"><span class="linenos"> 55</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HtmlColor-56"><a href="#HtmlColor-56"><span class="linenos"> 56</span></a>            <span class="n">s</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="HtmlColor-57"><a href="#HtmlColor-57"><span class="linenos"> 57</span></a>        <span class="k">return</span> <span class="n">s</span>
</span><span id="HtmlColor-58"><a href="#HtmlColor-58"><span class="linenos"> 58</span></a>
</span><span id="HtmlColor-59"><a href="#HtmlColor-59"><span class="linenos"> 59</span></a>    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HtmlColor-60"><a href="#HtmlColor-60"><span class="linenos"> 60</span></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</span><span id="HtmlColor-61"><a href="#HtmlColor-61"><span class="linenos"> 61</span></a>
</span><span id="HtmlColor-62"><a href="#HtmlColor-62"><span class="linenos"> 62</span></a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="HtmlColor-63"><a href="#HtmlColor-63"><span class="linenos"> 63</span></a>        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span id="HtmlColor-64"><a href="#HtmlColor-64"><span class="linenos"> 64</span></a>
</span><span id="HtmlColor-65"><a href="#HtmlColor-65"><span class="linenos"> 65</span></a>    <span class="k">def</span> <span class="nf">_blend_lightness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tgt</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor-66"><a href="#HtmlColor-66"><span class="linenos"> 66</span></a>        <span class="n">hue</span><span class="p">,</span> <span class="n">light</span><span class="p">,</span> <span class="n">sat</span> <span class="o">=</span> <span class="n">colorsys</span><span class="o">.</span><span class="n">rgb_to_hls</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">as_floats</span><span class="p">())</span>
</span><span id="HtmlColor-67"><a href="#HtmlColor-67"><span class="linenos"> 67</span></a>        <span class="n">light</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">tgt</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">light</span>
</span><span id="HtmlColor-68"><a href="#HtmlColor-68"><span class="linenos"> 68</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">from_floats</span><span class="p">(</span><span class="o">*</span><span class="n">colorsys</span><span class="o">.</span><span class="n">hls_to_rgb</span><span class="p">(</span><span class="n">hue</span><span class="p">,</span> <span class="n">light</span><span class="p">,</span> <span class="n">sat</span><span class="p">))</span>
</span><span id="HtmlColor-69"><a href="#HtmlColor-69"><span class="linenos"> 69</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
</span><span id="HtmlColor-70"><a href="#HtmlColor-70"><span class="linenos"> 70</span></a>        <span class="k">return</span> <span class="n">c</span>
</span><span id="HtmlColor-71"><a href="#HtmlColor-71"><span class="linenos"> 71</span></a>
</span><span id="HtmlColor-72"><a href="#HtmlColor-72"><span class="linenos"> 72</span></a>    <span class="k">def</span> <span class="nf">lighter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor-73"><a href="#HtmlColor-73"><span class="linenos"> 73</span></a>        <span class="s2">&quot;Returns a lighter copy of the color: rate=1.0 returns white, rate=0 returns the same color.&quot;</span>
</span><span id="HtmlColor-74"><a href="#HtmlColor-74"><span class="linenos"> 74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blend_lightness</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span>
</span><span id="HtmlColor-75"><a href="#HtmlColor-75"><span class="linenos"> 75</span></a>
</span><span id="HtmlColor-76"><a href="#HtmlColor-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="nf">darker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor-77"><a href="#HtmlColor-77"><span class="linenos"> 77</span></a>        <span class="s2">&quot;Returns a darker copy of the color: rate=1.0 returns black, rate=0 returns the same color.&quot;</span>
</span><span id="HtmlColor-78"><a href="#HtmlColor-78"><span class="linenos"> 78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blend_lightness</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span>
</span><span id="HtmlColor-79"><a href="#HtmlColor-79"><span class="linenos"> 79</span></a>
</span><span id="HtmlColor-80"><a href="#HtmlColor-80"><span class="linenos"> 80</span></a>    <span class="k">def</span> <span class="nf">with_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor-81"><a href="#HtmlColor-81"><span class="linenos"> 81</span></a>        <span class="s2">&quot;Returns a copy of the color with given alpha: float 0.0-1.0&quot;</span>
</span><span id="HtmlColor-82"><a href="#HtmlColor-82"><span class="linenos"> 82</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="HtmlColor-83"><a href="#HtmlColor-83"><span class="linenos"> 83</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="HtmlColor-84"><a href="#HtmlColor-84"><span class="linenos"> 84</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor-85"><a href="#HtmlColor-85"><span class="linenos"> 85</span></a>        <span class="k">return</span> <span class="n">c</span>
</span><span id="HtmlColor-86"><a href="#HtmlColor-86"><span class="linenos"> 86</span></a>
</span><span id="HtmlColor-87"><a href="#HtmlColor-87"><span class="linenos"> 87</span></a>    <span class="nd">@classmethod</span>
</span><span id="HtmlColor-88"><a href="#HtmlColor-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">random_color</span><span class="p">(</span>
</span><span id="HtmlColor-89"><a href="#HtmlColor-89"><span class="linenos"> 89</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="HtmlColor-90"><a href="#HtmlColor-90"><span class="linenos"> 90</span></a>        <span class="n">seed</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HtmlColor-91"><a href="#HtmlColor-91"><span class="linenos"> 91</span></a>        <span class="n">saturation</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="HtmlColor-92"><a href="#HtmlColor-92"><span class="linenos"> 92</span></a>        <span class="n">lighness</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="HtmlColor-93"><a href="#HtmlColor-93"><span class="linenos"> 93</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="HtmlColor-94"><a href="#HtmlColor-94"><span class="linenos"> 94</span></a>        <span class="n">vary_lightness_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="HtmlColor-95"><a href="#HtmlColor-95"><span class="linenos"> 95</span></a>        <span class="n">vary_saturation_rate</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="HtmlColor-96"><a href="#HtmlColor-96"><span class="linenos"> 96</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HtmlColor-97"><a href="#HtmlColor-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pseudo-random color for the given object, or a random color.</span>
</span><span id="HtmlColor-98"><a href="#HtmlColor-98"><span class="linenos"> 98</span></a>
</span><span id="HtmlColor-99"><a href="#HtmlColor-99"><span class="linenos"> 99</span></a><span class="sd">        The color is primarily determined by a random hue and given saturation and lightness.</span>
</span><span id="HtmlColor-100"><a href="#HtmlColor-100"><span class="linenos">100</span></a><span class="sd">        By default, the lightness and saturation of the generated color slightly varies from the given values.</span>
</span><span id="HtmlColor-101"><a href="#HtmlColor-101"><span class="linenos">101</span></a><span class="sd">        The returned color is guaranteed to be stable across runs for string seeds</span>
</span><span id="HtmlColor-102"><a href="#HtmlColor-102"><span class="linenos">102</span></a><span class="sd">        (or objects with stable __repr__ value).</span>
</span><span id="HtmlColor-103"><a href="#HtmlColor-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HtmlColor-104"><a href="#HtmlColor-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="HtmlColor-105"><a href="#HtmlColor-105"><span class="linenos">105</span></a>            <span class="c1"># This can bring instability between versions of your __repr__ or Python</span>
</span><span id="HtmlColor-106"><a href="#HtmlColor-106"><span class="linenos">106</span></a>            <span class="c1"># and for some objects this may just vary even among identical objects</span>
</span><span id="HtmlColor-107"><a href="#HtmlColor-107"><span class="linenos">107</span></a>            <span class="n">seed</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor-108"><a href="#HtmlColor-108"><span class="linenos">108</span></a>            <span class="c1"># Remove any concrete pointer addresses, as these will vary</span>
</span><span id="HtmlColor-109"><a href="#HtmlColor-109"><span class="linenos">109</span></a>            <span class="n">seed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0x[0-9a-fA-F]</span><span class="si">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;0xPTR&gt;&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor-110"><a href="#HtmlColor-110"><span class="linenos">110</span></a>        <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor-111"><a href="#HtmlColor-111"><span class="linenos">111</span></a>
</span><span id="HtmlColor-112"><a href="#HtmlColor-112"><span class="linenos">112</span></a>        <span class="n">hue</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor-113"><a href="#HtmlColor-113"><span class="linenos">113</span></a>        <span class="n">tgt_s</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor-114"><a href="#HtmlColor-114"><span class="linenos">114</span></a>        <span class="n">tgt_l</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor-115"><a href="#HtmlColor-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_floats</span><span class="p">(</span>
</span><span id="HtmlColor-116"><a href="#HtmlColor-116"><span class="linenos">116</span></a>            <span class="o">*</span><span class="n">colorsys</span><span class="o">.</span><span class="n">hls_to_rgb</span><span class="p">(</span>
</span><span id="HtmlColor-117"><a href="#HtmlColor-117"><span class="linenos">117</span></a>                <span class="n">hue</span><span class="p">,</span>
</span><span id="HtmlColor-118"><a href="#HtmlColor-118"><span class="linenos">118</span></a>                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">vary_lightness_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">lighness</span> <span class="o">+</span> <span class="n">vary_lightness_rate</span> <span class="o">*</span> <span class="n">tgt_l</span><span class="p">,</span>
</span><span id="HtmlColor-119"><a href="#HtmlColor-119"><span class="linenos">119</span></a>                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">vary_saturation_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">saturation</span> <span class="o">+</span> <span class="n">vary_saturation_rate</span> <span class="o">*</span> <span class="n">tgt_s</span><span class="p">,</span>
</span><span id="HtmlColor-120"><a href="#HtmlColor-120"><span class="linenos">120</span></a>            <span class="p">)</span>
</span><span id="HtmlColor-121"><a href="#HtmlColor-121"><span class="linenos">121</span></a>        <span class="p">)</span>
</span><span id="HtmlColor-122"><a href="#HtmlColor-122"><span class="linenos">122</span></a>
</span><span id="HtmlColor-123"><a href="#HtmlColor-123"><span class="linenos">123</span></a>    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
</span><span id="HtmlColor-124"><a href="#HtmlColor-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">):</span>
</span><span id="HtmlColor-125"><a href="#HtmlColor-125"><span class="linenos">125</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="HtmlColor-126"><a href="#HtmlColor-126"><span class="linenos">126</span></a>        <span class="k">return</span> <span class="p">(</span>
</span><span id="HtmlColor-127"><a href="#HtmlColor-127"><span class="linenos">127</span></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">r</span><span class="p">)</span>
</span><span id="HtmlColor-128"><a href="#HtmlColor-128"><span class="linenos">128</span></a>            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">g</span><span class="p">)</span>
</span><span id="HtmlColor-129"><a href="#HtmlColor-129"><span class="linenos">129</span></a>            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
</span><span id="HtmlColor-130"><a href="#HtmlColor-130"><span class="linenos">130</span></a>            <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
</span><span id="HtmlColor-131"><a href="#HtmlColor-131"><span class="linenos">131</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper class representing RGB color. Accepts HTML hex notation (3, 4, 6 or 8 hex digits, with optional '#').</p>
</div>


                            <div id="HtmlColor.as_floats" class="classattr">
                                        <input id="HtmlColor.as_floats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_floats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">tuple</span>:</span></span>

                <label class="view-source-button" for="HtmlColor.as_floats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.as_floats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.as_floats-34"><a href="#HtmlColor.as_floats-34"><span class="linenos">34</span></a>    <span class="k">def</span> <span class="nf">as_floats</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
</span><span id="HtmlColor.as_floats-35"><a href="#HtmlColor.as_floats-35"><span class="linenos">35</span></a>        <span class="s2">&quot;Returns (r,g,b) or (r,g,b,a), with all values 0..1&quot;</span>
</span><span id="HtmlColor.as_floats-36"><a href="#HtmlColor.as_floats-36"><span class="linenos">36</span></a>        <span class="n">cf</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.as_floats-37"><a href="#HtmlColor.as_floats-37"><span class="linenos">37</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HtmlColor.as_floats-38"><a href="#HtmlColor.as_floats-38"><span class="linenos">38</span></a>            <span class="n">cf</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="mi">255</span><span class="p">,)</span>
</span><span id="HtmlColor.as_floats-39"><a href="#HtmlColor.as_floats-39"><span class="linenos">39</span></a>        <span class="k">return</span> <span class="n">cf</span>
</span></pre></div>


            <div class="docstring"><p>Returns (r,g,b) or (r,g,b,a), with all values 0..1</p>
</div>


                            </div>
                            <div id="HtmlColor.from_floats" class="classattr">
                                        <input id="HtmlColor.from_floats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">from_floats</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">r</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">g</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">b</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#HtmlColor">HtmlColor</a></span>:</span></span>

                <label class="view-source-button" for="HtmlColor.from_floats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.from_floats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.from_floats-41"><a href="#HtmlColor.from_floats-41"><span class="linenos">41</span></a>    <span class="nd">@classmethod</span>
</span><span id="HtmlColor.from_floats-42"><a href="#HtmlColor.from_floats-42"><span class="linenos">42</span></a>    <span class="k">def</span> <span class="nf">from_floats</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">r</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">g</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor.from_floats-43"><a href="#HtmlColor.from_floats-43"><span class="linenos">43</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns (r,g,b) or (r,g,b,a), with all values 0.0 .. 1.0.&quot;&quot;&quot;</span>
</span><span id="HtmlColor.from_floats-44"><a href="#HtmlColor.from_floats-44"><span class="linenos">44</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s2">&quot;000000&quot;</span><span class="p">)</span>
</span><span id="HtmlColor.from_floats-45"><a href="#HtmlColor.from_floats-45"><span class="linenos">45</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">r</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.from_floats-46"><a href="#HtmlColor.from_floats-46"><span class="linenos">46</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">g</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.from_floats-47"><a href="#HtmlColor.from_floats-47"><span class="linenos">47</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">b</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.from_floats-48"><a href="#HtmlColor.from_floats-48"><span class="linenos">48</span></a>        <span class="k">if</span> <span class="n">a</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="HtmlColor.from_floats-49"><a href="#HtmlColor.from_floats-49"><span class="linenos">49</span></a>            <span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.from_floats-50"><a href="#HtmlColor.from_floats-50"><span class="linenos">50</span></a>        <span class="k">return</span> <span class="n">c</span>
</span></pre></div>


            <div class="docstring"><p>Returns (r,g,b) or (r,g,b,a), with all values 0.0 .. 1.0.</p>
</div>


                            </div>
                            <div id="HtmlColor.lighter" class="classattr">
                                        <input id="HtmlColor.lighter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">lighter</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span></span><span class="return-annotation">) -> <span class="n"><a href="#HtmlColor">HtmlColor</a></span>:</span></span>

                <label class="view-source-button" for="HtmlColor.lighter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.lighter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.lighter-72"><a href="#HtmlColor.lighter-72"><span class="linenos">72</span></a>    <span class="k">def</span> <span class="nf">lighter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor.lighter-73"><a href="#HtmlColor.lighter-73"><span class="linenos">73</span></a>        <span class="s2">&quot;Returns a lighter copy of the color: rate=1.0 returns white, rate=0 returns the same color.&quot;</span>
</span><span id="HtmlColor.lighter-74"><a href="#HtmlColor.lighter-74"><span class="linenos">74</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blend_lightness</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a lighter copy of the color: rate=1.0 returns white, rate=0 returns the same color.</p>
</div>


                            </div>
                            <div id="HtmlColor.darker" class="classattr">
                                        <input id="HtmlColor.darker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">darker</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span></span><span class="return-annotation">) -> <span class="n"><a href="#HtmlColor">HtmlColor</a></span>:</span></span>

                <label class="view-source-button" for="HtmlColor.darker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.darker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.darker-76"><a href="#HtmlColor.darker-76"><span class="linenos">76</span></a>    <span class="k">def</span> <span class="nf">darker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor.darker-77"><a href="#HtmlColor.darker-77"><span class="linenos">77</span></a>        <span class="s2">&quot;Returns a darker copy of the color: rate=1.0 returns black, rate=0 returns the same color.&quot;</span>
</span><span id="HtmlColor.darker-78"><a href="#HtmlColor.darker-78"><span class="linenos">78</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_blend_lightness</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">rate</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a darker copy of the color: rate=1.0 returns black, rate=0 returns the same color.</p>
</div>


                            </div>
                            <div id="HtmlColor.with_alpha" class="classattr">
                                        <input id="HtmlColor.with_alpha-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">with_alpha</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">a</span><span class="p">:</span> <span class="nb">float</span></span><span class="return-annotation">) -> <span class="n"><a href="#HtmlColor">HtmlColor</a></span>:</span></span>

                <label class="view-source-button" for="HtmlColor.with_alpha-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.with_alpha"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.with_alpha-80"><a href="#HtmlColor.with_alpha-80"><span class="linenos">80</span></a>    <span class="k">def</span> <span class="nf">with_alpha</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;HtmlColor&quot;</span><span class="p">:</span>
</span><span id="HtmlColor.with_alpha-81"><a href="#HtmlColor.with_alpha-81"><span class="linenos">81</span></a>        <span class="s2">&quot;Returns a copy of the color with given alpha: float 0.0-1.0&quot;</span>
</span><span id="HtmlColor.with_alpha-82"><a href="#HtmlColor.with_alpha-82"><span class="linenos">82</span></a>        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="HtmlColor.with_alpha-83"><a href="#HtmlColor.with_alpha-83"><span class="linenos">83</span></a>        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="HtmlColor.with_alpha-84"><a href="#HtmlColor.with_alpha-84"><span class="linenos">84</span></a>        <span class="n">c</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">a</span> <span class="o">*</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="HtmlColor.with_alpha-85"><a href="#HtmlColor.with_alpha-85"><span class="linenos">85</span></a>        <span class="k">return</span> <span class="n">c</span>
</span></pre></div>


            <div class="docstring"><p>Returns a copy of the color with given alpha: float 0.0-1.0</p>
</div>


                            </div>
                            <div id="HtmlColor.random_color" class="classattr">
                                        <input id="HtmlColor.random_color-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@classmethod</div>

        <span class="def">def</span>
        <span class="name">random_color</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">saturation</span><span class="o">=</span><span class="mf">0.7</span>,</span><span class="param">	<span class="n">lighness</span><span class="o">=</span><span class="mf">0.5</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">vary_lightness_rate</span><span class="o">=</span><span class="mf">0.2</span>,</span><span class="param">	<span class="n">vary_saturation_rate</span><span class="o">=</span><span class="mf">0.3</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="HtmlColor.random_color-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#HtmlColor.random_color"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="HtmlColor.random_color-87"><a href="#HtmlColor.random_color-87"><span class="linenos"> 87</span></a>    <span class="nd">@classmethod</span>
</span><span id="HtmlColor.random_color-88"><a href="#HtmlColor.random_color-88"><span class="linenos"> 88</span></a>    <span class="k">def</span> <span class="nf">random_color</span><span class="p">(</span>
</span><span id="HtmlColor.random_color-89"><a href="#HtmlColor.random_color-89"><span class="linenos"> 89</span></a>        <span class="bp">cls</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-90"><a href="#HtmlColor.random_color-90"><span class="linenos"> 90</span></a>        <span class="n">seed</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-91"><a href="#HtmlColor.random_color-91"><span class="linenos"> 91</span></a>        <span class="n">saturation</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-92"><a href="#HtmlColor.random_color-92"><span class="linenos"> 92</span></a>        <span class="n">lighness</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-93"><a href="#HtmlColor.random_color-93"><span class="linenos"> 93</span></a>        <span class="o">*</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-94"><a href="#HtmlColor.random_color-94"><span class="linenos"> 94</span></a>        <span class="n">vary_lightness_rate</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-95"><a href="#HtmlColor.random_color-95"><span class="linenos"> 95</span></a>        <span class="n">vary_saturation_rate</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-96"><a href="#HtmlColor.random_color-96"><span class="linenos"> 96</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="HtmlColor.random_color-97"><a href="#HtmlColor.random_color-97"><span class="linenos"> 97</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a pseudo-random color for the given object, or a random color.</span>
</span><span id="HtmlColor.random_color-98"><a href="#HtmlColor.random_color-98"><span class="linenos"> 98</span></a>
</span><span id="HtmlColor.random_color-99"><a href="#HtmlColor.random_color-99"><span class="linenos"> 99</span></a><span class="sd">        The color is primarily determined by a random hue and given saturation and lightness.</span>
</span><span id="HtmlColor.random_color-100"><a href="#HtmlColor.random_color-100"><span class="linenos">100</span></a><span class="sd">        By default, the lightness and saturation of the generated color slightly varies from the given values.</span>
</span><span id="HtmlColor.random_color-101"><a href="#HtmlColor.random_color-101"><span class="linenos">101</span></a><span class="sd">        The returned color is guaranteed to be stable across runs for string seeds</span>
</span><span id="HtmlColor.random_color-102"><a href="#HtmlColor.random_color-102"><span class="linenos">102</span></a><span class="sd">        (or objects with stable __repr__ value).</span>
</span><span id="HtmlColor.random_color-103"><a href="#HtmlColor.random_color-103"><span class="linenos">103</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="HtmlColor.random_color-104"><a href="#HtmlColor.random_color-104"><span class="linenos">104</span></a>        <span class="k">if</span> <span class="p">(</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seed</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span>
</span><span id="HtmlColor.random_color-105"><a href="#HtmlColor.random_color-105"><span class="linenos">105</span></a>            <span class="c1"># This can bring instability between versions of your __repr__ or Python</span>
</span><span id="HtmlColor.random_color-106"><a href="#HtmlColor.random_color-106"><span class="linenos">106</span></a>            <span class="c1"># and for some objects this may just vary even among identical objects</span>
</span><span id="HtmlColor.random_color-107"><a href="#HtmlColor.random_color-107"><span class="linenos">107</span></a>            <span class="n">seed</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor.random_color-108"><a href="#HtmlColor.random_color-108"><span class="linenos">108</span></a>            <span class="c1"># Remove any concrete pointer addresses, as these will vary</span>
</span><span id="HtmlColor.random_color-109"><a href="#HtmlColor.random_color-109"><span class="linenos">109</span></a>            <span class="n">seed</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;0x[0-9a-fA-F]</span><span class="si">{</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&lt;0xPTR&gt;&quot;</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor.random_color-110"><a href="#HtmlColor.random_color-110"><span class="linenos">110</span></a>        <span class="n">rng</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">Random</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
</span><span id="HtmlColor.random_color-111"><a href="#HtmlColor.random_color-111"><span class="linenos">111</span></a>
</span><span id="HtmlColor.random_color-112"><a href="#HtmlColor.random_color-112"><span class="linenos">112</span></a>        <span class="n">hue</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor.random_color-113"><a href="#HtmlColor.random_color-113"><span class="linenos">113</span></a>        <span class="n">tgt_s</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor.random_color-114"><a href="#HtmlColor.random_color-114"><span class="linenos">114</span></a>        <span class="n">tgt_l</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</span><span id="HtmlColor.random_color-115"><a href="#HtmlColor.random_color-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_floats</span><span class="p">(</span>
</span><span id="HtmlColor.random_color-116"><a href="#HtmlColor.random_color-116"><span class="linenos">116</span></a>            <span class="o">*</span><span class="n">colorsys</span><span class="o">.</span><span class="n">hls_to_rgb</span><span class="p">(</span>
</span><span id="HtmlColor.random_color-117"><a href="#HtmlColor.random_color-117"><span class="linenos">117</span></a>                <span class="n">hue</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-118"><a href="#HtmlColor.random_color-118"><span class="linenos">118</span></a>                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">vary_lightness_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">lighness</span> <span class="o">+</span> <span class="n">vary_lightness_rate</span> <span class="o">*</span> <span class="n">tgt_l</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-119"><a href="#HtmlColor.random_color-119"><span class="linenos">119</span></a>                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">vary_saturation_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">saturation</span> <span class="o">+</span> <span class="n">vary_saturation_rate</span> <span class="o">*</span> <span class="n">tgt_s</span><span class="p">,</span>
</span><span id="HtmlColor.random_color-120"><a href="#HtmlColor.random_color-120"><span class="linenos">120</span></a>            <span class="p">)</span>
</span><span id="HtmlColor.random_color-121"><a href="#HtmlColor.random_color-121"><span class="linenos">121</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a pseudo-random color for the given object, or a random color.</p>

<p>The color is primarily determined by a random hue and given saturation and lightness.
By default, the lightness and saturation of the generated color slightly varies from the given values.
The returned color is guaranteed to be stable across runs for string seeds
(or objects with stable __repr__ value).</p>
</div>


                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>